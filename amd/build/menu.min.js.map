{"version":3,"sources":["../src/menu.js"],"names":["openMenu","initThemeChooser","body","uselighttheme","useostheme","usedarktheme","selected","hasClass","addClass","click","removeClass","updateThemePreferenceAjax","theme","Ajax","call","methodname","args","preferences","type","value","fail","Notification","exception","hamburgerbreakpoint","openCandidate","openTimeoutId","closeTimeoutId","openTime","open","menuItem","close","abortClose","children","attr","openWithDelay","setTimeout","Date","closeWithDelay","clearTimeout","abortOpen","reset","ev","currentTarget","parentNode","menuitems","parent","mouseenter","width","window","innerWidth","screen","mouseleave","link","item","toggleClass","hamburgertoggle","hamburgerparent","oneColLayoutBefore","hamburgerLayoutBefore","updateMaxMenuHeight","menuButtom","botPos","offset","top","oneColLayout","css","height","hamburgerLayout","resize"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the user menu.\n *\n * @package    theme_wwu2019\n * @copyright  2019 Justus Dieckmann WWU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\n\n/**\n * Init function\n */\nexport function init() {\n    openMenu();\n    initThemeChooser();\n}\n\n\nfunction initThemeChooser() {\n    const body = $('body');\n    const uselighttheme = $('#user-menu .wwu-uselighttheme');\n    const useostheme = $('#user-menu .wwu-useostheme');\n    const usedarktheme = $('#user-menu .wwu-usedarktheme');\n\n    let selected;\n    if (body.hasClass('dark')) {\n        selected = usedarktheme;\n    } else if (body.hasClass('light')) {\n        selected = uselighttheme;\n    } else {\n        selected = useostheme;\n    }\n    selected.addClass('selectedtheme');\n\n    uselighttheme.click(function() {\n        selected.removeClass('selectedtheme');\n        body.removeClass('dark');\n        body.addClass('light');\n        updateThemePreferenceAjax(1);\n        selected = uselighttheme;\n        selected.addClass('selectedtheme');\n    });\n    useostheme.click(function() {\n        selected.removeClass('selectedtheme');\n        body.removeClass('dark');\n        body.removeClass('light');\n        updateThemePreferenceAjax(0);\n        selected = useostheme;\n        selected.addClass('selectedtheme');\n    });\n    usedarktheme.click(function() {\n        selected.removeClass('selectedtheme');\n        body.addClass('dark');\n        body.removeClass('light');\n        updateThemePreferenceAjax(2);\n        selected = usedarktheme;\n        selected.addClass('selectedtheme');\n    });\n}\n\nfunction updateThemePreferenceAjax(theme) {\n    var request = {\n        methodname: 'core_user_update_user_preferences',\n        args: {\n            preferences: [{\n                type: 'theme_wwu2019_theme',\n                value: theme\n            }]\n        }\n    };\n\n    Ajax.call([request])[0]\n        .fail(Notification.exception);\n}\n\nconst onecolumnbreakpoint = 767;\nconst hamburgerbreakpoint = 1080;\n\n\n/**\n * Opens submenu when hovering\n */\nfunction openMenu() {\n    const openDelay = 100;\n    const closeDelay = 300;\n    const closeCooldown = 300;\n\n    let openMenu = null;\n    let openCandidate = null;\n    let openTimeoutId = null;\n    let closeTimeoutId = null;\n    /** Date when menu was opened by hovering, to prevent immediately closing it by clicking again.\n     * @type {null|Date} */\n    let openTime = null;\n\n    /**\n     * Opens a menu.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function open(menuItem) {\n        if (openMenu) {\n            close(openMenu);\n        }\n        abortClose();\n        $(menuItem).addClass('open');\n        $(menuItem).children('a').attr('aria-expanded', 'true');\n        openMenu = menuItem;\n        openCandidate = null;\n        openTimeoutId = null;\n    }\n\n    /**\n     * Opens a menu with delay.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function openWithDelay(menuItem) {\n        openCandidate = menuItem;\n        openTimeoutId = setTimeout(() => {\n            open(menuItem);\n            openTime = new Date();\n        }, openDelay);\n    }\n\n    /**\n     * Closes a menu.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function close(menuItem) {\n        $(menuItem).removeClass('open');\n        $(menuItem).children('a').attr('aria-expanded', 'false');\n        openMenu = null;\n        abortClose();\n        openTime = null;\n    }\n\n    /**\n     * Closes a menu with delay.\n     * @param {Node} menuItem the menuItem DOM-Element\n     */\n    function closeWithDelay(menuItem) {\n        closeTimeoutId = setTimeout(close, closeDelay, menuItem);\n    }\n\n    /**\n     * Aborts the delayed closing of {@link openMenu}\n     */\n    function abortClose() {\n        if (closeTimeoutId) {\n            clearTimeout(closeTimeoutId);\n            closeTimeoutId = null;\n        }\n    }\n\n    /**\n     * Aborts the delayed opening of {@link openCandidate}\n     */\n    function abortOpen() {\n        openCandidate = null;\n        if (openTimeoutId) {\n            clearTimeout(openTimeoutId);\n            openTimeoutId = null;\n        }\n    }\n\n    /**\n     * Closes the open menu and resets timeouts;\n     */\n    function reset() {\n        abortClose();\n        abortOpen();\n        if (openMenu) {\n            close(openMenu);\n        }\n    }\n\n    $('li.main-menu-item > a[aria-haspopup=\"true\"], li#user-menu > a[aria-haspopup=\"true\"]').click((ev) => {\n        if (ev.currentTarget.parentNode === openMenu) {\n            if (new Date() - openTime > closeCooldown) {\n                close(openMenu);\n            }\n        } else {\n            open(ev.currentTarget.parentNode);\n        }\n    });\n\n    let menuitems = $('li.main-menu-item > a[aria-haspopup=\"true\"], li#user-menu > a[aria-haspopup=\"true\"]').parent();\n    menuitems.mouseenter((ev) => {\n        let width = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n        if (width > onecolumnbreakpoint) {\n            if (ev.currentTarget === openMenu) {\n                abortClose();\n            } else {\n                openWithDelay(ev.currentTarget);\n            }\n        }\n    });\n    menuitems.mouseleave((ev) => {\n        let width = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n        if (width > onecolumnbreakpoint) {\n            if (openCandidate && ev.currentTarget === openCandidate) {\n                abortOpen();\n            }\n            if (openMenu && ev.currentTarget === openMenu) {\n                closeWithDelay(ev.currentTarget);\n            }\n        }\n    });\n\n    $('li.sub-menu-item > a[aria-haspopup=\"true\"], li.sub-sub-menu-item > a[aria-haspopup=\"true\"]').click((ev) => {\n        let link = $(ev.currentTarget);\n        let item = link.parent();\n        item.toggleClass('open');\n        link.attr('aria-expanded', item.hasClass('open'));\n    });\n\n    let hamburgertoggle = $('#main-menu-hamburger > a');\n    let hamburgerparent = hamburgertoggle.parent();\n    hamburgertoggle.click(() => {\n        hamburgerparent.toggleClass('open');\n        hamburgertoggle.attr('aria-expanded', hamburgerparent.hasClass('open'));\n    });\n\n    let oneColLayoutBefore = false;\n    let hamburgerLayoutBefore = false;\n\n    /**\n     * Updates max-height of submenus on page-init and window resize.\n     */\n    function updateMaxMenuHeight() {\n        const menuButtom = $('#menu-bottom');\n        let botPos = menuButtom.offset().top + 16;\n        let width = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n        let oneColLayout = width <= onecolumnbreakpoint;\n        if (oneColLayout) {\n            $('.sub-menu-scroll-container').css('max-height', '');\n            $('#main-menu-left').css('max-height', ($(window).height() - botPos) + 'px');\n        } else {\n            // If Menu is expanded down, add the height of the #main-menu-left container\n            if (width <= hamburgerbreakpoint) {\n                botPos += 50;\n            }\n            $('.sub-menu-scroll-container').css('max-height', ($(window).height() - botPos) + 'px');\n            $('#main-menu-left').css('max-height', '');\n        }\n        if (oneColLayout !== oneColLayoutBefore) {\n            reset();\n            oneColLayoutBefore = oneColLayout;\n        }\n\n        // Switch hamburger toggle role between button and none, based on whether it is hidden.\n        let hamburgerLayout = width <= hamburgerbreakpoint;\n        if (hamburgerLayout !== hamburgerLayoutBefore) {\n            hamburgertoggle.attr('role', hamburgerLayout ? 'button' : 'none');\n            hamburgerLayoutBefore = hamburgerLayout;\n        }\n    }\n\n    updateMaxMenuHeight();\n    $(window).resize(updateMaxMenuHeight);\n}\n"],"file":"menu.min.js"}