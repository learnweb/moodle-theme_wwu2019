{"version":3,"sources":["../src/snow.js"],"names":["canvas","desiredFlakes","flakes","intervalId","pixurl","M","cfg","wwwroot","init","enableSnow","localStorage","getItem","insertAfter","document","createElement","height","window","innerHeight","width","innerWidth","style","position","top","left","zIndex","opacity","pointerEvents","resize","i","push","x","generateXCoord","y","Math","random","r","d","ctx","getContext","snowicon","setInterval","redraw","attr","hidden","click","clearInterval","setItem","append","angle","moveFlakes","f","length","pow","sin","splice","clearRect","fillStyle","beginPath","moveTo","arc","PI","fill"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manages the very important snow.\n *\n * @package    theme_wwu2019\n * @copyright  2020 Justus Dieckmann WWU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\nlet canvas;\n\nlet desiredFlakes = 150;\n\n/**\n * @type {[{x: number, y: number, r: number, d: number}]}\n */\nlet flakes = [];\n\nlet intervalId = null;\n\nconst pixurl = M.cfg.wwwroot + '/theme/wwu2019/pix/';\n\n/**\n * Init function\n */\nexport function init() {\n    let enableSnow = localStorage.getItem('theme_wwu2019/enable-snow') !== 'false';\n\n    $('<div class=\"mr-3\" id=\"snow-toggle\">' +\n        '<img style=\"margin-top: -6px; cursor: pointer\" width=\"35\">' +\n        '</div>').insertAfter('#main-menu-right .main-menu-additions-item');\n\n    canvas = document.createElement('canvas');\n    canvas.height = window.innerHeight;\n    canvas.width = window.innerWidth;\n    canvas.style.position = 'fixed';\n    canvas.style.top = '0';\n    canvas.style.left = '0';\n    canvas.style.zIndex = '1000';\n    canvas.style.opacity = '0.8';\n    canvas.style.pointerEvents = 'none';\n    $(window).resize(() => {\n        canvas.height = window.innerHeight;\n        canvas.width = window.innerWidth;\n        desiredFlakes = 50 + canvas.height * canvas.width * 0.0001;\n    });\n\n    desiredFlakes = 50 + canvas.height * canvas.width * 0.0001;\n\n    // Loop throught the empty flakes and apply attributes\n    for (let i = 0; i < desiredFlakes; i++) {\n        flakes.push({\n            x: generateXCoord(), // Also spawn left and right of window.\n            y: Math.random() * canvas.height,\n            r: Math.random() * 5 + 2, // Min of 2px and max of 7px\n            d: Math.random() + 1 // Density of the flake\n        });\n    }\n    let ctx = canvas.getContext(\"2d\");\n\n    let snowicon = $('#snow-toggle > img');\n\n    if (enableSnow) {\n        intervalId = setInterval(redraw, 25, ctx);\n        snowicon.attr('src', pixurl + 'snow-disable.svg');\n    } else {\n        canvas.hidden = true;\n        snowicon.attr('src', pixurl + 'snow-enable.svg');\n    }\n\n    $('#snow-toggle').click(() => {\n        if (intervalId) {\n            clearInterval(intervalId);\n            intervalId = null;\n            snowicon.attr('src', pixurl + 'snow-enable.svg');\n        } else {\n            intervalId = setInterval(redraw, 25, ctx);\n            snowicon.attr('src', pixurl + 'snow-disable.svg');\n        }\n        canvas.hidden = intervalId === null;\n        localStorage.setItem('theme_wwu2019/enable-snow', intervalId !== null ? 'true' : 'false');\n    });\n\n    $('body').append(canvas);\n}\n\n// Animate the flakes\nlet angle = 0;\n\nfunction moveFlakes() {\n    angle += 0.01;\n    for (let i = 0; i < flakes.length; i++) {\n        // Store current flake\n        let f = flakes[i];\n        // Update X and Y coordinates of each snowflakes\n        f.y += Math.pow(f.d, 2) + 1;\n        f.x += Math.sin(angle) * 2;\n\n        // If the snowflake reaches the bottom, send a new one to the top\n        if (f.y > canvas.height + 10) {\n            if (flakes.length > desiredFlakes) {\n                flakes.splice(i, 1);\n                i--;\n            }\n            f.x = generateXCoord();\n            f.y = -10;\n        }\n    }\n    if (desiredFlakes > flakes.length && Math.random() < 0.2) {\n        flakes.push({\n            x: generateXCoord(), // Also spawn left and right of window.\n            y: -10,\n            r: Math.random() * 5 + 2, // Min of 2px and max of 7px\n            d: Math.random() + 1 // Density of the flake\n        });\n    }\n}\n\nfunction generateXCoord() {\n    return Math.random() * (canvas.width + 400) - 200;\n}\n\nfunction redraw(ctx) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    // ctx.fillStyle = \"rgba(0, 0, 0, 0.1)\";\n    // ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = \"#cbebfa\";\n    // ctx.fillStyle = \"#fff\";\n    ctx.beginPath();\n    for (let f of flakes) {\n        ctx.moveTo(f.x, f.y);\n        ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2, true);\n    }\n    ctx.fill();\n    moveFlakes();\n}"],"file":"snow.min.js"}