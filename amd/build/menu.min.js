define("theme_wwu2019/menu",["exports","jquery","core/notification","../../../../user/amd/src/repository"],(function(_exports,_jquery,_notification,_repository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Manage the user menu.
   *
   * @module     theme_wwu2019/menu
   * @copyright  2019 Justus Dieckmann WWU
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function updateThemePreferenceAjax(theme){(0,_repository.setUserPreference)("theme_wwu2019_theme",theme).catch(_notification.default.exception)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(){(function(){const openDelay=100,closeDelay=300,closeCooldown=300;let openMenu=null,openCandidate=null,openTimeoutId=null,closeTimeoutId=null,openTime=null;function open(menuItem){openMenu&&close(openMenu),abortClose(),(0,_jquery.default)(menuItem).addClass("open"),(0,_jquery.default)(menuItem).children("a").attr("aria-expanded","true"),openMenu=menuItem,openCandidate=null,openTimeoutId=null}function openWithDelay(menuItem){openCandidate=menuItem,openTimeoutId=setTimeout((()=>{open(menuItem),openTime=new Date}),openDelay)}function close(menuItem){(0,_jquery.default)(menuItem).removeClass("open"),(0,_jquery.default)(menuItem).children("a").attr("aria-expanded","false"),openMenu=null,abortClose(),openTime=null}function closeWithDelay(menuItem){closeTimeoutId=setTimeout(close,closeDelay,menuItem)}function abortClose(){closeTimeoutId&&(clearTimeout(closeTimeoutId),closeTimeoutId=null)}function abortOpen(){openCandidate=null,openTimeoutId&&(clearTimeout(openTimeoutId),openTimeoutId=null)}function reset(){abortClose(),abortOpen(),openMenu&&close(openMenu)}(0,_jquery.default)('li.main-menu-item > a[aria-haspopup="true"], li#user-menu > a[aria-haspopup="true"]').click((ev=>{ev.currentTarget.parentNode===openMenu?new Date-openTime>closeCooldown&&close(openMenu):open(ev.currentTarget.parentNode)}));let menuitems=(0,_jquery.default)('li.main-menu-item > a[aria-haspopup="true"], li#user-menu > a[aria-haspopup="true"]').parent();menuitems.mouseenter((ev=>{(window.innerWidth>0?window.innerWidth:screen.width)>767&&(ev.currentTarget===openMenu?abortClose():openWithDelay(ev.currentTarget))})),menuitems.mouseleave((ev=>{(window.innerWidth>0?window.innerWidth:screen.width)>767&&(openCandidate&&ev.currentTarget===openCandidate&&abortOpen(),openMenu&&ev.currentTarget===openMenu&&closeWithDelay(ev.currentTarget))})),(0,_jquery.default)('li.sub-menu-item > a[aria-haspopup="true"], li.sub-sub-menu-item > a[aria-haspopup="true"]').click((ev=>{let link=(0,_jquery.default)(ev.currentTarget),item=link.parent();item.toggleClass("open"),link.attr("aria-expanded",item.hasClass("open"))}));let hamburgertoggle=(0,_jquery.default)("#main-menu-hamburger > a"),hamburgerparent=hamburgertoggle.parent();hamburgertoggle.click((()=>{hamburgerparent.toggleClass("open"),hamburgertoggle.attr("aria-expanded",hamburgerparent.hasClass("open"))}));let oneColLayoutBefore=!1,hamburgerLayoutBefore=!1;function updateMaxMenuHeight(){let botPos=(0,_jquery.default)("#menu-bottom").offset().top+16,width=window.innerWidth>0?window.innerWidth:screen.width,oneColLayout=width<=767;oneColLayout?((0,_jquery.default)(".sub-menu-scroll-container").css("max-height",""),(0,_jquery.default)("#main-menu-left").css("max-height",(0,_jquery.default)(window).height()-botPos+"px")):(width<=1080&&(botPos+=50),(0,_jquery.default)(".sub-menu-scroll-container").css("max-height",(0,_jquery.default)(window).height()-botPos+"px"),(0,_jquery.default)("#main-menu-left").css("max-height","")),oneColLayout!==oneColLayoutBefore&&(reset(),oneColLayoutBefore=oneColLayout);let hamburgerLayout=width<=1080;hamburgerLayout!==hamburgerLayoutBefore&&(hamburgertoggle.attr("role",hamburgerLayout?"button":"none"),hamburgerLayoutBefore=hamburgerLayout)}updateMaxMenuHeight(),(0,_jquery.default)(window).resize(updateMaxMenuHeight)})(),function(){const html=(0,_jquery.default)("html"),uselighttheme=(0,_jquery.default)("#user-menu .wwu-uselighttheme"),useostheme=(0,_jquery.default)("#user-menu .wwu-useostheme"),usedarktheme=(0,_jquery.default)("#user-menu .wwu-usedarktheme"),darkThemeClass="dark-theme",lightThemeClass="light-theme";let selected;selected=html.hasClass(darkThemeClass)?usedarktheme:html.hasClass(lightThemeClass)?uselighttheme:useostheme;selected.addClass("selectedtheme"),uselighttheme.click((function(){selected.removeClass("selectedtheme"),html.removeClass(darkThemeClass),html.addClass(lightThemeClass),updateThemePreferenceAjax(1),selected=uselighttheme,selected.addClass("selectedtheme")})),useostheme.click((function(){selected.removeClass("selectedtheme"),html.removeClass(darkThemeClass),html.removeClass(lightThemeClass),updateThemePreferenceAjax(null),selected=useostheme,selected.addClass("selectedtheme")})),usedarktheme.click((function(){selected.removeClass("selectedtheme"),html.addClass(darkThemeClass),html.removeClass(lightThemeClass),updateThemePreferenceAjax(2),selected=usedarktheme,selected.addClass("selectedtheme")}))}()},_jquery=_interopRequireDefault(_jquery),_notification=_interopRequireDefault(_notification)}));

//# sourceMappingURL=menu.min.js.map