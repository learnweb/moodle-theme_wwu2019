{"version":3,"sources":["../../src/format_tiles/edit_course.js"],"names":["scriptname","document","currentScript","getAttribute","require","undef","define","$","Templates","ajax","browserStorage","Notification","str","tileFitter","body","bodyHtml","isMobile","loadingIconHtml","stringStore","windowOverlay","headerOverlay","scrollFuncLock","sectionIsOpen","HEADER_BAR_HEIGHT","reopenLastVisitedSection","backDropZIndex","courseId","resizeLocked","enableCompletion","openTile","Selector","PAGE","TILE","TILEID","MOVEABLE_SECTION","FILTER_BUTTON","TILE_LOADING_ICON","TILE_LOADING_ICON_ID","TILE_COLLAPSED","TILE_CLICKABLE","TILE_SELECTED","TILE_NONSELECTED","TILES","ACTIVITY","SPACER","SECTION_MOVEABLE","SECTION_ID","SECTION_TITLE","SECTION_MAIN","SECTION_BUTTONS","CLOSE_SEC_BTN","HIDE_SEC0_BTN","SECTION_ZERO","MOODLE_VIDEO","LAUNCH_STANDARD","TOOLTIP","HEADER_BAR","MENU_BAR","DROPDOWN_MENU","HIDDEN_TOGGLE","DRAGDROP","MULTI_SECTION_TILE_AREA","SUBTILEDRAGDROP","ClassNames","SELECTED","HEADER_OVERLAY","OPEN","CLOSED","LAUNCH_CM_MODAL","STATE_VISIBLE","Event","CLICK","KEYDOWN","SCROLL","MOUSEDOWN","MOUSEUP","MOUSEMOVE","MOUSEOVER","TOUCHDOWN","TOUCHUP","TOUCHOVER","TOUCHMOVE","CSS","DISPLAY","Z_INDEX","HEIGHT","BG_COLOUR","Keyboard","ESCAPE","TAB","RETURN","headerOverlayFadeInOut","fadeIn","headerBar","find","selector","length","duration","step","css","parseFloat","complete","fadeOut","stopVideoPlaying","section","contentSection","each","index","iframe","attr","mediaPlayers","html","cancelTileSelections","sectionToFocus","sec","is","slideUp","removeClass","focus","setCourseContentHTML","contentArea","content","activities","not","on","e","keyCode","setLastVisitedSection","toClick","currentTarget","hasClass","click","window","location","last","shiftKey","relatedTarget","closest","setTimeout","animate","scrollTop","offset","top","tooltipItems","tooltip","err","log","debug","videoJS","setUp","getCoordinatesFromEvent","event","xcoord","ycoord","type","includes","touch","originalEvent","touches","changedTouches","clientX","clientY","x","y","touchoverdetector","position","object","elementFromPoint","trigger","initializeDragdropSubtiles","page","preventDefault","stopPropagation","button","draggingdrag","dragsubtile","rect","parent","getBoundingClientRect","dimensions","coordinates","dragholo","clone","left","width","height","insertAfter","holocallback","cords","subtilehovercallback","targetsubtile","targetindex","dragindex","before","after","mouseupcallback","off","remove","overlay","hide","dragtarget","show","query","tilelist","cmid","xhttp","XMLHttpRequest","url","M","cfg","wwwroot","data","sesskey","secid","targettile","children","activitylist","append","onreadystatechange","readyState","status","reload","sectionbody","beforeid","nexttile","next","open","send","FITTINGSELECTORS","fitActionMenusForSection","sectionid","forEach","menulist","minX","menu","Math","min","expandSection","tileId","scroll","expandAndScroll","scrollTo","stop","first","iframes","completion","updateTileInformation","holdSectionButtonPosition","buttons","windowTop","desiredNewPositionInSection","outerHeight","addClass","slideDown","reOrgSections","delayBefore","fitTilesToScreenWidth","dfd","Deferred","openedSection","openedSectionNum","reOrgFunc","runReOrg","done","result","resolve","fail","reject","resizeTilesDivWidth","promise","failedLoadSectionNotify","sectionNum","failResult","confirm","sectionerrortitle","sectionerrorstring","refresh","cancel","noconnectionerror","Error","getSectionContentFromServer","call","methodname","args","courseid","setjsusedsession","shadeRGBColor","R","G","B","percent","t","p","r","round","g","b","setOverlay","secNumOnTop","parseInt","tile","substr","existingColour","replace","split","clickItemBehind","clickedItem","BottomElement","clickedTile","setSectionZeroFromUserPref","buttonHideSecZero","sectionZero","storageEnabledLocal","getSecZeroCollapseStatus","populateAndExpandSection","thisTile","dataSection","storedContentExpirySecs","exception","relatedContentArea","getStoredContentAge","response","storageEnabledSession","storeCourseContent","contentAge","getCourseContent","loadingIcon","contentToDisplay","init","courseIdInit","useJavascriptNav","maxContentSectionsToStore","storedContentDeleteMins","useFilterButtons","assumeDataStoreConsent","reopenLastSection","userId","fitTilesToWidth","usingH5pFilter","enableCompletionInit","cleanUpStorage","ready","pageContent","getLastVisitedSection","windowWidth","outerWidth","appendTo","targetelement","target","expanded","menuselector","menuelement","setAttribute","tagName","classList","contains","add","querySelector","dragdrop","pos","originalX","originalY","X","Y","moving","positionUpdate","requestAnimationFrame","tilesecpos","filter","oldpos","get_strings","key","component","results","alert","lineindexes","lastelement","i","element","secindex","j","push","sectionlist","targetdragdrop","nextSecIfExists","storedContentAge","resizeRequired","openContentSection","player","overlayZindex","logorect","getElementById","logoheight","logoy","max","scrollY","addEventListener","clickedLk","setSecZeroCollapseStatus","filterButtons","render","stringKeys","s","cm","markAsAutoCompleteInUI","msg","elem"],"mappings":"AA8BA,GAAIA,CAAAA,UAAU,CAAGC,QAAQ,CAACC,aAAT,CAAuBC,YAAvB,CAAoC,oBAApC,CAAjB,CACA,GAAmB,YAAf,GAAAH,UAAJ,CAAiC,CAC7BI,OAAO,CAACC,KAAR,CAAc,0BAAd,CACH,CACDC,MAAM,CAAC,0BAAD,CAA6B,CAAC,QAAD,CAAW,gBAAX,CAA6B,WAA7B,CAA0C,8BAA1C,CAC3B,mBAD2B,CACN,UADM,CACM,0BADN,CAA7B,CAEF,SAAUC,CAAV,CAAaC,CAAb,CAAwBC,CAAxB,CAA8BC,CAA9B,CAA8CC,CAA9C,CAA4DC,CAA5D,CAAiEC,CAAjE,CAA6E,CACzE,aADyE,GAGrEC,CAAAA,CAAI,CAAGP,CAAC,CAAC,MAAD,CAH6D,CAIrEQ,CAAQ,CAAGR,CAAC,CAAC,YAAD,CAJyD,CAKrES,CALqE,CAMrEC,CANqE,CAOrEC,CAAW,CAAG,EAPuD,CAQrEC,CARqE,CASrEC,CATqE,CAUrEC,CAAc,GAVuD,CAWrEC,CAAa,GAXwD,CAYrEC,CAAiB,CAAG,EAZiD,CAarEC,CAAwB,GAb6C,CAcrEC,CAAc,CAAG,CAdoD,CAerEC,CAfqE,CAgBrEC,CAAY,GAhByD,CAiBrEC,CAjBqE,CAoBrEC,CAAQ,CAAG,CApB0D,CAsBrEC,CAAQ,CAAG,CACXC,IAAI,CAAE,OADK,CAEXC,IAAI,CAAE,OAFK,CAGXC,MAAM,CAAE,QAHG,CAIXC,gBAAgB,CAAE,kBAJP,CAKXC,aAAa,CAAE,eALJ,CAMXC,iBAAiB,CAAE,oBANR,CAOXC,oBAAoB,CAAE,gBAPX,CAQXC,cAAc,CAAE,iBARL,CASXC,cAAc,CAAE,iBATL,CAUXC,aAAa,CAAE,0BAVJ,CAWXC,gBAAgB,CAAE,+BAXP,CAYXC,KAAK,CAAE,UAZI,CAaXC,QAAQ,CAAE,WAbC,CAcXC,MAAM,CAAE,SAdG,CAeXC,gBAAgB,CAAE,kBAfP,CAgBXC,UAAU,CAAE,WAhBD,CAiBXC,aAAa,CAAE,eAjBJ,CAkBXC,YAAY,CAAE,eAlBH,CAmBXC,eAAe,CAAE,iBAnBN,CAoBXC,aAAa,CAAE,kBApBJ,CAqBXC,aAAa,CAAE,iBArBJ,CAsBXC,YAAY,CAAE,YAtBH,CAuBXC,YAAY,CAAE,kCAvBH,CAwBXC,eAAe,CAAE,yCAxBN,CAyBXC,OAAO,CAAE,uBAzBE,CA0BXC,UAAU,CAAE,CAAC,YAAD,CA1BD,CA2BXC,QAAQ,CAAE,UA3BC,CA4BXC,aAAa,CAAE,gBA5BJ,CA6BXC,aAAa,CAAE,kBA7BJ,CA8BXC,QAAQ,CAAE,eA9BC,CA+BXC,uBAAuB,CAAE,sBA/Bd,CAgCXC,eAAe,CAAE,kCAhCN,CAtB0D,CAwDrEC,CAAU,CAAG,CACbC,QAAQ,CAAE,UADG,CAEbC,cAAc,CAAE,gBAFH,CAGbC,IAAI,CAAE,MAHO,CAIbC,MAAM,CAAE,QAJK,CAKbC,eAAe,CAAE,uBALJ,CAMbC,aAAa,CAAE,eANF,CAxDwD,CAiErEC,CAAK,CAAG,CACRC,KAAK,CAAE,OADC,CAERC,OAAO,CAAE,SAFD,CAGRC,MAAM,CAAE,QAHA,CAIRC,SAAS,CAAE,WAJH,CAKRC,OAAO,CAAE,SALD,CAMRC,SAAS,CAAE,WANH,CAORC,SAAS,CAAE,WAPH,CAQRC,SAAS,CAAE,YARH,CASRC,OAAO,CAAE,UATD,CAURC,SAAS,CAAE,WAVH,CAWRC,SAAS,CAAE,WAXH,CAjE6D,CA+ErEC,CAAG,CAAG,CACNC,OAAO,CAAE,SADH,CAENC,OAAO,CAAE,SAFH,CAGNC,MAAM,CAAE,QAHF,CAINC,SAAS,CAAE,kBAJL,CA/E+D,CAqFrEC,CAAQ,CAAG,CACXC,MAAM,CAAE,EADG,CAEXC,GAAG,CAAE,CAFM,CAGXC,MAAM,CAAE,EAHG,CArF0D,CAgGrEC,CAAsB,CAAG,SAASC,CAAT,CAAiB,CAC1C,GAAIxE,CAAa,SAAjB,CAAiC,CAC7B,QACH,CAFD,IAEO,CACH,GAAIyE,CAAAA,CAAS,CAAGtF,CAAC,CAACuB,CAAQ,CAAC0B,UAAT,CAAoBsC,IAApB,CAAyB,SAASC,CAAT,CAAmB,CAC1D,MAA4B,EAArB,CAAAxF,CAAC,CAACwF,CAAD,CAAD,CAAYC,MACtB,CAFiB,CAAD,CAAjB,CAGA,GAAI,KAAAJ,CAAJ,CAAqB,CACjBxE,CAAa,CAACwE,MAAd,CAAqB,CACjBK,QAAQ,CAAE,GADO,CAEjBC,IAAI,CAAE,eAAY,CACdL,CAAS,CAACM,GAAV,CAAc,aAAd,uEACEC,UAAU,CAAgC,CAA/B,CAAAjF,CAAa,CAACgF,GAAd,CAAkB,SAAlB,CAAD,CADZ,OAEAN,CAAS,CAACM,GAAV,CAAc,cAAd,uEACEC,UAAU,CAAgC,CAA/B,CAAAjF,CAAa,CAACgF,GAAd,CAAkB,SAAlB,CAAD,CADZ,MAEH,CAPgB,CAQjBE,QAAQ,CAAE,mBAAY,CAClBR,CAAS,CAACM,GAAV,CAAc,aAAd,wCACAN,CAAS,CAACM,GAAV,CAAc,cAAd,uCACH,CAXgB,CAArB,CAaH,CAdD,IAcO,CACH/E,CAAa,CAACkF,OAAd,CAAsB,CAClBL,QAAQ,CAAE,GADQ,CAElBC,IAAI,CAAE,eAAY,CACdL,CAAS,CAACM,GAAV,CAAc,aAAd,uEACEC,UAAU,CAAgC,CAA/B,CAAAjF,CAAa,CAACgF,GAAd,CAAkB,SAAlB,CAAD,CADZ,OAEAN,CAAS,CAACM,GAAV,CAAc,cAAd,uEACEC,UAAU,CAAgC,CAA/B,CAAAjF,CAAa,CAACgF,GAAd,CAAkB,SAAlB,CAAD,CADZ,MAEH,CAPiB,CAQlBE,QAAQ,CAAE,mBAAY,CAClBR,CAAS,CAACM,GAAV,CAAc,aAAd,sCACAN,CAAS,CAACM,GAAV,CAAc,cAAd,qCACH,CAXiB,CAAtB,CAaH,CACD,QACH,CACJ,CAtIwE,CA6IrEI,CAAgB,CAAG,SAASC,CAAT,CAAkB,CACrC,GAAIC,CAAAA,CAAc,CAAGlG,CAAC,CAACuB,CAAQ,CAACgB,UAAT,CAAsB0D,CAAvB,CAAtB,CAGAC,CAAc,CAACX,IAAf,CAAoB,QAApB,EAA8BY,IAA9B,CAAmC,SAAUC,CAAV,CAAiBC,CAAjB,CAAyB,CACxDA,CAAM,CAAGrG,CAAC,CAACqG,CAAD,CAAV,CAEA,GAAIA,CAAM,CAACC,IAAP,CAAY,KAAZ,CAAJ,CAAwB,CACpBD,CAAM,CAACC,IAAP,CAAY,UAAZ,CAAwBD,CAAM,CAACC,IAAP,CAAY,KAAZ,CAAxB,EACAD,CAAM,CAACC,IAAP,CAAY,KAAZ,CAAmB,EAAnB,CACH,CACJ,CAPD,EAUA,GAAIC,CAAAA,CAAY,CAAGL,CAAc,CAACX,IAAf,CAAoBhE,CAAQ,CAACuB,YAA7B,CAAnB,CACA,GAA0B,CAAtB,CAAAyD,CAAY,CAACd,MAAjB,CAA6B,CACzBS,CAAc,CAACM,IAAf,CAAoB,EAApB,CACH,CACJ,CA/JwE,CAsKrEC,CAAoB,CAAG,SAAUC,CAAV,CAA0B,CACjD1G,CAAC,CAACuB,CAAQ,CAACI,gBAAV,CAAD,CAA6BwE,IAA7B,CAAkC,SAAUC,CAAV,CAAiBO,CAAjB,CAAsB,CACpDA,CAAG,CAAG3G,CAAC,CAAC2G,CAAD,CAAP,CACA,GAAIA,CAAG,CAACC,EAAJ,CAAO,UAAP,CAAJ,CAAwB,CACpBZ,CAAgB,CAACW,CAAG,CAACL,IAAJ,CAAS,cAAT,CAAD,CAAhB,CACAK,CAAG,CAACE,OAAJ,GAAcC,WAAd,CAA0BtD,CAAU,CAACM,aAArC,CACH,CACJ,CAND,EAOA9D,CAAC,CAACuB,CAAQ,CAACE,IAAV,CAAD,CAAiBqF,WAAjB,CAA6BtD,CAAU,CAACC,QAAxC,EAAkDmC,GAAlD,CAAsDjB,CAAG,CAACE,OAA1D,CAAmE,EAAnE,EAAuEe,GAAvE,CAA2EjB,CAAG,CAACI,SAA/E,CAA0F,EAA1F,EACA/E,CAAC,CAAC,YAAcwD,CAAU,CAACC,QAA1B,CAAD,CAAqCqD,WAArC,CAAiDtD,CAAU,CAACC,QAA5D,EAAsEmC,GAAtE,CAA0EjB,CAAG,CAACE,OAA9E,CAAuF,EAAvF,EACAjE,CAAa,CAACmF,OAAd,CAAsB,GAAtB,EACAX,CAAsB,IAAtB,CACA,GAAIsB,CAAc,SAAd,EAAmD,CAAnB,GAAAA,CAApC,CAA0D,CACtD1G,CAAC,CAACuB,CAAQ,CAACG,MAAT,CAAkBgF,CAAnB,CAAD,CAAoCK,KAApC,EACH,CACD/G,CAAC,CAACuB,CAAQ,CAACM,iBAAV,CAAD,CAA8BkE,OAA9B,CAAsC,GAAtC,CAA2C,UAAY,CACnD/F,CAAC,CAACuB,CAAQ,CAACM,iBAAV,CAAD,CAA8B2E,IAA9B,CAAmC,EAAnC,CACH,CAFD,EAGAzF,CAAa,GAAb,CACAO,CAAQ,CAAG,CACd,CA1LwE,CAkMrE0F,CAAoB,CAAG,SAAUC,CAAV,CAAuBC,CAAvB,CAAgC,CACvD,GAAIA,CAAJ,CAAa,CACTD,CAAW,CAACT,IAAZ,CAAiBU,CAAjB,EACAlH,CAAC,CAACuB,CAAQ,CAACM,iBAAV,CAAD,CAA8BkE,OAA9B,CAAsC,GAAtC,CAA2C,UAAY,CACnD/F,CAAC,CAACuB,CAAQ,CAACM,iBAAV,CAAD,CAA8B2E,IAA9B,CAAmC,EAAnC,CACH,CAFD,EAIA,GAAIS,CAAW,CAACX,IAAZ,CAAiB,IAAjB,IAA2B/E,CAAQ,CAACsB,YAAxC,CAAsD,CAMlD,GAAIsE,CAAAA,CAAU,CAAGF,CAAW,CAAC1B,IAAZ,CAAiBhE,CAAQ,CAACa,QAA1B,EAAoCgF,GAApC,CAAwC7F,CAAQ,CAACc,MAAjD,CAAjB,CACA4E,CAAW,CAACI,EAAZ,CAAetD,CAAK,CAACE,OAArB,CAA8B,SAAUqD,CAAV,CAAa,CACvC,GAAIA,CAAC,CAACC,OAAF,GAAcvC,CAAQ,CAACC,MAA3B,CAAmC,CAE/B9E,CAAc,CAACqH,qBAAf,CAAqC,CAArC,EACAf,CAAoB,CAAC,CAAD,CAApB,CACAzG,CAAC,CAACuB,CAAQ,CAACG,MAAT,CAAkBuF,CAAW,CAACX,IAAZ,CAAiB,cAAjB,CAAnB,CAAD,CAAsDS,KAAtD,EACH,CACJ,CAPD,EAQAI,CAAU,CAACE,EAAX,CAActD,CAAK,CAACE,OAApB,CAA6B,SAAUqD,CAAV,CAAa,CACtC,GAAIA,CAAC,CAACC,OAAF,GAAcvC,CAAQ,CAACG,MAA3B,CAAmC,CAC/B,GAAIsC,CAAAA,CAAO,CAAGzH,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAD,CAAmBnC,IAAnB,CAAwB,GAAxB,CAAd,CACA,GAAIkC,CAAO,CAACE,QAAR,CAAiBnE,CAAU,CAACK,eAA5B,CAAJ,CAAkD,CAC9C4D,CAAO,CAACG,KAAR,EACH,CAFD,IAEO,IAAIH,CAAO,CAACnB,IAAR,CAAa,MAAb,UAAJ,CAAwC,CAC3CuB,MAAM,CAACC,QAAP,CAAkBL,CAAO,CAACnB,IAAR,CAAa,MAAb,CACrB,CACJ,CACJ,CATD,EAUA,GAAI,CAAC7F,CAAL,CAAe,CACX0G,CAAU,CAACY,IAAX,GAAkBV,EAAlB,CAAqBtD,CAAK,CAACE,OAA3B,CAAoC,SAAUqD,CAAV,CAAa,CAC7C,GAAIA,CAAC,CAACC,OAAF,GAAcvC,CAAQ,CAACE,GAAvB,EAA8B,CAACoC,CAAC,CAACU,QAAjC,EACGhI,CAAC,CAACsH,CAAC,CAACW,aAAH,CAAD,CAAmBC,OAAnB,CAA2B3G,CAAQ,CAACkB,YAApC,EAAkD6D,IAAlD,CAAuD,IAAvD,IAAiEW,CAAW,CAACX,IAAZ,CAAiB,IAAjB,CADxE,CACgG,CAI5F6B,UAAU,CAAC,UAAY,CAEnBlB,CAAW,CAAC1B,IAAZ,CAAiBhE,CAAQ,CAACiB,aAA1B,EAAyCuE,KAAzC,GACAvG,CAAQ,CAAC4H,OAAT,CAAiB,CAACC,SAAS,CAAEpB,CAAW,CAACqB,MAAZ,GAAqBC,GAArB,CAA2BvH,CAAvC,CAAjB,CAA4E,MAA5E,EACAiG,CAAW,CAAC1B,IAAZ,CAAiB,iBAAjB,EAAoCK,GAApC,CAAwC,KAAxC,CAA+C,EAA/C,CACH,CALS,CAKP,GALO,CAMb,CACJ,CAbD,EAcAqB,CAAW,CAAC1B,IAAZ,CAAiBhE,CAAQ,CAACiB,aAA1B,EAAyC6E,EAAzC,CAA4CtD,CAAK,CAACE,OAAlD,CAA2D,SAAUqD,CAAV,CAAa,CACpE,GAAIA,CAAC,CAACC,OAAF,GAAcvC,CAAQ,CAACE,GAAvB,EAA8BoC,CAAC,CAACU,QAAhC,EACGhI,CAAC,CAACsH,CAAC,CAACW,aAAH,CAAD,CAAmBC,OAAnB,CAA2B3G,CAAQ,CAACkB,YAApC,EAAkD6D,IAAlD,CAAuD,IAAvD,IAAiEW,CAAW,CAACX,IAAZ,CAAiB,IAAjB,CADxE,CACgG,CAI5F6B,UAAU,CAAC,UAAY,CACnBhB,CAAU,CAACY,IAAX,GAAkBhB,KAAlB,EACH,CAFS,CAEP,GAFO,CAGb,CACJ,CAVD,CAWH,CACJ,CAED,GAAI,CAACtG,CAAL,CAAe,CAEX0H,UAAU,CAAC,UAAY,CAEnB,GAAI,CACA,GAAMK,CAAAA,CAAY,CAAGvB,CAAW,CAAC1B,IAAZ,CAAiB,mDAAjB,CAArB,CACA,GAA0B,CAAtB,CAAAiD,CAAY,CAAC/C,MAAjB,CAA6B,CACzB+C,CAAY,CAACC,OAAb,EACH,CACJ,CAAC,MAAOC,CAAP,CAAY,CACV7I,OAAO,CAAC,CAAC,UAAD,CAAD,CAAe,SAAS8I,CAAT,CAAc,CAChCA,CAAG,CAACC,KAAJ,CAAUF,CAAV,CACH,CAFM,CAGV,CACJ,CAZS,CAYP,GAZO,CAab,CAED,GAAuD,CAAnD,GAAAzB,CAAW,CAAC1B,IAAZ,CAAiBhE,CAAQ,CAACuB,YAA1B,EAAwC2C,MAA5C,CAA0D,CACtD5F,OAAO,CAAC,CAAC,sBAAD,CAAD,CAA2B,SAASgJ,CAAT,CAAkB,CAChDA,CAAO,CAACC,KAAR,EACH,CAFM,CAGV,CAED,QACH,CACD,QACH,CAzRwE,CA8RrEC,CAAuB,CAAG,SAASC,CAAT,CAAgB,IACtCC,CAAAA,CADsC,CAEtCC,CAFsC,CAG1C,GAAIF,CAAK,CAACG,IAAN,CAAWC,QAAX,CAAoB,OAApB,CAAJ,CAAkC,CAC9B,GAAIC,CAAAA,CAAK,CAAGL,CAAK,CAACM,aAAN,CAAoBC,OAApB,CAA4B,CAA5B,GAAkCP,CAAK,CAACM,aAAN,CAAoBE,cAApB,CAAmC,CAAnC,CAA9C,CACAP,CAAM,CAAGI,CAAK,CAACI,OAAf,CACAP,CAAM,CAAGG,CAAK,CAACK,OAClB,CAJD,IAIO,IAAIV,CAAK,CAACG,IAAN,CAAWC,QAAX,CAAoB,OAApB,CAAJ,CAAkC,CACrCH,CAAM,CAAGD,CAAK,CAACS,OAAf,CACAP,CAAM,CAAGF,CAAK,CAACU,OAClB,CACD,MAAO,CACHC,CAAC,CAAEV,CADA,CAEHW,CAAC,CAAEV,CAFA,CAIV,CA7SwE,CAkTrEW,CAAiB,CAAG,SAAUvC,CAAV,CAAa,IAC7BwC,CAAAA,CAAQ,CAAGf,CAAuB,CAACzB,CAAD,CADL,CAE7ByC,CAAM,CAAGrK,QAAQ,CAACsK,gBAAT,CAA0BF,CAAQ,CAACH,CAAnC,CAAsCG,CAAQ,CAACF,CAA/C,CAFoB,CAGjC5J,CAAC,CAAC+J,CAAD,CAAD,CAAUE,OAAV,CAAkBlG,CAAK,CAACU,SAAxB,CAAmC6C,CAAnC,CACH,CAtTwE,CA2TrE4C,CAA0B,CAAG,UAAW,CAExClK,CAAC,CAAC,MAAD,CAAD,CAAUqH,EAAV,CAAatD,CAAK,CAACW,SAAnB,CAA8BnD,CAAQ,CAACa,QAAvC,CAAiDyH,CAAjD,EACA,GAAIM,CAAAA,CAAI,CAAGnK,CAAC,CAAC,eAAD,CAAZ,CACAmK,CAAI,CAAC9C,EAAL,CAAQtD,CAAK,CAACI,SAAN,CAAkB,GAAlB,CAAwBJ,CAAK,CAACQ,SAAtC,CAAiDhD,CAAQ,CAACgC,eAA1D,CAA2E,SAAU+D,CAAV,CAAa,CACpFA,CAAC,CAAC8C,cAAF,GACA9C,CAAC,CAAC+C,eAAF,GACA,GAAI/C,CAAC,CAACgD,MAAF,EAAY,CAAChD,CAAC,CAAC6B,IAAH,GAAYpF,CAAK,CAACS,OAAlC,CAA2C,CAEvC,MACH,CANmF,GAOhF+F,CAAAA,CAAY,CAAGjD,CAAC,CAACI,aAP+D,CAQhF8C,CAAW,CAAGxK,CAAC,CAACuK,CAAD,CAAD,CAAgBrC,OAAhB,CAAwB3G,CAAQ,CAACa,QAAjC,CARkE,CAShFqI,CAAI,CAAGD,CAAW,CAACE,MAAZ,GAAqB,CAArB,EAAwBC,qBAAxB,EATyE,CAUhFC,CAAU,CAAGJ,CAAW,CAAC,CAAD,CAAX,CAAeG,qBAAf,EAVmE,CAWhFE,CAAW,CAAG9B,CAAuB,CAACzB,CAAD,CAX2C,CAYhFwD,CAAQ,CAAGN,CAAW,CAACO,KAAZ,KAAwBnF,GAAxB,CAA4B,SAA5B,CAAuC,KAAvC,EACVA,GADU,CACN,UADM,CACM,UADN,EAEVA,GAFU,CAEN,MAFM,CAEEiF,CAAW,CAAClB,CAAZ,CAAgBc,CAAI,CAACO,IAArB,CAA4B,CAA5B,CAAgC,IAFlC,EAGVpF,GAHU,CAGN,KAHM,CAGCiF,CAAW,CAACjB,CAAZ,CAAgBa,CAAI,CAAClC,GAArB,CAA2B,CAA3B,CAA+B,IAHhC,EAIV3C,GAJU,CAIN,gBAJM,CAIY,MAJZ,EAKVA,GALU,CAKN,OALM,CAKGgF,CAAU,CAACK,KALd,EAMVrF,GANU,CAMN,QANM,CAMIgF,CAAU,CAACM,MANf,EAOV5E,IAPU,CAOL,IAPK,CAOC,UAPD,CAZqE,CAoBpFwE,CAAQ,CAACK,WAAT,CAAqBX,CAArB,EApBoF,GAqBhFY,CAAAA,CAAY,CAAG,SAAU9D,CAAV,CAAa,IACxB+D,CAAAA,CAAK,CAAGtC,CAAuB,CAACzB,CAAD,CADP,CAExBmD,CAAI,CAAGK,CAAQ,CAACJ,MAAT,GAAkB,CAAlB,EAAqBC,qBAArB,EAFiB,CAG5BG,CAAQ,CAAClF,GAAT,CAAa,MAAb,CAAqByF,CAAK,CAAC1B,CAAN,CAAUc,CAAI,CAACO,IAAf,CAAsB,CAAtB,CAA0B,IAA/C,EACKpF,GADL,CACS,KADT,CACgByF,CAAK,CAACzB,CAAN,CAAUa,CAAI,CAAClC,GAAf,CAAqB,CAArB,CAAyB,IADzC,CAEH,CA1BmF,CA2BhF+C,CAAoB,CAAG,SAAUhE,CAAV,CAAa,IAChCiE,CAAAA,CAAa,CAAGvL,CAAC,CAACsH,CAAC,CAACI,aAAH,CADe,CAEhC8D,CAAW,CAAGD,CAAa,CAACnF,KAAd,EAFkB,CAGhCqF,CAAS,CAAGjB,CAAW,CAACpE,KAAZ,EAHoB,CAIpC,GAAIoF,CAAW,GAAKC,CAApB,CAA+B,CAE9B,CAFD,IAEO,IAAID,CAAW,CAAGC,CAAlB,CAA6B,CAChCF,CAAa,CAACG,MAAd,CAAqBlB,CAArB,CACH,CAFM,IAEA,CACHe,CAAa,CAACI,KAAd,CAAoBnB,CAApB,CACH,CACJ,CAtCmF,CAuChFoB,CAAe,CAAG,SAAUtE,CAAV,CAAa,CAC/B,GAAIA,CAAC,CAACgD,MAAF,EAAY,CAAChD,CAAC,CAAC6B,IAAH,GAAYpF,CAAK,CAACS,OAAlC,CAA2C,CAEvC,MACH,CACDxE,CAAC,CAAC,MAAD,CAAD,CAAU6L,GAAV,CAAc9H,CAAK,CAACK,OAAN,CAAgB,GAAhB,CAAsBL,CAAK,CAACS,OAA1C,CAAmDoH,CAAnD,EACA5L,CAAC,CAAC,MAAD,CAAD,CAAU6L,GAAV,CAAc9H,CAAK,CAACM,SAAN,CAAkB,GAAlB,CAAwBN,CAAK,CAACW,SAA5C,CAAuD0G,CAAvD,EACApL,CAAC,CAAC,WAAD,CAAD,CAAe8L,MAAf,GACA3B,CAAI,CAAC0B,GAAL,CAAS9H,CAAK,CAACO,SAAN,CAAkB,GAAlB,CAAwBP,CAAK,CAACU,SAAvC,CAAkDlD,CAAQ,CAACa,QAA3D,CAAqEkJ,CAArE,EAEA,GAAIS,CAAAA,CAAO,CAAGnL,CAAa,CAACgG,EAAd,CAAiB,UAAjB,CAAd,CACA,GAAImF,CAAJ,CAAa,CACTnL,CAAa,CAACoL,IAAd,EACH,CAb8B,GAc3BX,CAAAA,CAAK,CAAGtC,CAAuB,CAACzB,CAAD,CAdJ,CAe3B2E,CAAU,CAAGjM,CAAC,CAACN,QAAQ,CAACsK,gBAAT,CAA0BqB,CAAK,CAAC1B,CAAhC,CAAmC0B,CAAK,CAACzB,CAAzC,CAAD,CAfa,CAgB/B,GAAImC,CAAJ,CAAa,CACTnL,CAAa,CAACsL,IAAd,EACH,CACD,GAAIC,CAAAA,CAAK,CAAG,sBAAZ,CACA,GAAIJ,CAAJ,CAAa,CACTI,CAAK,EAAI,cACZ,CAtB8B,GAuB3BC,CAAAA,CAAQ,CAAGH,CAAU,CAAC/D,OAAX,CAAmBiE,CAAnB,CAvBgB,CAwB3BE,CAAI,CAAG7B,CAAW,CAAClE,IAAZ,CAAiB,WAAjB,CAxBoB,CAyB3BgG,CAAK,CAAG,GAAIC,CAAAA,cAzBe,CA0B3BC,CAAG,CAAGC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,kBA1BK,CA2B3BC,CAAI,CAAG,YAAcH,CAAC,CAACC,GAAF,CAAMG,OAApB,CAA8B,YAA9B,CAA6C1L,CAA7C,CACL,gCADK,CAC8BkL,CA5BV,CA6B3BS,CA7B2B,CA8B/B,GAAsB,CAAlB,CAAAV,CAAQ,CAAC3G,MAAb,CAAyB,CACrB,GAAIsH,CAAAA,CAAU,CAAG/M,CAAC,CAACoM,CAAQ,CAAC,CAAD,CAAT,CAAlB,CACAU,CAAK,CAAG9M,CAAC,CAACuB,CAAQ,CAAC+B,uBAAV,CAAD,CAAoC0J,QAApC,CAA6C,OAA7C,EAAsD5G,KAAtD,CAA4D2G,CAA5D,EAA0E,CAAlF,CACAH,CAAI,EAAI,cAAgBE,CAAxB,CACAF,CAAI,EAAI,aAAR,CACA,GAAIK,CAAAA,CAAY,CAAGjN,CAAC,CAAC,YAAc8M,CAAf,CAAD,CAAuBvH,IAAvB,CAA4B,YAA5B,CAAnB,CACA0H,CAAY,CAACC,MAAb,CAAoB1C,CAApB,EACA8B,CAAK,CAACa,kBAAN,CAA2B,UAAY,CACnC,GAAuB,CAAnB,OAAKC,UAAL,EAAuC,GAAf,OAAKC,MAAjC,CAAgD,CAC5CxF,MAAM,CAACC,QAAP,CAAgBwF,MAAhB,IACH,CACJ,CACJ,CAZD,IAYO,CACH,GAAIC,CAAAA,CAAW,CAAG/C,CAAW,CAACtC,OAAZ,CAAoB,eAApB,CAAlB,CACA,GAA0B,CAAtB,EAACqF,CAAW,CAAC9H,MAAjB,CAA6B,CACzB,MACH,CACDqH,CAAK,CAAGS,CAAW,CAACjH,IAAZ,CAAiB,cAAjB,CAAR,CALG,GAMCkH,CAAAA,CAAQ,CAAG,CANZ,CAOCC,CAAQ,CAAGjD,CAAW,CAACkD,IAAZ,EAPZ,CAQH,GAAsB,CAAlB,CAAAD,CAAQ,CAAChI,MAAb,CAAyB,CACrB+H,CAAQ,CAAGC,CAAQ,CAACnH,IAAT,CAAc,WAAd,CACd,CACDsG,CAAI,EAAI,cAAgBE,CAAxB,CACAF,CAAI,EAAI,aAAeY,CAC1B,CACDlB,CAAK,CAACqB,IAAN,CAAW,KAAX,CAAkBnB,CAAG,CAAGI,CAAxB,EACAN,CAAK,CAACsB,IAAN,EACH,CAjGmF,CAkGpFzD,CAAI,CAAC9C,EAAL,CAAQtD,CAAK,CAACO,SAAN,CAAkB,GAAlB,CAAwBP,CAAK,CAACU,SAAtC,CAAiDlD,CAAQ,CAACa,QAA1D,CAAoEkJ,CAApE,EACAtL,CAAC,CAAC,MAAD,CAAD,CAAUqH,EAAV,CAAatD,CAAK,CAACK,OAAN,CAAgB,GAAhB,CAAsBL,CAAK,CAACS,OAAzC,CAAkDoH,CAAlD,EACA5L,CAAC,CAAC,MAAD,CAAD,CAAUqH,EAAV,CAAatD,CAAK,CAACM,SAAN,CAAkB,GAAlB,CAAwBN,CAAK,CAACW,SAA3C,CAAsD0G,CAAtD,CACH,CArGD,CAsGH,CArawE,CAuarEyC,CAAgB,CAAG,CAAC,cAAD,CAvakD,CA4arEC,CAAwB,CAAG,SAAUC,CAAV,CAAqB,CAChD,GAAI9H,CAAAA,CAAO,CAAGjG,CAAC,CAAC,YAAc+N,CAAf,CAAf,CACAF,CAAgB,CAACG,OAAjB,CAAyB,SAAUxI,CAAV,CAAoB,IACrCyI,CAAAA,CAAQ,CAAGhI,CAAO,CAACV,IAAR,CAAaC,CAAb,CAD0B,CAErC0I,CAAI,CAAGD,CAAQ,CAAC,CAAD,CAAR,CAAYtD,qBAAZ,GAAoChB,CAFN,CAGzCsE,CAAQ,CAAC9H,IAAT,CAAc,SAAUC,CAAV,CAAiB+H,CAAjB,CAAuB,CACjCD,CAAI,CAAGE,IAAI,CAACC,GAAL,CAASF,CAAI,CAACxD,qBAAL,GAA6BhB,CAAtC,CAAyCuE,CAAzC,CACV,CAFD,EAGAD,CAAQ,CAAC9H,IAAT,CAAc,SAASC,CAAT,CAAgB+H,CAAhB,CAAsB,CAChCnO,CAAC,CAACmO,CAAD,CAAD,CAAQvI,GAAR,CAAY,cAAZ,CAA4B,CAA5B,EACA5F,CAAC,CAACmO,CAAD,CAAD,CAAQvI,GAAR,CAAY,cAAZ,CAA4BuI,CAAI,CAACxD,qBAAL,GAA6BhB,CAA7B,CAAiCuE,CAA7D,CACH,CAHD,EAIA,QACH,CAXD,CAYH,CA1bwE,CAkcrEI,CAAa,CAAG,SAAUrH,CAAV,CAAuBsH,CAAvB,CAA+BC,CAA/B,CAAuC,IACnDC,CAAAA,CAAe,CAAG,UAAY,CAG9B,GAAIC,CAAAA,CAAQ,CAAG1O,CAAC,CAAC,SAAWuO,CAAZ,CAAD,CAAqBjG,MAArB,GAA8BC,GAA9B,CAAoCvH,CAAnD,CACA,GAAI0N,CAAQ,GAAK1O,CAAC,CAAC6H,MAAD,CAAD,CAAUQ,SAA3B,CAAsC,CAGlCqG,CAAQ,EAAI,CACf,CACDzH,CAAW,CAAC1B,IAAZ,CAAiBhE,CAAQ,CAACiB,aAA1B,EAAyCuE,KAAzC,GAGAxG,CAAI,CAAC8G,EAAL,oEAAgB,UAAY,CACxB9G,CAAI,CAACoO,IAAL,EACH,CAFD,EAGA,GAAIH,CAAJ,CAAY,CACRhO,CAAQ,CAAC4H,OAAT,CAAiB,CAACC,SAAS,CAAEqG,CAAZ,CAAjB,CAAwC,MAAxC,CAAgD,UAAY,CAExDlO,CAAQ,CAACqL,GAAT,oEAAqB,UAAY,CAC7BrL,CAAQ,CAACmO,IAAT,EACH,CAFD,CAGH,CALD,CAMH,CACD5N,CAAa,GAAb,CACAO,CAAQ,CAAGiN,CAAX,CAGAtH,CAAW,CAAC1B,IAAZ,CAAiBhE,CAAQ,CAACa,QAA1B,EAAoCwM,KAApC,GAA4C7H,KAA5C,GAIA,GAAM8H,CAAAA,CAAO,CAAG5H,CAAW,CAAC1B,IAAZ,CAAiB,QAAjB,CAAhB,CACA,GAAqB,CAAjB,CAAAsJ,CAAO,CAACpJ,MAAZ,CAAwB,CACpBoJ,CAAO,CAAC1I,IAAR,CAAa,SAAUC,CAAV,CAAiBC,CAAjB,CAAyB,CAClCA,CAAM,CAAGrG,CAAC,CAACqG,CAAD,CAAV,CAEA,GAA2B,EAAvB,GAAAA,CAAM,CAACC,IAAP,CAAY,KAAZ,GAA6BD,CAAM,CAACC,IAAP,CAAY,UAAZ,UAAjC,CAAwE,CACpED,CAAM,CAACC,IAAP,CAAY,KAAZ,CAAmBD,CAAM,CAACC,IAAP,CAAY,UAAZ,CAAnB,CACH,CACJ,CAND,EAQA,GAAIjF,CAAJ,CAAsB,CAGlBxB,OAAO,CAAC,CAAC,yBAAD,CAAD,CAA8B,SAAUiP,CAAV,CAAsB,CACvD3G,UAAU,CAAC,UAAM,CACb2G,CAAU,CAACC,qBAAX,EACH,CAFS,CAEP,GAFO,CAGb,CAJM,CAKV,CACJ,CACJ,CApDsD,CAyDnDC,CAAyB,CAAG,UAAY,CACxC,GAAIC,CAAAA,CAAO,CAAGhI,CAAW,CAAC1B,IAAZ,CAAiBhE,CAAQ,CAACmB,eAA1B,CAAd,CACA1C,CAAC,CAAC6H,MAAD,CAAD,CAAUR,EAAV,CAAatD,CAAK,CAACG,MAAnB,CAA2B,UAAY,CACnC,GAAI,CAACpD,CAAD,EAAmBC,CAAvB,CAAsC,CAClCD,CAAc,GAAd,CACAmO,CAAO,CAAClJ,OAAR,CAAgB,GAAhB,EACAoC,UAAU,CAAC,UAAY,IACf+G,CAAAA,CAAS,CAAGlP,CAAC,CAAC6H,MAAD,CAAD,CAAUQ,SAAV,EADG,CAEf8G,CAA2B,CAAID,CAAS,CAAGjI,CAAW,CAACqB,MAAZ,GAAqBC,GAAjC,CAAuC,EAFvD,CAGnB,GAAkC,CAA9B,CAAA4G,CAA2B,EACxBA,CAA2B,CAAGlI,CAAW,CAACmI,WAAZ,GAA4B,GADjE,CACsE,CAClED,CAA2B,CAAID,CAAS,CAAGjI,CAAW,CAACqB,MAAZ,GAAqBC,GAAjC,CAAuC,EAAtE,CACA0G,CAAO,CAACrJ,GAAR,CAAY,KAAZ,CAAmBuJ,CAAnB,EACA,GAAuC,MAAnC,GAAAvO,CAAa,CAACgF,GAAd,CAAkBjB,CAAG,CAACC,OAAtB,CAAJ,CAA+C,CAC3ChE,CAAa,CAACyE,MAAd,CAAqB,GAArB,EACAD,CAAsB,IACzB,CACJ,CARD,IAQO,IAAkC,CAA9B,CAAA+J,CAAJ,CAAqC,CACxCF,CAAO,CAACrJ,GAAR,CAAY,KAAZ,CAAmB,CAAnB,CACH,CACD,GAAIsJ,CAAS,CAAGjI,CAAW,CAACqB,MAAZ,GAAqBC,GAArB,CAA2BtB,CAAW,CAACmI,WAAZ,EAA3B,CAAuD,EAAvE,CAA2E,CAEvE,GAAuC,OAAnC,GAAAxO,CAAa,CAACgF,GAAd,CAAkBjB,CAAG,CAACC,OAAtB,CAAJ,CAAgD,CAC5ChE,CAAa,CAACmF,OAAd,CAAsB,GAAtB,EACAX,CAAsB,IACzB,CACD6J,CAAO,CAACrJ,GAAR,CAAY,KAAZ,CAAmB,CAAnB,CACH,CAPD,IAOO,IAAIqB,CAAW,CAACqB,MAAZ,GAAqBC,GAArB,CAA2B2G,CAAS,CAAGlP,CAAC,CAAC6H,MAAD,CAAD,CAAUuH,WAAV,EAA3C,CAAoE,CAEvE,GAAuC,OAAnC,GAAAxO,CAAa,CAACgF,GAAd,CAAkBjB,CAAG,CAACC,OAAtB,CAAJ,CAAgD,CAC5ChE,CAAa,CAACmF,OAAd,CAAsB,GAAtB,EACAX,CAAsB,IACzB,CACD6J,CAAO,CAACrJ,GAAR,CAAY,KAAZ,CAAmB,CAAnB,CACH,CAPM,IAOA,IAAuC,MAAnC,GAAAhF,CAAa,CAACgF,GAAd,CAAkBjB,CAAG,CAACC,OAAtB,CAAJ,CAA+C,CAClDhE,CAAa,CAACyE,MAAd,CAAqB,GAArB,EACAD,CAAsB,IACzB,CACD6J,CAAO,CAAC5J,MAAR,CAAe,GAAf,CAAoB,UAAY,CAE5BvE,CAAc,GACjB,CAHD,CAIH,CApCS,CAoCP,GApCO,CAqCb,CACJ,CA1CD,EA2CA,GAAI,CAACA,CAAD,EAAmB,CAACC,CAApB,EAAqCH,CAAa,CAACgG,EAAd,CAAiB,UAAjB,CAAzC,CAAuE,CACnEhG,CAAa,CAACmF,OAAd,CAAsB,GAAtB,CACH,CACJ,CAzGsD,CA0GvDkB,CAAW,CAACoI,QAAZ,CAAqB7L,CAAU,CAACM,aAAhC,EACAmD,CAAW,CAACqI,SAAZ,CAAsB,GAAtB,CAA2B,QAA3B,CAAqC,UAAY,CAE7Cb,CAAe,GACfO,CAAyB,EAC5B,CAJD,EAKA1N,CAAQ,CAAGiN,CACd,CAnjBwE,CA8jBrEgB,CAAa,CAAG,SAAUC,CAAV,CAAuBC,CAAvB,CAA8C,IAC1DC,CAAAA,CAAG,CAAG,GAAI1P,CAAAA,CAAC,CAAC2P,QAD8C,CAE1DC,CAAa,CAAG5P,CAAC,CAAC,0BAAD,CAFyC,CAG1D6P,CAAgB,CAAG,CAHuC,CAI9D,GAA2B,CAAvB,CAAAD,CAAa,CAACnK,MAAlB,CAA8B,CAC1BoK,CAAgB,CAAGD,CAAa,CAACtJ,IAAd,CAAmB,cAAnB,CAAnB,CACAG,CAAoB,EACvB,CACD,GAAIqJ,CAAAA,CAAS,CAAG,SAASN,CAAT,CAAsB,CAClClP,CAAU,CAACyP,QAAX,CAAoBP,CAApB,EACKQ,IADL,CACU,SAASC,CAAT,CAAiB,CACnB,GAAyB,CAArB,GAAAJ,CAAJ,CAA4B,CACxBvB,CAAa,CAACsB,CAAD,CAAgBC,CAAhB,CAChB,CACDH,CAAG,CAACQ,OAAJ,CAAYD,CAAZ,CACH,CANL,EAOKE,IAPL,CAOU,SAASF,CAAT,CAAiB,CACnB,GAAyB,CAArB,GAAAJ,CAAJ,CAA4B,CACxBvB,CAAa,CAACsB,CAAD,CAAgBC,CAAhB,CAChB,CACDH,CAAG,CAACU,MAAJ,CAAWH,CAAX,CACH,CAZL,CAaH,CAdD,CAgBA,GAAIR,CAAJ,CAA2B,CACvBtH,UAAU,CAAC,UAAW,CAClB7H,CAAU,CAAC+P,mBAAX,CAA+BlP,CAA/B,EAAyC6O,IAAzC,CAA8C,UAAW,CACrDF,CAAS,IACZ,CAFD,CAEGN,CAFH,CAGH,CAJS,CAMb,CAPD,IAOO,CACHM,CAAS,CAACN,CAAD,CACZ,CACD,MAAOE,CAAAA,CAAG,CAACY,OAAJ,EACV,CAjmBwE,CAmmBrEC,CAAuB,CAAG,SAASC,CAAT,CAAqBC,CAArB,CAAiCxJ,CAAjC,CAA8C,CACxE,GAAIwJ,CAAJ,CAAgB,CAGZrQ,CAAY,CAACsQ,OAAb,CACI/P,CAAW,CAACgQ,iBADhB,CAEIhQ,CAAW,CAACiQ,kBAFhB,CAGIjQ,CAAW,CAACkQ,OAHhB,CAIIlQ,CAAW,CAACmQ,MAJhB,CAKI,UAAY,CACRjJ,MAAM,CAACC,QAAP,CAAgBwF,MAAhB,EACH,CAPL,CAQI,IARJ,EAUArG,CAAW,CAACT,IAAZ,CAAiB,EAAjB,CACH,CAdD,IAcO,CAGHQ,CAAoB,CAACC,CAAD,CAAc,MAAQtG,CAAW,CAACoQ,iBAApB,CAAwC,MAAtD,CAApB,CACA5I,UAAU,CAAC,UAAY,CACnBmG,CAAa,CAACrH,CAAD,CAAcuJ,CAAd,CAChB,CAFS,CAEP,GAFO,CAGb,CACD3Q,OAAO,CAAC,CAAC,UAAD,CAAD,CAAe,SAAS8I,CAAT,CAAc,CAChCA,CAAG,CAACC,KAAJ,CAAU6H,CAAV,CACH,CAFM,CAAP,CAGA,KAAM,IAAIO,CAAAA,KAAJ,CAAU,8DAAgER,CAA1E,CACT,CA9nBwE,CAsoBrES,CAA2B,CAAG,SAAU9P,CAAV,CAAoBqP,CAApB,CAAgC,CAC9D,MAAOtQ,CAAAA,CAAI,CAACgR,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,2CADE,CAEdC,IAAI,CAAE,CACFC,QAAQ,CAAElQ,CADR,CAEF4M,SAAS,CAAEyC,CAFT,CAGFc,gBAAgB,GAHd,CAFQ,CAAD,CAAV,EAOH,CAPG,CAQV,CA/oBwE,CA0pBrEC,CAAa,CAAG,SAAUC,CAAV,CAAaC,CAAb,CAAgBC,CAAhB,CAAmBC,CAAnB,CAA4B,IACxCC,CAAAA,CAAC,CAAa,CAAV,CAAAD,CAAO,CAAO,CAAP,CAAW,GADkB,CAExCE,CAAC,CAAa,CAAV,CAAAF,CAAO,CAAiB,CAAC,CAAX,CAAAA,CAAP,CAAsBA,CAFO,CAGxCG,CAAC,CAAG1D,IAAI,CAAC2D,KAAL,CAAW,CAACH,CAAC,CAAGJ,CAAL,EAAUK,CAArB,EAA0BL,CAHU,CAIxCQ,CAAC,CAAG5D,IAAI,CAAC2D,KAAL,CAAW,CAACH,CAAC,CAAGH,CAAL,EAAUI,CAArB,EAA0BJ,CAJU,CAKxCQ,CAAC,CAAG7D,IAAI,CAAC2D,KAAL,CAAW,CAACH,CAAC,CAAGF,CAAL,EAAUG,CAArB,EAA0BH,CALU,CAM5C,MAAO,OAASI,CAAT,CAAa,GAAb,CAAmBE,CAAnB,CAAuB,GAAvB,CAA6BC,CAA7B,CAAiC,GAC3C,CAjqBwE,CAuqBrEC,CAAU,CAAG,SAAUC,CAAV,CAAuB,CACpCvR,CAAa,CAACyE,MAAd,CAAqB,GAArB,EACAnE,CAAc,CAAGkR,QAAQ,CAACxR,CAAa,CAACgF,GAAd,CAAkBjB,CAAG,CAACE,OAAtB,CAAD,CAAzB,CACA,GAAIwN,CAAAA,CAAI,CAAGrS,CAAC,CAACuB,CAAQ,CAACG,MAAT,CAAkByQ,CAAnB,CAAZ,CACAE,CAAI,CAACzM,GAAL,CAASjB,CAAG,CAACE,OAAb,CAAuB3D,CAAc,CAAG,CAAxC,EACAkE,CAAsB,IAAtB,CACApF,CAAC,CAACuB,CAAQ,CAACgB,UAAT,CAAsB4P,CAAvB,CAAD,CAAqCvM,GAArC,CAAyCjB,CAAG,CAACE,OAA7C,CAAuD3D,CAAc,CAAG,CAAxE,EACA,GAAImR,CAAI,CAACzM,GAAL,CAASjB,CAAG,CAACI,SAAb,GAAoE,MAAzC,GAAAsN,CAAI,CAACzM,GAAL,CAASjB,CAAG,CAACI,SAAb,EAAwBuN,MAAxB,CAA+B,CAA/B,CAAkC,CAAlC,CAA/B,CAAgF,CAE5E,GAAIC,CAAAA,CAAc,CAAGF,CAAI,CAACzM,GAAL,CAASjB,CAAG,CAACI,SAAb,EAAwByN,OAAxB,CAAgC,OAAhC,CAAyC,EAAzC,EAA6CA,OAA7C,CAAqD,GAArD,CAA0D,EAA1D,EAA8DA,OAA9D,CAAsE,GAAtE,CAA2E,EAA3E,EAA+EC,KAA/E,CAAqF,GAArF,CAArB,CACAJ,CAAI,CAACzM,GAAL,CAASjB,CAAG,CAACI,SAAb,CAAwBwM,CAAa,CACjCa,QAAQ,CAACG,CAAc,CAAC,CAAD,CAAf,CADyB,CAEjCH,QAAQ,CAACG,CAAc,CAAC,CAAD,CAAf,CAFyB,CAGjCH,QAAQ,CAACG,CAAc,CAAC,CAAD,CAAf,CAHyB,CAIjC,GAJiC,CAArC,CAMH,CACJ,CAxrBwE,CAgsBrEG,CAAe,CAAG,SAAUpL,CAAV,CAAa,CAC/B,GAAIqL,CAAAA,CAAW,CAAG3S,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAnB,CACA,GAA+B,gBAA3B,GAAAiL,CAAW,CAACrM,IAAZ,CAAiB,IAAjB,GAA+CqM,CAAW,CAACrM,IAAZ,CAAiB,IAAjB,IAA2B9C,CAAU,CAACE,cAAzF,CAAyG,CAErGiP,CAAW,CAAC3G,IAAZ,GACA,GAAI4G,CAAAA,CAAa,CAAG5S,CAAC,CAACN,QAAQ,CAACsK,gBAAT,CAA0B1C,CAAC,CAACmC,OAA5B,CAAqCnC,CAAC,CAACoC,OAAvC,CAAD,CAArB,CACAiJ,CAAW,CAACzG,IAAZ,GACA,GAA+B,gBAA3B,GAAAyG,CAAW,CAACrM,IAAZ,CAAiB,IAAjB,CAAJ,CAAiD,CAC7C,GAAIsM,CAAa,CAACjL,QAAd,CAAuB,cAAvB,GAA0CiL,CAAa,CAACjL,QAAd,CAAuB,iBAAvB,CAA9C,CAAyF,CAErFiL,CAAa,CAAChL,KAAd,EACH,CAHD,IAGO,CAEH,GAAIiL,CAAAA,CAAW,CAAGD,CAAa,CAAC1K,OAAd,CAAsB3G,CAAQ,CAACE,IAA/B,CAAlB,CACA,GAAIoR,CAAJ,CAAiB,CACbA,CAAW,CAACjL,KAAZ,EACH,CACJ,CACJ,CAXD,IAWO,CAEHnB,CAAoB,CAAC,CAAD,CAApB,CACAmM,CAAa,CAAChL,KAAd,EACH,CACJ,CACJ,CAxtBwE,CA6tBrEkL,CAA0B,CAAG,UAAY,IACrCC,CAAAA,CAAiB,CAAG/S,CAAC,CAACuB,CAAQ,CAACqB,aAAV,CADgB,CAErCoQ,CAAW,CAAGhT,CAAC,CAACuB,CAAQ,CAACsB,YAAV,CAFsB,CAGzC,GAAI1C,CAAc,CAAC8S,mBAAf,EAAJ,CAA0C,CAEtC,GAAI,KAAA9S,CAAc,CAAC+S,wBAAf,EAAJ,CAAwD,CACpDF,CAAW,CAACnM,OAAZ,CAAoB,CAApB,EACAkM,CAAiB,CAAC1D,QAAlB,CAA2B7L,CAAU,CAACI,MAAtC,EAA8CkD,WAA9C,CAA0DtD,CAAU,CAACG,IAArE,CACH,CAHD,IAGO,CACHqP,CAAW,CAAC1D,SAAZ,CAAsB,GAAtB,EACAyD,CAAiB,CAAC1D,QAAlB,CAA2B7L,CAAU,CAACG,IAAtC,EAA4CmD,WAA5C,CAAwDtD,CAAU,CAACI,MAAnE,CACH,CACJ,CATD,IASO,CAEHmP,CAAiB,CAAC1D,QAAlB,CAA2B7L,CAAU,CAACG,IAAtC,EAA4CmD,WAA5C,CAAwDtD,CAAU,CAACI,MAAnE,EACAoP,CAAW,CAAC1D,SAAZ,CAAsB,GAAtB,CACH,CACJ,CA9uBwE,CAwvBrE6D,CAAwB,CAAG,SAAShS,CAAT,CAAmBiS,CAAnB,CAA6BC,CAA7B,CAA0CC,CAA1C,CAAkF,IAAf9E,CAAAA,CAAe,2DAC7G0D,CAAU,CAACmB,CAAD,CAAV,CACArT,CAAC,CAACuB,CAAQ,CAACE,IAAV,CAAD,CAAiBqF,WAAjB,CAA6BtD,CAAU,CAACC,QAAxC,EACA2P,CAAQ,CAAC/D,QAAT,CAAkB7L,CAAU,CAACC,QAA7B,EACAnC,CAAQ,CAAG+R,CAAX,CAGArT,CAAC,CAACuB,CAAQ,CAACI,gBAAV,CAAD,CAA6BwE,IAA7B,CAAkC,SAAUC,CAAV,CAAiBO,CAAjB,CAAsB,CACpDA,CAAG,CAAG3G,CAAC,CAAC2G,CAAD,CAAP,CACA,GAAIA,CAAG,CAACC,EAAJ,CAAO,UAAP,CAAJ,CAAwB,CACpBZ,CAAgB,CAACW,CAAG,CAACL,IAAJ,CAAS,cAAT,CAAD,CAAhB,CACAK,CAAG,CAACE,OAAJ,CAAY,GAAZ,EAAiBC,WAAjB,CAA6BtD,CAAU,CAACM,aAAxC,CACH,CACJ,CAND,EAQA5D,CAAI,CAACgR,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,6BADL,CACoCC,IAAI,CAAE,CAC7CC,QAAQ,CAAElQ,CADmC,CAE7C4M,SAAS,CAAEsF,CAFkC,CAD1C,CAAD,CAAV,EAKI,CALJ,EAKOlD,IALP,CAKY/P,CAAY,CAACmT,SALzB,EAOA,GAAIC,CAAAA,CAAkB,CAAGxT,CAAC,CAACuB,CAAQ,CAACgB,UAAT,CAAsB8Q,CAAvB,CAA1B,CACA,GAAwD,CAApD,CAAAG,CAAkB,CAACjO,IAAnB,CAAwBhE,CAAQ,CAACa,QAAjC,EAA2CqD,MAA/C,CAA2D,CAEvD6I,CAAa,CAACkF,CAAD,CAAqBH,CAArB,CAAkC7E,CAAlC,CAAb,CAEA,GAAIrO,CAAc,CAACsT,mBAAf,CAAmCtS,CAAnC,CAA6CkS,CAA7C,EAA4DC,CAA5D,EACG,CAACnT,CAAc,CAACsT,mBAAf,CAAmCtS,CAAnC,CAA6CkS,CAA7C,CADR,CACmE,CAE/DpC,CAA2B,CAAC9P,CAAD,CAAWkS,CAAX,CAA3B,CAAmDrD,IAAnD,CAAwD,SAAU0D,CAAV,CAAoB,CACxE,GAAIvT,CAAc,CAACwT,qBAAf,EAAJ,CAA4C,CACxCxT,CAAc,CAACyT,kBAAf,CAAkCzS,CAAlC,CAA4CkS,CAA5C,CAAyDrT,CAAC,CAAC0T,CAAQ,CAAClN,IAAV,CAAD,CAAiBA,IAAjB,EAAzD,CACH,CACJ,CAJD,CAKH,CACJ,CAbD,IAaO,CACHgN,CAAkB,CAAChN,IAAnB,CAAwB9F,CAAxB,EACA,GAAIP,CAAc,CAAC8S,mBAAf,EAAJ,CAA0C,CACtC,GAAIY,CAAAA,CAAU,CAAG1T,CAAc,CAACsT,mBAAf,CAAmCtS,CAAnC,CAA6CkS,CAA7C,CAAjB,CACA,GAAIQ,CAAJ,CAAgB,CAEZ7M,CAAoB,CAChBwM,CADgB,CAEhBrT,CAAc,CAAC2T,gBAAf,CAAgC3S,CAAhC,CAA0CkS,CAA1C,CAFgB,CAApB,CAIA/E,CAAa,CAACkF,CAAD,CAAqBH,CAArB,CAAkC7E,CAAlC,CAChB,CACD,GAAI,CAACqF,CAAD,EAAeA,CAAU,CAAGP,CAAhC,CAAyD,CAGrD,GAAIS,CAAAA,CAAW,CAAG/T,CAAC,CAACuB,CAAQ,CAACO,oBAAT,CAAgCuR,CAAjC,CAAnB,CACA,GAAIU,CAAW,SAAf,CAA+B,CAC3BA,CAAW,CAACvN,IAAZ,CAAiB9F,CAAjB,EAAkC2E,MAAlC,CAAyC,GAAzC,CACH,CAFD,IAEO,CACH0O,CAAW,CAAG/T,CAAC,CAAC,OAAD,CAAD,CAAWwG,IAAX,CAAgB9F,CAAhB,CAAd,CACA8S,CAAkB,CAAChN,IAAnB,CAAwBuN,CAAxB,CACH,CACD9C,CAA2B,CAAC9P,CAAD,CAAWkS,CAAX,CAA3B,CAAmDrD,IAAnD,CAAwD,SAAU0D,CAAV,CAAoB,CACxE,GAAIM,CAAAA,CAAgB,CAAGhU,CAAC,CAAC0T,CAAQ,CAAClN,IAAV,CAAD,CAAiBA,IAAjB,EAAvB,CACAQ,CAAoB,CAACwM,CAAD,CAAqBQ,CAArB,CAApB,CACA1F,CAAa,CAACkF,CAAD,CAAqBH,CAArB,CAAkC7E,CAAlC,CAAb,CACA,GAAIrO,CAAc,CAACwT,qBAAf,EAAJ,CAA4C,CACxCxT,CAAc,CAACyT,kBAAf,CAAkCzS,CAAlC,CAA4CkS,CAA5C,CAAyDW,CAAzD,CACH,CACJ,CAPD,EAOG7D,IAPH,CAOQ,SAAUM,CAAV,CAAsB,CAC1BF,CAAuB,CAAC8C,CAAD,CAAc5C,CAAd,CAA0B+C,CAA1B,CAAvB,CACA/M,CAAoB,CAAC4M,CAAD,CACvB,CAVD,CAWH,CACJ,CAhCD,IAgCO,CAEHpC,CAA2B,CAAC9P,CAAD,CAAWkS,CAAX,CAA3B,CAAmDrD,IAAnD,CAAwD,SAAU0D,CAAV,CAAoB,CACxE1M,CAAoB,CAACwM,CAAD,CAAqBxT,CAAC,CAAC0T,CAAQ,CAAClN,IAAV,CAAD,CAAiBA,IAAjB,EAArB,CAApB,CACA8H,CAAa,CAACkF,CAAD,CAAqBH,CAArB,CAAkC7E,CAAlC,CAChB,CAHD,EAGG2B,IAHH,CAGQ,SAAUM,CAAV,CAAsB,CAC1BF,CAAuB,CAAC8C,CAAD,CAAc5C,CAAd,CAA0B+C,CAA1B,CAAvB,CACA/M,CAAoB,CAAC4M,CAAD,CACvB,CAND,CAOH,CACJ,CACDlT,CAAc,CAACqH,qBAAf,CAAqC6L,CAArC,EACAvF,CAAwB,CAACuF,CAAD,CAC3B,CA30BwE,CA60BzE,MAAO,CACHY,IAAI,CAAE,cACFC,CADE,CAEFC,CAFE,CAGFC,CAHE,CAIF3T,CAJE,CAKF+P,CALE,CAMF8C,CANE,CAOFe,CAPE,CAQFC,CARE,CASFC,CATE,CAUFC,CAVE,CAWFC,CAXE,CAYFC,CAZE,CAaFC,CAbE,CAcFC,CAdE,CAeJ,CACEzT,CAAQ,CAAG+S,CAAX,CAEAjT,CAAwB,CAAyB,GAAtB,GAAAuT,CAA3B,CACAF,CAAgB,CAAwB,CAArB,GAAAA,CAAnB,CACAC,CAAsB,CAA8B,GAA3B,GAAAA,CAAzB,CACAlT,CAAgB,CAA4B,GAAzB,GAAAuT,CAAnB,CAGAzU,CAAc,CAAC8T,IAAf,CACI9S,CADJ,CAEIiT,CAFJ,IAII5D,CAJJ,CAKI6D,CALJ,CAMIE,CANJ,CAOIE,CAPJ,EASAtU,CAAc,CAAC0U,cAAf,GACA7U,CAAC,CAACN,QAAD,CAAD,CAAYoV,KAAZ,CAAkB,UAAY,CAC1B,GAAIC,CAAAA,CAAW,CAAG/U,CAAC,CAAC,eAAD,CAAnB,CACA,GAA2B,CAAvB,GAAA+U,CAAW,CAACtP,MAAhB,CAA8B,CAE1BsP,CAAW,CAAG/U,CAAC,CAAC,cAAD,CAClB,CACD8N,CAAwB,CAAC,CAAD,CAAxB,CAGA,GAAmB,CAAf,GAAA0C,CAAJ,CAAsB,CAClBlP,CAAQ,CAAGkP,CACd,CAFD,IAEO,CAEH,GAAIvP,CAAwB,EAAId,CAAc,CAAC8S,mBAA/C,CAAoE,CAChE3R,CAAQ,CAAGnB,CAAc,CAAC6U,qBAAf,EAGd,CACJ,CACD,GAAiB,CAAb,GAAA1T,CAAJ,CAAoB,CAChBhB,CAAU,CAAC2T,IAAX,CAAgB9S,CAAhB,CAA0BG,CAA1B,CAAoCoT,CAApC,IACH,CAFD,IAEO,CAEH1U,CAAC,CAACuB,CAAQ,CAACG,MAAT,CAAkB,GAAnB,CAAD,CAAyBqF,KAAzB,GACAzG,CAAU,CAAC2T,IAAX,CAAgB9S,CAAhB,CAA0B,IAA1B,CAAgCuT,CAAhC,IACH,CACD,GAAIO,CAAAA,CAAW,CAAGjV,CAAC,CAAC6H,MAAD,CAAD,CAAUqN,UAAV,EAAlB,CAEA,GAAIf,CAAJ,CAAsB,CAGlBvT,CAAa,CAAGZ,CAAC,CAAC,aAAD,CAAD,CAAiBqP,QAAjB,CAA0B,wBAA1B,EAAoDrD,IAApD,GACX1F,IADW,CACN,IADM,CACA,gBADA,EACkB6O,QADlB,CAC2B5U,CAD3B,CAAhB,CAKAK,CAAa,CAACgH,KAAd,CAAoB,SAAUN,CAAV,CAAa,CAC7Bb,CAAoB,CAAC,CAAD,CAApB,CACAiM,CAAe,CAACpL,CAAD,CAClB,CAHD,EAMAyN,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAAC2B,QAArC,CAA+C,SAAUoE,CAAV,CAAa,CACxDA,CAAC,CAAC8C,cAAF,GACA9C,CAAC,CAAC+C,eAAF,GAFwD,GAGpD+K,CAAAA,CAAa,CAAG9N,CAAC,CAAC+N,MAHkC,CAIpDC,CAAQ,CAAmD,MAAhD,GAAAF,CAAa,CAACxV,YAAd,CAA2B,eAA3B,CAJyC,CAKpD2V,CAAY,CAAGH,CAAa,CAACxV,YAAd,CAA2B,eAA3B,CALqC,CAMpD4V,CAAW,CAAGxV,CAAC,CAAC,IAAMuV,CAAP,CANqC,CAOxD,GAAID,CAAJ,CAAc,CAEVF,CAAa,CAACK,YAAd,CAA2B,eAA3B,CAA4C,OAA5C,EACAD,CAAW,CAACxJ,IAAZ,EACH,CAJD,IAIO,CAEHoJ,CAAa,CAACK,YAAd,CAA2B,eAA3B,CAA4C,MAA5C,EACAD,CAAW,CAACtJ,IAAZ,EACH,CACJ,CAhBD,EAkBA6I,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAAC6B,aAArC,CAAoD,SAAUkE,CAAV,CAAa,CAC7DA,CAAC,CAAC8C,cAAF,GACA9C,CAAC,CAAC+C,eAAF,GAF6D,GAGzDiC,CAAAA,CAAK,CAAG,GAAIC,CAAAA,cAH6C,CAIzD8I,CAAM,CAAG/N,CAAC,CAAC+N,MAJ8C,CAK7D,GAAuB,KAAnB,GAAAA,CAAM,CAACK,OAAX,CAA8B,CAC1BL,CAAM,CAAGA,CAAM,CAACnN,OAAP,CAAe,eAAf,CACZ,CACD,GAAImN,CAAM,CAACM,SAAP,CAAiBC,QAAjB,CAA0B,QAA1B,CAAJ,CAAyC,CACrC,MACH,CACDtJ,CAAK,CAACa,kBAAN,CAA2B,UAAY,CACnC,GAAuB,CAAnB,OAAKC,UAAL,EAAuC,GAAf,OAAKC,MAAjC,CAAgD,CAC5CgI,CAAM,CAACM,SAAP,CAAiBE,GAAjB,CAAqB,QAArB,EACA,GAAInL,CAAAA,CAAM,CAAG2K,CAAM,CAACnN,OAAP,CAAe,cAAf,CAAb,CACAwC,CAAM,CAACiL,SAAP,CAAiB7J,MAAjB,CAAwB,aAAxB,EACApB,CAAM,CAACoL,aAAP,CAAqB,mBAArB,EAA0CH,SAA1C,CAAoDE,GAApD,CAAwD,QAAxD,CACH,CACJ,CAPD,CAQAvJ,CAAK,CAACqB,IAAN,CAAW,KAAX,CAAkB0H,CAAM,CAACzV,YAAP,CAAoB,MAApB,CAAlB,EACA0M,CAAK,CAACsB,IAAN,EACH,CArBD,EAuBAmH,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAAC4B,aAArC,CAAoD,SAAUmE,CAAV,CAAa,CAC7DA,CAAC,CAAC+C,eAAF,EACH,CAFD,EAIA0K,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAAC8B,QAArC,CAA+C,SAAUiE,CAAV,CAAa,CACxDA,CAAC,CAAC+C,eAAF,EACH,CAFD,EAIArK,CAAC,CAAC,MAAD,CAAD,CAAUqH,EAAV,CAAatD,CAAK,CAACW,SAAnB,CAA8BnD,CAAQ,CAAC+B,uBAAvC,CAAgEuG,CAAhE,EAEAkL,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACI,SAAN,CAAkB,GAAlB,CAAwBJ,CAAK,CAACQ,SAA7C,CAAwDhD,CAAQ,CAAC8B,QAAjE,CAA2E,SAAUiE,CAAV,CAAa,CACpF,GAAIA,CAAC,CAACgD,MAAF,EAAYhD,CAAC,CAAC6B,IAAF,GAAWpF,CAAK,CAACQ,SAAjC,CAA4C,CACxC,MACH,CACD,GAAIwR,CAAAA,CAAQ,CAAGzO,CAAC,CAAC+N,MAAjB,CACA,GAAyB,KAArB,GAAAU,CAAQ,CAACL,OAAb,CAAgC,CAE5BK,CAAQ,CAAGzO,CAAC,CAAC+N,MAAF,CAASnN,OAAT,CAAiB3G,CAAQ,CAAC8B,QAA1B,CACd,CACD0S,CAAQ,CAACN,YAAT,CAAsB,cAAtB,CAAsC,MAAtC,EAEA,GAAIpD,CAAAA,CAAI,CAAGrS,CAAC,CAAC,IAAM+V,CAAQ,CAACnW,YAAT,CAAsB,eAAtB,CAAP,CAAZ,CAEAyS,CAAI,CAAChD,QAAL,CAAc,aAAd,EACAgD,CAAI,CAACzM,GAAL,CAAS,gBAAT,CAA2B,MAA3B,EACAyM,CAAI,CAACzM,GAAL,CAAS,YAAT,CAAuB,MAAvB,EAfoF,GAgBhFoQ,CAAAA,CAAG,CAAGjN,CAAuB,CAACzB,CAAD,CAhBmD,CAiBhF2O,CAAS,CAAGD,CAAG,CAACrM,CAjBgE,CAkBhFuM,CAAS,CAAGF,CAAG,CAACpM,CAlBgE,CAmBhFuM,CAAC,CAAG,CAnB4E,CAoBhFC,CAAC,CAAG,CApB4E,CAqBhFC,CAAM,GArB0E,CAsBhFC,CAAc,CAAG,UAAY,CAC7B,GAAID,CAAJ,CAAY,CACRhE,CAAI,CAACzM,GAAL,CAAS,WAAT,qBAAmCuQ,CAAnC,gBAA2CC,CAA3C,SACAvO,MAAM,CAAC0O,qBAAP,CAA6BD,CAA7B,CACH,CACJ,CA3BmF,CA4BhFlL,CAAY,CAAG,SAAU9D,CAAV,CAAa,CAC5B,GAAI0O,CAAAA,CAAG,CAAGjN,CAAuB,CAACzB,CAAD,CAAjC,CACA6O,CAAC,CAAGH,CAAG,CAACrM,CAAJ,CAAQsM,CAAZ,CACAG,CAAC,CAAGJ,CAAG,CAACpM,CAAJ,CAAQsM,CACf,CAhCmF,CAiCpFrO,MAAM,CAAC0O,qBAAP,CAA6BD,CAA7B,EACAtW,CAAC,CAAC,MAAD,CAAD,CAAUqH,EAAV,CAAatD,CAAK,CAACM,SAAN,CAAkB,GAAlB,CAAwBN,CAAK,CAACW,SAA3C,CAAsD0G,CAAtD,EACApL,CAAC,CAAC,MAAD,CAAD,CAAUqH,EAAV,CAAatD,CAAK,CAACK,OAAN,CAAgB,GAAhB,CAAsBL,CAAK,CAACS,OAAzC,CAAkD,SAAU8C,CAAV,CAAa,CAC3D+O,CAAM,GAAN,CACA,GAAI/O,CAAC,CAACgD,MAAF,EAAY,CAAChD,CAAC,CAAC6B,IAAH,GAAYpF,CAAK,CAACS,OAAlC,CAA2C,CAEvC,MACH,CACDxE,CAAC,CAAC,MAAD,CAAD,CAAU6L,GAAV,CAAc9H,CAAK,CAACM,SAAN,CAAkB,GAAlB,CAAwBN,CAAK,CAACW,SAA5C,CAAuD0G,CAAvD,EACAiH,CAAI,CAACzM,GAAL,CAAS,gBAAT,CAA2B,EAA3B,EACAyM,CAAI,CAACzM,GAAL,CAAS,WAAT,CAAsB,EAAtB,EACAyM,CAAI,CAACzM,GAAL,CAAS,YAAT,CAAuB,EAAvB,EACAmQ,CAAQ,CAACN,YAAT,CAAsB,cAAtB,CAAsC,OAAtC,EAEAzV,CAAC,CAAC,MAAD,CAAD,CAAU6L,GAAV,CAAc9H,CAAK,CAACK,OAAN,CAAgB,GAAhB,CAAsBL,CAAK,CAACS,OAA1C,CAAmD,IAAnD,EACAuQ,CAAW,CAAClJ,GAAZ,CAAgB9H,CAAK,CAACO,SAAN,CAAkB,GAAlB,CAAwBP,CAAK,CAACU,SAA9C,CAAyDlD,CAAQ,CAAC+B,uBAAlE,EAb2D,GAevDkT,CAAAA,CAAU,CAAGxW,CAAC,CAACuB,CAAQ,CAAC+B,uBAAV,CAAD,CACZ0J,QADY,GAEZyJ,MAFY,CAEL,sBAFK,EAGZrQ,KAHY,CAGNiM,CAHM,EAGE,CAlBwC,CAmBvDqE,CAAM,CAAGrE,CAAI,CAAC/L,IAAL,CAAU,cAAV,CAnB8C,CAqB3D,GAAI8L,QAAQ,CAACsE,CAAD,CAAR,GAAqBF,CAAzB,CAAqC,CACjC,MACH,CAED,GAAIlK,CAAAA,CAAK,CAAG,GAAIC,CAAAA,cAAhB,CACA3L,CAAa,CAACyE,MAAd,GACAiH,CAAK,CAACa,kBAAN,CAA2B,UAAY,CACnC,GAAuB,CAAnB,OAAKC,UAAL,EAAuC,GAAf,OAAKC,MAAjC,CAAgD,CAC5CxF,MAAM,CAACC,QAAP,CAAgBwF,MAAhB,IACH,CAFD,IAEO,IAAuB,CAAnB,OAAKF,UAAT,CAA0B,CAC7BxM,CAAa,CAACmF,OAAd,GACA1F,CAAG,CAACsW,WAAJ,CAAgB,CAACC,GAAG,CAAE,gBAAN,CAAwBC,SAAS,CAAE,eAAnC,CAAhB,CACI,CAACD,GAAG,CAAE,qBAAN,CAA6BC,SAAS,CAAE,eAAxC,CADJ,CAEI,CAACD,GAAG,CAAE,IAAN,CAFJ,EAGK5G,IAHL,CAGU,SAAS8G,CAAT,CAAkB,CACpB1W,CAAY,CAAC2W,KAAb,CACAD,CAAO,CAAC,CAAD,CADP,CAEAA,CAAO,CAAC,CAAD,CAFP,CAGAA,CAAO,CAAC,CAAD,CAHP,CAKH,CATL,CAUH,CACJ,CAhBD,CA3B2D,GA4CvDtK,CAAAA,CAAG,CAAGC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,kBA5CiC,CA6CvDC,CAAI,CAAG,YAAcH,CAAC,CAACC,GAAF,CAAMG,OAApB,CAA8B,YAA9B,CAA6C1L,CAA7C,CACL,+BADK,CAC6BkR,CAAI,CAAC/L,IAAL,CAAU,cAAV,CAD7B,CAEL,SAFK,CAEOkQ,CA/CyC,CAgD3DlK,CAAK,CAACqB,IAAN,CAAW,KAAX,CAAkBnB,CAAG,CAAGI,CAAxB,EACAN,CAAK,CAACsB,IAAN,GAQA,OANIxB,CAAAA,CAAQ,CAAGpM,CAAC,CAACuB,CAAQ,CAAC+B,uBAAV,CAAD,CACV0J,QADU,GAEVyJ,MAFU,CAEH,sBAFG,CAMf,CAHIO,CAAW,CAAG,EAGlB,CAFIjP,CAAI,CAAG,CAAC,CAEZ,CADIkP,CAAW,CAAG,IAClB,CAASC,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG9K,CAAQ,CAAC3G,MAA7B,CAAqCyR,CAAC,EAAtC,CAA0C,IAClCC,CAAAA,CAAO,CAAG/K,CAAQ,CAAC8K,CAAD,CADgB,CAElCE,CAAQ,CAAGD,CAAO,CAACvX,YAAR,CAAqB,cAArB,CAFuB,CAGtC,GAAII,CAAC,CAACmX,CAAD,CAAD,CAAWrN,QAAX,GAAsBvB,GAAtB,CAA4BR,CAAhC,CAAsC,CAClCA,CAAI,CAAG/H,CAAC,CAACmX,CAAD,CAAD,CAAWrN,QAAX,GAAsBvB,GAA7B,CACA,GAAoB,IAAhB,GAAA0O,CAAJ,CAA0B,CACtB,IAAK,GAAII,CAAAA,CAAC,CAAG,CAAR,CACGjR,CADR,CAAgBiR,CAAC,CAAGL,CAAW,CAACvR,MAAhC,CAAwC4R,CAAC,EAAzC,CAA6C,CACrCjR,CADqC,CAC7B4Q,CAAW,CAACK,CAAD,CADkB,CAEzCrX,CAAC,CAACiX,CAAD,CAAD,CAAetL,KAAf,CAAqB3L,CAAC,CAAC,YAAcoG,CAAf,CAAtB,CACH,CACJ,CACD4Q,CAAW,CAAG,EACjB,CACDC,CAAW,CAAGE,CAAd,CACAH,CAAW,CAACM,IAAZ,CAAiBF,CAAjB,EACAD,CAAO,CAAC1B,YAAR,CAAqB,cAArB,CAAqCyB,CAAC,CAAG,CAAzC,EACAC,CAAO,CAAC1B,YAAR,CAAqB,IAArB,CAA2B,SAAWyB,CAAC,CAAG,CAAf,CAA3B,CAEH,CAKD,OAJIK,CAAAA,CAAW,CAAGvX,CAAC,CAACuB,CAAQ,CAAC+B,uBAAV,CAAD,CACb0J,QADa,GAEbyJ,MAFa,CAEN,UAFM,CAIlB,CAASS,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG9K,CAAQ,CAAC3G,MAA7B,CAAqCyR,CAAC,EAAtC,CAA0C,CACtCK,CAAW,CAACL,CAAD,CAAX,CAAezB,YAAf,CAA4B,IAA5B,CAAkC,WAAayB,CAA/C,EACAK,CAAW,CAACL,CAAD,CAAX,CAAezB,YAAf,CAA4B,cAA5B,CAA4CyB,CAA5C,CACH,CACD5P,CAAC,CAAC8C,cAAF,GACA9C,CAAC,CAAC+C,eAAF,EACH,CAtFD,EAwFA0K,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACO,SAAN,CAAkB,GAAlB,CAAwBP,CAAK,CAACU,SAA7C,CAAwDlD,CAAQ,CAAC+B,uBAAjE,CAA0F,SAAUgE,CAAV,CAAa,CACnG,GAAIyF,CAAAA,CAAU,CAAGzF,CAAC,CAAC+N,MAAnB,CACA,GAAI,CAACtI,CAAU,CAAC4I,SAAX,CAAqBC,QAArB,CAA8B,gBAA9B,CAAL,CAAsD,CAClD7I,CAAU,CAAG/M,CAAC,CAACsH,CAAC,CAAC+N,MAAH,CAAD,CAAYnN,OAAZ,CAAoB,sBAApB,CAChB,CACD,GAAmB,IAAf,GAAA6E,CAAU,EAAaA,CAAU,CAACtH,MAAtC,CAA8C,CAC1C,GAAIzF,CAAC,CAAC+M,CAAD,CAAD,CAAc3G,KAAd,KAA0BiM,CAAI,CAACjM,KAAL,EAA9B,CAA4C,CAE3C,CAFD,IAEO,IACCoR,CAAAA,CAAc,CAAGzK,CAAU,CAACxH,IAAX,CAAgBhE,CAAQ,CAAC8B,QAAzB,CADlB,CAECiF,CAAM,CAAGkP,CAAc,CAAC,CAAD,CAAd,CAAkB7M,qBAAlB,EAFV,CAGHsL,CAAS,CAAG3N,CAAM,CAAC0C,IAAP,CAAc,CAA1B,CACAkL,CAAS,CAAG5N,CAAM,CAACC,GAAP,CAAa,CAAzB,CACA,GAAIvI,CAAC,CAAC+M,CAAD,CAAD,CAAc3G,KAAd,GAAwBiM,CAAI,CAACjM,KAAL,EAA5B,CAA0C,CACtC2G,CAAU,CAACpB,KAAX,CAAiB0G,CAAjB,CACH,CAFD,IAEO,CACHtF,CAAU,CAACrB,MAAX,CAAkB2G,CAAlB,CACH,CACJ,CACJ,CACJ,CApBD,EAsBA/K,CAAC,CAAC8C,cAAF,GACA9C,CAAC,CAAC+C,eAAF,EACH,CAnJD,EAuJA0K,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAACS,cAArC,CAAqD,SAAUsF,CAAV,CAAa,CAE9D,GAAI,CAAC6M,CAAL,CAAuB,CACnB,MACH,CACD7M,CAAC,CAAC8C,cAAF,GACApK,CAAC,CAAC6H,MAAD,CAAD,CAAUgE,GAAV,CAAc9H,CAAK,CAACG,MAApB,EAEAlE,CAAC,CAACuB,CAAQ,CAACM,iBAAV,CAAD,CAA8BkE,OAA9B,CAAsC,GAAtC,CAA2C,UAAY,CACnD/F,CAAC,CAACuB,CAAQ,CAACM,iBAAV,CAAD,CAA8B2E,IAA9B,EACH,CAFD,EAR8D,GAW1D4M,CAAAA,CAAQ,CAAGpT,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAD,CAAmBQ,OAAnB,CAA2B3G,CAAQ,CAACE,IAApC,CAX+C,CAY1D4R,CAAW,CAAGjB,QAAQ,CAACgB,CAAQ,CAAC9M,IAAT,CAAc,cAAd,CAAD,CAZoC,CAa9D,GAAI8M,CAAQ,CAACzL,QAAT,CAAkBnE,CAAU,CAACC,QAA7B,CAAJ,CAA4C,CAExCgD,CAAoB,CAAC4M,CAAD,CAApB,CACAlT,CAAc,CAACqH,qBAAf,CAAqC,CAArC,CACH,CAJD,IAIO,CACH2L,CAAwB,CACpBhS,CADoB,CACViS,CADU,CACAC,CADA,CACaC,CADb,CAG3B,CAGD,GAAImE,CAAAA,CAAe,CAAGzX,CAAC,CAACuB,CAAQ,CAACgB,UAAT,EAAuB8Q,CAAW,CAAG,CAArC,CAAD,CAAvB,CACA,GAAI,CAAC5S,CAAD,EAAa,CAACkU,CAAd,EAAgC8C,CAAe,CAAChS,MAAhD,EAAwE,CAAd,CAAA4N,CAA9D,CAA+E,CAC3ElL,UAAU,CAAC,UAAY,CACnB,GAAIuP,CAAAA,CAAgB,CAAGvX,CAAc,CAACsT,mBAAf,CAAmCtS,CAAnC,CAA6CkS,CAAW,CAAG,CAA3D,CAAvB,CACA,GAAIqE,CAAJ,CAAsB,CAElB1Q,CAAoB,CAChByQ,CADgB,CAEhBtX,CAAc,CAAC2T,gBAAf,CAAgC3S,CAAhC,CAA0CkS,CAAW,CAAG,CAAxD,CAFgB,CAIvB,CACD,GAAI,CAACqE,CAAD,EAAqBA,CAAgB,CAAGpE,CAA5C,CAAqE,CAEjErC,CAA2B,CAAC9P,CAAD,CAAWkS,CAAW,CAAG,CAAzB,CAA3B,CAAuDrD,IAAvD,CAA4D,SAAS0D,CAAT,CAAmB,CAC3E1M,CAAoB,CAChByQ,CADgB,CAEhBzX,CAAC,CAAC0T,CAAQ,CAAClN,IAAV,CAAD,CAAiBA,IAAjB,EAFgB,CAApB,CAIA,GAAIrG,CAAc,CAACwT,qBAAf,EAAJ,CAA4C,CACxCxT,CAAc,CAACyT,kBAAf,CACIzS,CADJ,CACckS,CAAW,CAAG,CAD5B,CAC+BrT,CAAC,CAAC0T,CAAQ,CAAClN,IAAV,CAAD,CAAiBA,IAAjB,EAD/B,CAGH,CACJ,CAVD,CAWH,CACJ,CAvBS,CAuBP,GAvBO,CAwBb,CACJ,CAnDD,EAyDAxG,CAAC,CAAC6H,MAAD,CAAD,CAAUR,EAAV,CAAa,QAAb,CAAuB,UAAY,CAG/B,GAAIjG,CAAY,EAAI6T,CAAW,GAAKjV,CAAC,CAAC6H,MAAD,CAAD,CAAUqN,UAAV,EAApC,CAA4D,CACxD,MACH,CACD9T,CAAY,GAAZ,CAIA+G,UAAU,CAAC,UAAW,IAEdwP,CAAAA,CAAc,GAFA,CAMdC,CAAkB,CAAG5X,CAAC,CAAC,0BAAD,CANR,CAOlB,GAAkC,CAA9B,GAAA4X,CAAkB,CAACnS,MAAvB,CAAqC,CACjC,GAAIc,CAAAA,CAAY,CAAGqR,CAAkB,CAACrS,IAAnB,CAAwB,qBAAxB,CAAnB,CACA,GAA4B,CAAxB,GAAAgB,CAAY,CAACd,MAAjB,CAA+B,CAC3Bc,CAAY,CAACJ,IAAb,CAAkB,SAAUC,CAAV,CAAiByR,CAAjB,CAAyB,CACvCA,CAAM,CAAG7X,CAAC,CAAC6X,CAAD,CAAV,CACA,GAAIA,CAAM,CAAC3C,UAAP,GAAsB0C,CAAkB,CAAC1C,UAAnB,EAA1B,CAA2D,CAEvDyC,CAAc,GACjB,CACJ,CAND,CAOH,CACJ,CACD,GAAIA,CAAJ,CAAoB,CAEhB1C,CAAW,CAAGjV,CAAC,CAAC6H,MAAD,CAAD,CAAUqN,UAAV,EAAd,CACA3F,CAAa,IAAOmF,CAAP,CAChB,CACDtT,CAAY,GACf,CAzBS,CAyBP,GAzBO,CA0Bb,CApCD,EAsCA8I,CAA0B,GAvTR,GAoUd4N,CAAAA,CAAa,CAAG1F,QAAQ,CAACxR,CAAa,CAACgF,GAAd,CAAkBjB,CAAG,CAACE,OAAtB,CAAD,CApUV,CAqUdS,CAAS,CAAGtF,CAAC,CAACuB,CAAQ,CAAC0B,UAAT,CAAoBsC,IAApB,CAAyB,SAASC,CAAT,CAAmB,CAC1D,MAA4B,EAArB,CAAAxF,CAAC,CAACwF,CAAD,CAAD,CAAYC,MACtB,CAFiB,CAAD,CArUC,CAwUlB,GAAIH,CAAS,SAAT,EAAgD,CAArB,GAAAA,CAAS,CAACG,MAAzC,CAAuD,CACnDH,CAAS,CAACM,GAAV,CAAcjB,CAAG,CAACE,OAAlB,CAA2BiT,CAAa,CAAG,CAA3C,EACA,GAA6B,SAAzB,GAAAxS,CAAS,CAACgB,IAAV,CAAe,IAAf,CAAJ,CAAwC,CAKpC,GAAIhB,CAAS,CAAC8J,WAAV,WAAJ,CAA2C,CACvCpO,CAAiB,CAAGsE,CAAS,CAAC8J,WAAV,EAApB,CADuC,GAEnC2I,CAAAA,CAAQ,CAAGrY,QAAQ,CAACsY,cAAT,CAAwB,aAAxB,EAAuCrN,qBAAvC,EAFwB,CAGnCsN,CAAU,CAAGF,CAAQ,CAACnO,CAAT,CAAamO,CAAQ,CAAC7M,MAHA,CAInCgN,CAAK,CAAG9J,IAAI,CAAC+J,GAAL,CAAS,CAAT,CAAYF,CAAU,CAAGpQ,MAAM,CAACuQ,OAAhC,CAJ2B,CAKvCvX,CAAa,CAAGb,CAAC,CAAC,aAAD,CAAD,CACXqP,QADW,CACF7L,CAAU,CAACE,cADT,EACyB4C,IADzB,CAC8B,IAD9B,CACoC9C,CAAU,CAACE,cAD/C,EAEXkC,GAFW,CAEPjB,CAAG,CAACC,OAFG,CAEM,MAFN,CAAhB,CAGA/D,CAAa,CAACsK,WAAd,CAA0B5J,CAAQ,CAAC0B,UAAnC,EACK2C,GADL,CACSjB,CAAG,CAACE,OADb,CACuBiT,CAAD,CAAkB,CADxC,EAC2ClS,GAD3C,CAC+CjB,CAAG,CAACG,MADnD,CAC2D9D,CAAiB,CAAGkX,CAD/E,EAEKtQ,KAFL,CAEW,SAAUN,CAAV,CAAa,CAChBb,CAAoB,CAAC,CAAD,CAApB,CACAiM,CAAe,CAACpL,CAAD,CAClB,CALL,EAMAO,MAAM,CAACwQ,gBAAP,CAAwBtU,CAAK,CAACG,MAA9B,CAAsC,UAAY,CAC9CgU,CAAK,CAAG9J,IAAI,CAAC+J,GAAL,CAAS,CAAT,CAAYF,CAAU,CAAGpQ,MAAM,CAACuQ,OAAhC,CAAR,CACAvX,CAAa,CAAC+E,GAAd,CAAkBjB,CAAG,CAACG,MAAtB,CAA8B9D,CAAiB,CAAGkX,CAAlD,CACH,CAHD,IAIH,CAlBD,IAkBO,CACHrY,OAAO,CAAC,CAAC,UAAD,CAAD,CAAe,SAAS8I,CAAT,CAAc,CAChCA,CAAG,CAACC,KAAJ,CACI,wFADJ,CAGH,CAJM,CAKV,CACJ,CACJ,CAGDmM,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAACoB,aAArC,CAAoD,SAAU2E,CAAV,CAAa,CAC7Db,CAAoB,CAACzG,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAD,CAAmBpB,IAAnB,CAAwB,cAAxB,CAAD,CACvB,CAFD,EAKAyO,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAACwB,eAArC,CAAsD,SAASuE,CAAT,CAAY,CAC9D,GAAIgR,CAAAA,CAAS,CAAGtY,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAjB,CACA,GAAI4Q,CAAS,CAAChS,IAAV,CAAe,MAAf,UAAJ,CAA0C,CACtCuB,MAAM,CAACC,QAAP,CAAkBwQ,CAAS,CAAChS,IAAV,CAAe,MAAf,CACrB,CAFD,IAEO,IAAIgS,CAAS,CAAC/S,IAAV,CAAe,GAAf,EAAoBe,IAApB,CAAyB,MAAzB,UAAJ,CAAoD,CACvDuB,MAAM,CAACC,QAAP,CAAkBwQ,CAAS,CAAC/S,IAAV,CAAe,GAAf,EAAoBe,IAApB,CAAyB,MAAzB,CACrB,CACJ,CAPD,EASAwM,CAA0B,EAG7B,CAGDiC,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAACqB,aAArC,CAAoD,SAAU0E,CAAV,CAAa,CAC7D,GAAI0L,CAAAA,CAAW,CAAGhT,CAAC,CAACuB,CAAQ,CAACsB,YAAV,CAAnB,CACA,GAAqC,MAAjC,GAAAmQ,CAAW,CAACpN,GAAZ,CAAgBjB,CAAG,CAACC,OAApB,CAAJ,CAA6C,CAEzCoO,CAAW,CAAC1D,SAAZ,CAAsB,GAAtB,EACAtP,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAD,CAAmB2H,QAAnB,CAA4B7L,CAAU,CAACG,IAAvC,EAA6CmD,WAA7C,CAAyDtD,CAAU,CAACI,MAApE,EACAzD,CAAc,CAACoY,wBAAf,CAAwC,WAAxC,CACH,CALD,IAKO,CAEHvF,CAAW,CAACnM,OAAZ,CAAoB,GAApB,EACA7G,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAD,CAAmB2H,QAAnB,CAA4B7L,CAAU,CAACI,MAAvC,EAA+CkD,WAA/C,CAA2DtD,CAAU,CAACG,IAAtE,EACAxD,CAAc,CAACoY,wBAAf,CAAwC,UAAxC,CACH,CACJ,CAbD,EAeA,GAAIjE,CAAJ,CAAsB,CAClBzU,OAAO,CAAC,CAAC,6BAAD,CAAD,CAAkC,SAAU2Y,CAAV,CAAyB,CAC9DA,CAAa,CAACvE,IAAd,CAAmB9S,CAAnB,CAA6BhB,CAAc,CAAC8S,mBAA5C,CACH,CAFM,CAAP,CAGA,GAAIkB,CAAJ,CAAsB,CAClBY,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAACK,aAArC,CAAoD,UAAY,CAC5D6E,CAAoB,CAAC,CAAD,CAApB,CACA8I,CAAa,OAChB,CAHD,CAIH,CAEJ,CAKDvP,CAAC,CAAC,kBAAD,CAAD,CAAsB8G,WAAtB,CAAkC,QAAlC,EAGA7G,CAAS,CAACwY,MAAV,CAAiB,sBAAjB,CAAyC,EAAzC,EAA6CzI,IAA7C,CAAkD,SAAUxJ,CAAV,CAAgB,CAC9D9F,CAAe,CAAG8F,CACrB,CAFD,EAMA,GAAIkS,CAAAA,CAAU,CAAG,CACb,CAAC9B,GAAG,CAAE,mBAAN,CAA2BC,SAAS,CAAE,cAAtC,CADa,CAEb,CAACD,GAAG,CAAE,oBAAN,CAA4BC,SAAS,CAAE,cAAvC,CAFa,CAGb,CAACD,GAAG,CAAE,SAAN,CAHa,CAIb,CAACA,GAAG,CAAE,QAAN,CAJa,CAKb,CAACA,GAAG,CAAE,mBAAN,CAA2BC,SAAS,CAAE,cAAtC,CALa,CAMb,CAACD,GAAG,CAAE,MAAN,CANa,CAOb,CAACA,GAAG,CAAE,MAAN,CAPa,CAQb,CAACA,GAAG,CAAE,OAAN,CAAeC,SAAS,CAAE,cAA1B,CARa,CASb,CAACD,GAAG,CAAE,mBAAN,CAA2BC,SAAS,CAAE,cAAtC,CATa,CAAjB,CAWAxW,CAAG,CAACsW,WAAJ,CAAgB+B,CAAhB,EAA4B1I,IAA5B,CAAiC,SAAU2I,CAAV,CAAa,CAC1CA,CAAC,CAAC3K,OAAF,CAAU,SAAS3N,CAAT,CAAc+F,CAAd,CAAqB,CAC3BzF,CAAW,CAAC+X,CAAU,CAACtS,CAAD,CAAV,CAAkBwQ,GAAnB,CAAX,CAAqCvW,CACxC,CAFD,CAGH,CAJD,EAQA,GAAII,CAAJ,CAAc,CACVsU,CAAW,CAAC1N,EAAZ,CAAetD,CAAK,CAACC,KAArB,CAA4BzC,CAAQ,CAACa,QAAT,CAAoB,UAAhD,CAA4D,SAASkF,CAAT,CAAY,IAChE+N,CAAAA,CAAM,CAAGrV,CAAC,CAACsH,CAAC,CAACI,aAAH,CADsD,CAEhE8E,CAAG,CAAG6I,CAAM,CAACnN,OAAP,CAAe3G,CAAQ,CAACa,QAAxB,EAAkCkE,IAAlC,CAAuC,oBAAvC,CAF0D,CAGpE,GAAIkG,CAAG,SAAP,CAAuB,CACnBlF,CAAC,CAAC8C,cAAF,GACA9C,CAAC,CAAC+C,eAAF,GACA,GAAIuO,CAAAA,CAAE,CAAGvD,CAAM,CAACnN,OAAP,CAAe3G,CAAQ,CAACa,QAAxB,CAAT,CACAlC,CAAI,CAACgR,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,2BADL,CACkCC,IAAI,CAAE,CAC3CC,QAAQ,CAAElQ,CADiC,CAE3CkL,IAAI,CAAEuM,CAAE,CAACtS,IAAH,CAAQ,WAAR,CAFqC,CADxC,CAAD,CAAV,EAKI,CALJ,EAKO0J,IALP,CAKY,UAAY,CAEpBnQ,OAAO,CAAC,CAAC,yBAAD,CAAD,CAA8B,SAAUiP,CAAV,CAAsB,CACvDA,CAAU,CAAC+J,sBAAX,CAAkC1X,CAAlC,CAA4CyX,CAA5C,CACH,CAFM,CAGV,CAVD,EAWA/Q,MAAM,CAACC,QAAP,CAAkB0E,CACrB,CACJ,CApBD,CAqBH,CAtBD,IAsBO,CAQHxM,CAAC,CAACuB,CAAQ,CAACE,IAAV,CAAD,CAAiB4F,EAAjB,CAAoBtD,CAAK,CAACE,OAA1B,CAAmC,SAAUqD,CAAV,CAAa,CAC5C,GAAIA,CAAC,CAACC,OAAF,GAAcvC,CAAQ,CAACG,MAA3B,CAAmC,CAC/BnF,CAAC,CAACsH,CAAC,CAACI,aAAH,CAAD,CAAmBE,KAAnB,EACH,CACJ,CAJD,EAOA5H,CAAC,CAAC,gBAAD,CAAD,CAAoB4O,KAApB,GAA4B7H,KAA5B,EACH,CAKD/G,CAAC,CAACN,QAAD,CAAD,CAAY2H,EAAZ,CAAe,wBAAf,CAAyC,SAAU2B,CAAV,CAAiB8P,CAAjB,CAAsB,CAC3D,GAAiB,CAAb,CAAAA,CAAG,CAACrT,MAAR,CAAoB,CAChB,GAAIsT,CAAAA,CAAI,CAAG/Y,CAAC,CAAC8Y,CAAG,CAAC,CAAD,CAAJ,CAAZ,CACA,GAAIC,CAAI,CAACpR,QAAL,CAAc,iBAAd,GAAoCoR,CAAI,CAACnT,GAAL,CAAS,SAAT,EAAsB1E,CAA9D,CAA8E,CAC1E6X,CAAI,CAACnT,GAAL,CAAS,SAAT,CAAoB1E,CAAc,CAAG,CAArC,CACH,CACJ,CACJ,CAPD,CAQH,CA1gBD,CA2gBH,CA9iBE,CAgjBV,CA/3CC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Main Javascript module for format_tiles for when user is editing.\n * See course_edit for if they are not editing.\n * Handles the UI changes when tiles are selected and anything else not\n * covered by the specific modules\n *\n * @module      format_tiles/course\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nvar scriptname = document.currentScript.getAttribute(\"data-requiremodule\");\nif (scriptname === \"core/first\") {\n    require.undef(\"format_tiles/edit_course\");\n}\ndefine('format_tiles/edit_course', [\"jquery\", \"core/templates\", \"core/ajax\", \"format_tiles/browser_storage\",\n        \"core/notification\", \"core/str\", \"format_tiles/tile_fitter\"],\n    function ($, Templates, ajax, browserStorage, Notification, str, tileFitter) {\n        \"use strict\";\n\n        var body = $(\"body\");\n        var bodyHtml = $(\"body, html\");\n        var isMobile;\n        var loadingIconHtml;\n        var stringStore = [];\n        var windowOverlay;\n        var headerOverlay;\n        var scrollFuncLock = false;\n        var sectionIsOpen = false;\n        var HEADER_BAR_HEIGHT = 60; // This varies by theme and version so will be reset once pages loads below.\n        var reopenLastVisitedSection = false;\n        var backDropZIndex = 0;\n        var courseId;\n        var resizeLocked = false;\n        var enableCompletion;\n\n        // Keep a record of which tile is currently open.\n        var openTile = 0;\n\n        var Selector = {\n            PAGE: \"#page\",\n            TILE: \".tile\",\n            TILEID: \"#tile-\",\n            MOVEABLE_SECTION: \".moveablesection\",\n            FILTER_BUTTON: \".filterbutton\",\n            TILE_LOADING_ICON: \".tile-loading-icon\",\n            TILE_LOADING_ICON_ID: \"#loading-icon-\",\n            TILE_COLLAPSED: \".tile-collapsed\",\n            TILE_CLICKABLE: \".tile-clickable\",\n            TILE_SELECTED: \".tile-clickable.selected\",\n            TILE_NONSELECTED: \"tile-clickable:not(.selected)\",\n            TILES: \"ul.tiles\",\n            ACTIVITY: \".activity\",\n            SPACER: \".spacer\",\n            SECTION_MOVEABLE: \".moveablesection\",\n            SECTION_ID: \"#section-\",\n            SECTION_TITLE: \".sectiontitle\",\n            SECTION_MAIN: \".section.main\",\n            SECTION_BUTTONS: \"#sectionbuttons\",\n            CLOSE_SEC_BTN: \".closesectionbtn\",\n            HIDE_SEC0_BTN: \"#buttonhidesec0\",\n            SECTION_ZERO: \"#section-0\",\n            MOODLE_VIDEO: \".mediaplugin.mediaplugin_videojs\",\n            LAUNCH_STANDARD: '[data-action=\"launch-tiles-standard\"]',\n            TOOLTIP: \"[data-toggle=tooltip]\",\n            HEADER_BAR: [\"#main-menu\"],\n            MENU_BAR: \".menubar\",\n            DROPDOWN_MENU: \".dropdown-menu\",\n            HIDDEN_TOGGLE: \"div.hiddentoggle\",\n            DRAGDROP: \".dragdropwrap\",\n            MULTI_SECTION_TILE_AREA: \"#multi_section_tiles\",\n            SUBTILEDRAGDROP: \".subtilecontrols > .editing_move\",\n        };\n        var ClassNames = {\n            SELECTED: \"selected\",\n            HEADER_OVERLAY: \"header-overlay\",\n            OPEN: \"open\",\n            CLOSED: \"closed\",\n            LAUNCH_CM_MODAL: \"launch-tiles-cm-modal\",\n            STATE_VISIBLE: 'state-visible' // This is a Snap theme class and was added to make this format cooperate better with it.\n        };\n\n        var Event = {\n            CLICK: \"click\",\n            KEYDOWN: \"keydown\",\n            SCROLL: \"scroll\",\n            MOUSEDOWN: \"mousedown\",\n            MOUSEUP: \"mouseup\",\n            MOUSEMOVE: \"mousemove\",\n            MOUSEOVER: \"mouseover\",\n            TOUCHDOWN: \"touchstart\",\n            TOUCHUP: 'touchend',\n            TOUCHOVER: 'touchover',\n            TOUCHMOVE: 'touchmove'\n        };\n\n        var CSS = {\n            DISPLAY: \"display\",\n            Z_INDEX: \"z-index\",\n            HEIGHT: \"height\",\n            BG_COLOUR: \"background-color\"\n        };\n        var Keyboard = {\n            ESCAPE: 27,\n            TAB: 9,\n            RETURN: 13\n        };\n\n        /**\n         * Because headeroverlay may not exist, we want to avoid trying to fade if not there.\n         * @param {boolean} fadeIn whether to fade in (fade out otherwise).\n         * @returns {boolean}\n         */\n        var headerOverlayFadeInOut = function(fadeIn) {\n            if (headerOverlay === undefined) {\n                return false;\n            } else {\n                var headerBar = $(Selector.HEADER_BAR.find(function(selector) {\n                    return $(selector).length > 0;\n                }));\n                if (fadeIn === true) {\n                    headerOverlay.fadeIn({\n                        duration: 300,\n                        step: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                        },\n                        complete: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170, 0.6)`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170, 0.6)`);\n                        }\n                    });\n                } else {\n                    headerOverlay.fadeOut({\n                        duration: 300,\n                        step: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                        },\n                        complete: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170, 0)`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170, 0)`);\n                        }\n                    });\n                }\n                return true;\n            }\n        };\n\n        /**\n         * If we have embedded video in section, stop it.\n         * Runs when section is closed.\n         * @param {number} section where the video is.\n         */\n        var stopVideoPlaying = function(section) {\n            var contentSection = $(Selector.SECTION_ID + section);\n\n            // First iframes (e.g. embedded YouTube).\n            contentSection.find(\"iframe\").each(function (index, iframe) {\n                iframe = $(iframe);\n                // Remove the src from the iframe but keep it in case the section is re-opened.\n                if (iframe.attr('src')) {\n                    iframe.attr('data-src', iframe.attr(\"src\"));\n                    iframe.attr('src', \"\");\n                }\n            });\n\n            // Then Moodle media player.\n            var mediaPlayers = contentSection.find(Selector.MOODLE_VIDEO);\n            if (mediaPlayers.length > 0) {\n                contentSection.html(\"\");\n            }\n        };\n\n        /**\n         * When JS navigation is being used, when a user un-selects a tile, we have to move the tile's z-index back so that it is\n         * no longer on top of the overlay, as well as removing its \"selected\" class, and hiding the overlay\n         * @param {number} sectionToFocus if we want to focus a tile after closing, which one\n         */\n        var cancelTileSelections = function (sectionToFocus) {\n            $(Selector.MOVEABLE_SECTION).each(function (index, sec) {\n                sec = $(sec);\n                if (sec.is(\":visible\")) {\n                    stopVideoPlaying(sec.attr(\"data-section\"));\n                    sec.slideUp().removeClass(ClassNames.STATE_VISIBLE); // Excludes section 0.\n                }\n            });\n            $(Selector.TILE).removeClass(ClassNames.SELECTED).css(CSS.Z_INDEX, \"\").css(CSS.BG_COLOUR, \"\");\n            $(\".section \" + ClassNames.SELECTED).removeClass(ClassNames.SELECTED).css(CSS.Z_INDEX, \"\");\n            windowOverlay.fadeOut(300);\n            headerOverlayFadeInOut(false);\n            if (sectionToFocus !== undefined && sectionToFocus !== 0) {\n                $(Selector.TILEID + sectionToFocus).focus();\n            }\n            $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                $(Selector.TILE_LOADING_ICON).html(\"\");\n            });\n            sectionIsOpen = false;\n            openTile = 0;\n        };\n\n        /**\n         * Set the HTML for a course section to the correct div in the page\n         * @param {Object} contentArea the jquery object for the content area\n         * @param {String} content the HTML\n         * @returns {boolean} success\n         */\n        var setCourseContentHTML = function (contentArea, content) {\n            if (content) {\n                contentArea.html(content);\n                $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                    $(Selector.TILE_LOADING_ICON).html(\"\");\n                });\n\n                if (contentArea.attr(\"id\") !== Selector.SECTION_ZERO) {\n                    // Trap the tab key navigation in the content bearing section.\n                    // Until the user clicks the close button.\n                    // When user reaches last item, send them back to first.\n                    // And vice versa if going backwards.\n\n                    var activities = contentArea.find(Selector.ACTIVITY).not(Selector.SPACER);\n                    contentArea.on(Event.KEYDOWN, function (e) {\n                        if (e.keyCode === Keyboard.ESCAPE) {\n                            // Close open tile, and return focus to closed tile, for screen reader user.\n                            browserStorage.setLastVisitedSection(0);\n                            cancelTileSelections(0);\n                            $(Selector.TILEID + contentArea.attr('data-section')).focus();\n                        }\n                    });\n                    activities.on(Event.KEYDOWN, function (e) {\n                        if (e.keyCode === Keyboard.RETURN) {\n                            var toClick = $(e.currentTarget).find(\"a\");\n                            if (toClick.hasClass(ClassNames.LAUNCH_CM_MODAL)) {\n                                toClick.click();\n                            } else if (toClick.attr(\"href\") !== undefined) {\n                                window.location = toClick.attr(\"href\");\n                            }\n                        }\n                    });\n                    if (!isMobile) {\n                        activities.last().on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.TAB && !e.shiftKey\n                                && $(e.relatedTarget).closest(Selector.SECTION_MAIN).attr(\"id\") !== contentArea.attr(\"id\")) {\n                                // RelatedTarget is the item we tabbed to.\n                                // If we reached here, the item we are on is not a member of the section we were in.\n                                // (I.e. we are trying to tab out of the bottom of section) so move tab back to first item instead.\n                                setTimeout(function () {\n                                    // Allow very short delay so we dont skip forward on the basis of our last key press.\n                                    contentArea.find(Selector.SECTION_TITLE).focus();\n                                    bodyHtml.animate({scrollTop: contentArea.offset().top - HEADER_BAR_HEIGHT}, \"slow\");\n                                    contentArea.find('#sectionbuttons').css(\"top\", \"\");\n                                }, 200);\n                            }\n                        });\n                        contentArea.find(Selector.SECTION_TITLE).on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.TAB && e.shiftKey\n                                && $(e.relatedTarget).closest(Selector.SECTION_MAIN).attr(\"id\") !== contentArea.attr(\"id\")) {\n                                // See explanation previous block.\n                                // Here we are trying to tab backwards out of the top of our section.\n                                // So take us to last item instead.\n                                setTimeout(function () {\n                                    activities.last().focus();\n                                }, 200);\n                            }\n                        });\n                    }\n                }\n\n                if (!isMobile) {\n                    // Activate tooltips for completion toggle and any \"restricted\" items in this content.\n                    setTimeout(function () {\n                        // Manual forms, auto icons and \"Restricted until ...\" etc.\n                        try {\n                            const tooltipItems = contentArea.find(\".togglecompletion, .completioncheckbox, .tag-info\");\n                            if (tooltipItems.length > 0) {\n                                tooltipItems.tooltip();\n                            }\n                        } catch (err) {\n                            require([\"core/log\"], function(log) {\n                                log.debug(err);\n                            });\n                        }\n                    }, 500);\n                }\n                // As we have just loaded new content, ensure that we initialise videoJS media player if required.\n                if (contentArea.find(Selector.MOODLE_VIDEO).length !== 0) {\n                    require([\"media_videojs/loader\"], function(videoJS) {\n                        videoJS.setUp();\n                    });\n                }\n\n                return true;\n            }\n            return false;\n        };\n\n        /**\n         * Get X, Y from event\n         */\n        var getCoordinatesFromEvent = function(event) {\n            var xcoord;\n            var ycoord;\n            if (event.type.includes(\"touch\")) {\n                var touch = event.originalEvent.touches[0] || event.originalEvent.changedTouches[0];\n                xcoord = touch.clientX;\n                ycoord = touch.clientY;\n            } else if (event.type.includes(\"mouse\")) {\n                xcoord = event.clientX;\n                ycoord = event.clientY;\n            }\n            return {\n                x: xcoord,\n                y: ycoord\n            };\n        };\n\n        /**\n         * Triggers a \"touchover\" event at the current position\n         */\n        var touchoverdetector = function (e) {\n            var position = getCoordinatesFromEvent(e);\n            var object = document.elementFromPoint(position.x, position.y);\n            $(object).trigger(Event.TOUCHOVER, e);\n        };\n\n        /**\n         * Initialize a sectiontilesdragdrop features\n         */\n        var initializeDragdropSubtiles = function() {\n            // Touch doesn't have a Mouseover equivalent, so fake it.\n            $('html').on(Event.TOUCHMOVE, Selector.ACTIVITY, touchoverdetector);\n            var page = $(\"#page-content\");\n            page.on(Event.MOUSEDOWN + \" \" + Event.TOUCHDOWN, Selector.SUBTILEDRAGDROP, function (e) {\n                e.preventDefault();\n                e.stopPropagation();\n                if (e.button && !e.type === Event.TOUCHUP) {\n                    // It's not the primary button being clicked.\n                    return;\n                }\n                var draggingdrag = e.currentTarget;\n                var dragsubtile = $(draggingdrag).closest(Selector.ACTIVITY);\n                var rect = dragsubtile.parent()[0].getBoundingClientRect();\n                var dimensions = dragsubtile[0].getBoundingClientRect();\n                var coordinates = getCoordinatesFromEvent(e);\n                var dragholo = dragsubtile.clone(true).css('opacity', '0.5')\n                    .css('position', 'absolute')\n                    .css('left', coordinates.x - rect.left - 8 + \"px\")\n                    .css('top', coordinates.y - rect.top - 8 + \"px\")\n                    .css('pointer-events', 'none')\n                    .css('width', dimensions.width)\n                    .css('height', dimensions.height)\n                    .attr('id', 'dragholo');\n                dragholo.insertAfter(dragsubtile);\n                var holocallback = function (e) {\n                    var cords = getCoordinatesFromEvent(e);\n                    var rect = dragholo.parent()[0].getBoundingClientRect();\n                    dragholo.css('left', cords.x - rect.left - 8 + \"px\")\n                        .css('top', cords.y - rect.top - 8 + \"px\");\n                };\n                var subtilehovercallback = function (e) {\n                    var targetsubtile = $(e.currentTarget);\n                    var targetindex = targetsubtile.index();\n                    var dragindex = dragsubtile.index();\n                    if (targetindex === dragindex) {\n                        return;\n                    } else if (targetindex < dragindex) {\n                        targetsubtile.before(dragsubtile);\n                    } else {\n                        targetsubtile.after(dragsubtile);\n                    }\n                };\n                var mouseupcallback = function (e) {\n                    if (e.button && !e.type === Event.TOUCHUP) {\n                        // It's not the primary button being clicked.\n                        return;\n                    }\n                    $('html').off(Event.MOUSEUP + \" \" + Event.TOUCHUP, mouseupcallback);\n                    $('html').off(Event.MOUSEMOVE + \" \" + Event.TOUCHMOVE, holocallback);\n                    $('#dragholo').remove();\n                    page.off(Event.MOUSEOVER + \" \" + Event.TOUCHOVER, Selector.ACTIVITY, subtilehovercallback);\n                    // Are we above another subtile?\n                    var overlay = windowOverlay.is(\":visible\");\n                    if (overlay) {\n                        windowOverlay.hide();\n                    }\n                    var cords = getCoordinatesFromEvent(e);\n                    var dragtarget = $(document.elementFromPoint(cords.x, cords.y));\n                    if (overlay) {\n                        windowOverlay.show();\n                    }\n                    var query = '.tile.tile-clickable';\n                    if (overlay) {\n                        query += ', #section-0';\n                    }\n                    var tilelist = dragtarget.closest(query);\n                    var cmid = dragsubtile.attr('data-cmid');\n                    var xhttp = new XMLHttpRequest();\n                    var url = M.cfg.wwwroot + \"/course/rest.php\";\n                    var data = \"?sesskey=\" + M.cfg.sesskey + \"&courseId=\" + courseId\n                        + \"&class=resource&field=move&id=\" + cmid;\n                    var secid;\n                    if (tilelist.length > 0) { // We dropped to another tile.\n                        var targettile = $(tilelist[0]);\n                        secid = $(Selector.MULTI_SECTION_TILE_AREA).children('.tile').index(targettile) + 1;\n                        data += \"&sectionId=\" + secid;\n                        data += \"&beforeId=0\";\n                        var activitylist = $('#section-' + secid).find('ul.section');\n                        activitylist.append(dragsubtile);\n                        xhttp.onreadystatechange = function () {\n                            if (this.readyState == 4 && this.status == 200) {\n                                window.location.reload(false);\n                            }\n                        };\n                    } else {\n                        var sectionbody = dragsubtile.closest('.section.main');\n                        if (!sectionbody.length > 0) {\n                            return;\n                        }\n                        secid = sectionbody.attr(\"data-section\");\n                        var beforeid = 0;\n                        var nexttile = dragsubtile.next();\n                        if (nexttile.length > 0) {\n                            beforeid = nexttile.attr('data-cmid');\n                        }\n                        data += \"&sectionId=\" + secid;\n                        data += \"&beforeId=\" + beforeid;\n                    }\n                    xhttp.open(\"GET\", url + data);\n                    xhttp.send();\n                };\n                page.on(Event.MOUSEOVER + \" \" + Event.TOUCHOVER, Selector.ACTIVITY, subtilehovercallback);\n                $('html').on(Event.MOUSEUP + \" \" + Event.TOUCHUP, mouseupcallback);\n                $('html').on(Event.MOUSEMOVE + \" \" + Event.TOUCHMOVE, holocallback);\n            });\n        };\n\n        var FITTINGSELECTORS = [\".action-menu\"];\n        /**\n         * Trys to fit the action menus to eachother\n         * @param {number} sectionid the section in which to fit the actionmenus\n         */\n        var fitActionMenusForSection = function (sectionid) {\n            var section = $('#section-' + sectionid);\n            FITTINGSELECTORS.forEach(function (selector) {\n                var menulist = section.find(selector);\n                var minX = menulist[0].getBoundingClientRect().x;\n                menulist.each(function (index, menu) {\n                    minX = Math.min(menu.getBoundingClientRect().x, minX);\n                });\n                menulist.each(function(index, menu) {\n                    $(menu).css('margin-right', 0);\n                    $(menu).css('margin-right', menu.getBoundingClientRect().x - minX);\n                });\n                return true;\n            });\n        };\n\n        /**\n         * Expand a content containing section (e.g. on tile click)\n         * @param {object} contentArea\n         * @param {number} tileId to expand\n         * @param {boolean} whether to scroll to the tile\n         */\n        var expandSection = function (contentArea, tileId, scroll) {\n            var expandAndScroll = function () {\n                // Scroll to the top of content bearing section\n                // we have to wait until possible reOrg and slide down totally before calling this, else co-ords are wrong.\n                var scrollTo = $(\"#tile-\" + tileId).offset().top - HEADER_BAR_HEIGHT;\n                if (scrollTo === $(window).scrollTop) {\n                    // Scroll by at least one pixel otherwise z-index on selected tile is not changed.\n                    // Until mouse moves.\n                    scrollTo += 1;\n                }\n                contentArea.find(Selector.SECTION_TITLE).focus();\n                // If user tries to scroll during animation, stop animation.\n                var events = \"scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove\";\n                body.on(events, function () {\n                    body.stop();\n                });\n                if (scroll) {\n                    bodyHtml.animate({scrollTop: scrollTo}, \"slow\", function () {\n                        // Animation complete, remove stop handler.\n                        bodyHtml.off(events, function () {\n                            bodyHtml.stop();\n                        });\n                    });\n                }\n                sectionIsOpen = true;\n                openTile = tileId;\n\n                // For users with screen readers, move focus to the first item within the tile.\n                contentArea.find(Selector.ACTIVITY).first().focus();\n\n                // If we have any iframes in the section which were previous emptied out, re-populate.\n                // This will happen if we have previously closed a section with videos in, and they were muted.\n                const iframes = contentArea.find(\"iframe\");\n                if (iframes.length > 0) {\n                    iframes.each(function (index, iframe) {\n                        iframe = $(iframe);\n                        // If iframe has no src, add it from data-src.\n                        if (iframe.attr('src') === '' && iframe.attr('data-src') !== undefined) {\n                            iframe.attr('src', iframe.attr(\"data-src\"));\n                        }\n                    });\n\n                    if (enableCompletion) {\n                        // Some iframes may load content set to mark as complete on view.\n                        // So maybe need to update tile completion info. E.g. applies with H5P filter.\n                        require([\"format_tiles/completion\"], function (completion) {\n                            setTimeout(() => {\n                                completion.updateTileInformation();\n                            }, 1000);\n                        });\n                    }\n                }\n            };\n\n            /**\n             * Make sure that the section close and edit buttons always appear at the top of the section on scroll\n             */\n            var holdSectionButtonPosition = function () {\n                var buttons = contentArea.find(Selector.SECTION_BUTTONS);\n                $(window).on(Event.SCROLL, function () {\n                    if (!scrollFuncLock && sectionIsOpen) {\n                        scrollFuncLock = true;\n                        buttons.fadeOut(300);\n                        setTimeout(function () {\n                            var windowTop = $(window).scrollTop();\n                            var desiredNewPositionInSection = (windowTop - contentArea.offset().top + 50);\n                            if (desiredNewPositionInSection > 0\n                                && desiredNewPositionInSection < contentArea.outerHeight() - 100) {\n                                desiredNewPositionInSection = (windowTop - contentArea.offset().top + 50);\n                                buttons.css(\"top\", desiredNewPositionInSection);\n                                if (windowOverlay.css(CSS.DISPLAY) === \"none\") {\n                                    windowOverlay.fadeIn(300);\n                                    headerOverlayFadeInOut(true);\n                                }\n                            } else if (desiredNewPositionInSection < 0) {\n                                buttons.css(\"top\", 0);\n                            }\n                            if (windowTop > contentArea.offset().top + contentArea.outerHeight() - 50) {\n                                // We have scrolled down and content bottom has gone out of the top of window.\n                                if (windowOverlay.css(CSS.DISPLAY) === \"block\") {\n                                    windowOverlay.fadeOut(300);\n                                    headerOverlayFadeInOut(false);\n                                }\n                                buttons.css(\"top\", 0);\n                            } else if (contentArea.offset().top > windowTop + $(window).outerHeight()) {\n                                // We have scrolled up and  content bottom has gone out of the bottom of window.\n                                if (windowOverlay.css(CSS.DISPLAY) === \"block\") {\n                                    windowOverlay.fadeOut(300);\n                                    headerOverlayFadeInOut(false);\n                                }\n                                buttons.css(\"top\", 0);\n                            } else if (windowOverlay.css(CSS.DISPLAY) === \"none\") {\n                                windowOverlay.fadeIn(300);\n                                headerOverlayFadeInOut(true);\n                            }\n                            buttons.fadeIn(300, function () {\n                                // Release lock on this function.\n                                scrollFuncLock = false;\n                            });\n                        }, 500);\n                    }\n                });\n                if (!scrollFuncLock && !sectionIsOpen && windowOverlay.is(\":visible\")) {\n                    windowOverlay.fadeOut(300);\n                }\n            };\n            contentArea.addClass(ClassNames.STATE_VISIBLE);\n            contentArea.slideDown(350, \"linear\", function () {\n                // Wait until we have finished sliding down before we work out where the top is for scroll.\n                expandAndScroll();\n                holdSectionButtonPosition();\n            });\n            openTile = tileId;\n        };\n\n        /**\n         * We find out what section is open, collapse them all, then run the re-org.\n         * Finally we re-open the section.\n         * This is to ensure that the content bearing section is on the row under the tile clicked.\n         * It is run at page load and again if window is re-sized etc.\n         * @param {boolean} delayBefore do we want a delay before we re-org.  This allows e.g. browser resizing to complete.\n         * @param {boolean} fitTilesToScreenWidth whether we need to resize the tiles window while tiles are closed.\n         * @returns {Promise}\n         */\n        var reOrgSections = function (delayBefore, fitTilesToScreenWidth) {\n            var dfd = new $.Deferred();\n            var openedSection = $(\".moveablesection:visible\");\n            var openedSectionNum = 0;\n            if (openedSection.length > 0) {\n                openedSectionNum = openedSection.attr(\"data-section\");\n                cancelTileSelections();\n            }\n            var reOrgFunc = function(delayBefore) {\n                tileFitter.runReOrg(delayBefore)\n                    .done(function(result) {\n                        if (openedSectionNum !== 0) {\n                            expandSection(openedSection, openedSectionNum);\n                        }\n                        dfd.resolve(result);\n                    })\n                    .fail(function(result) {\n                        if (openedSectionNum !== 0) {\n                            expandSection(openedSection, openedSectionNum);\n                        }\n                        dfd.reject(result);\n                    });\n            };\n\n            if (fitTilesToScreenWidth) {\n                setTimeout(function() {\n                    tileFitter.resizeTilesDivWidth(courseId).done(function() {\n                        reOrgFunc(false);\n                    }, delayBefore);\n                });\n\n            } else {\n                reOrgFunc(delayBefore);\n            }\n            return dfd.promise();\n        };\n\n        var failedLoadSectionNotify = function(sectionNum, failResult, contentArea) {\n            if (failResult) {\n                // Notify the user and invite them to refresh.  We did get a \"failResult\" from server,\n                // So it looks like we do have a connection and can launch this.\n                Notification.confirm(\n                    stringStore.sectionerrortitle,\n                    stringStore.sectionerrorstring,\n                    stringStore.refresh,\n                    stringStore.cancel,\n                    function () {\n                        window.location.reload();\n                    },\n                    null\n                );\n                contentArea.html(\"\"); // Clear loading icon.\n            } else {\n                // It looks like we may not have a connection so we can't launch notifications.\n                // We can warn the user like this instead.\n                setCourseContentHTML(contentArea, \"<p>\" + stringStore.noconnectionerror + \"</p>\");\n                setTimeout(function () {\n                    expandSection(contentArea, sectionNum);\n                }, 500);\n            }\n            require([\"core/log\"], function(log) {\n                log.debug(failResult);\n            });\n            throw new Error(\"Not successful retrieving tile content by AJAX for section \" + sectionNum);\n        };\n\n        /**\n         * For a given section, get the content from the server, add it to the store and maybe UI and maybe show it\n         * @param {number} courseId the id for the affected course\n         * @param {number} sectionNum the section number we are wanting to populate\n         * @return {Promise} promise to resolve when the ajax call returns.\n         */\n        var getSectionContentFromServer = function (courseId, sectionNum) {\n            return ajax.call([{\n                methodname: \"format_tiles_get_single_section_page_html\",\n                args: {\n                    courseid: courseId,\n                    sectionid: sectionNum,\n                    setjsusedsession: true\n                }\n            }])[0];\n        };\n\n        /**\n         * Temporary function to adjust shade of RGB colour\n         * (used for shading tiles to get around transparent background on overlay issue)\n         * @param {number} R\n         * @param {number} G\n         * @param {number} B\n         * @param {number} percent\n         * @returns {string}\n         */\n        var shadeRGBColor = function (R, G, B, percent) {\n            var t = percent < 0 ? 0 : 255;\n            var p = percent < 0 ? percent * -1 : percent;\n            var r = Math.round((t - R) * p) + R;\n            var g = Math.round((t - G) * p) + G;\n            var b = Math.round((t - B) * p) + B;\n            return \"rgb(\" + r + \",\" + g + \",\" + b + \")\";\n        };\n\n        /**\n         * Add an opaque modal backdrop like div to obscure all other tiles and bring specified tile and content to front\n         * @param {number} secNumOnTop the section number which should be displayed on top of the overlay\n         */\n        var setOverlay = function (secNumOnTop) {\n            windowOverlay.fadeIn(300);\n            backDropZIndex = parseInt(windowOverlay.css(CSS.Z_INDEX));\n            var tile = $(Selector.TILEID + secNumOnTop);\n            tile.css(CSS.Z_INDEX, (backDropZIndex + 2));\n            headerOverlayFadeInOut(true);\n            $(Selector.SECTION_ID + secNumOnTop).css(CSS.Z_INDEX, (backDropZIndex + 1));\n            if (tile.css(CSS.BG_COLOUR) && tile.css(CSS.BG_COLOUR).substr(0, 4) === \"rgba\") {\n                // Tile may have transparent background from theme - needs to be solid otherwise modal shows through.\n                var existingColour = tile.css(CSS.BG_COLOUR).replace(\"rgba(\", \"\").replace(\")\", \"\").replace(\" \", \"\").split(\",\");\n                tile.css(CSS.BG_COLOUR, shadeRGBColor(\n                    parseInt(existingColour[0]),\n                    parseInt(existingColour[1]),\n                    parseInt(existingColour[2]),\n                    0.95\n                ));\n            }\n        };\n\n        /**\n         * Used where the user clicks the window overlay but we want the active click to be behind the\n         * overlay e.g. the tile or custom menu item behind it.  So we get the co-ordinates of the click\n         * on the overlay and then repeat the click at that spot ignoring the overlay\n         * @param {object} e the click event object\n         */\n        var clickItemBehind = function (e) {\n            var clickedItem = $(e.currentTarget);\n            if (clickedItem.attr(\"id\") === \"window-overlay\" || clickedItem.attr(\"id\") === ClassNames.HEADER_OVERLAY) {\n                // We need to know what is behind the modal, so hide it for an instant to find out.\n                clickedItem.hide();\n                var BottomElement = $(document.elementFromPoint(e.clientX, e.clientY));\n                clickedItem.show();\n                if (clickedItem.attr(\"id\") === \"window-overlay\") {\n                    if (BottomElement.hasClass(\"filterbutton\") || BottomElement.hasClass(\"list-group-item\")) {\n                        // Must ba a filter button clicked or a nav drawer item.\n                        BottomElement.click();\n                    } else {\n                        // Must be a tile clicked.\n                        var clickedTile = BottomElement.closest(Selector.TILE);\n                        if (clickedTile) {\n                            clickedTile.click();\n                        }\n                    }\n                } else {\n                    // Must be a click on the header bar.\n                    cancelTileSelections(0);\n                    BottomElement.click();\n                }\n            }\n        };\n\n        /**\n         * If the user had section zero collapsed in this course previously, collapse it now\n         */\n        var setSectionZeroFromUserPref = function () {\n            var buttonHideSecZero = $(Selector.HIDE_SEC0_BTN);\n            var sectionZero = $(Selector.SECTION_ZERO);\n            if (browserStorage.storageEnabledLocal()) {\n                // Collapse section zero if user had it collapsed before - relies on local storage so only if enabled.\n                if (browserStorage.getSecZeroCollapseStatus() === true) {\n                    sectionZero.slideUp(0);\n                    buttonHideSecZero.addClass(ClassNames.CLOSED).removeClass(ClassNames.OPEN); // Button image.\n                } else {\n                    sectionZero.slideDown(300);\n                    buttonHideSecZero.addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED); // Button image.\n                }\n            } else {\n                // Storage not available so we dont know if sec zero was previously collapsed - expand it.\n                buttonHideSecZero.addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED);\n                sectionZero.slideDown(300);\n            }\n        };\n\n        /**\n         * To be called when a tile is clicked. Get content from server or storage and display or store it.\n         * @param {number} courseId courseId the id of this course.\n         * @param {object} thisTile jquery the tile object clicked.\n         * @param {number} dataSection the id number of the tile.\n         * @param {number} storedContentExpirySecs\n         * @param {boolean} scroll whether to scroll to tile\n         */\n        var populateAndExpandSection = function(courseId, thisTile, dataSection, storedContentExpirySecs, scroll = true) {\n            setOverlay(dataSection);\n            $(Selector.TILE).removeClass(ClassNames.SELECTED);\n            thisTile.addClass(ClassNames.SELECTED);\n            openTile = dataSection;\n            // Then close all open secs.\n            // Timed to finish in 200 so that it completes well before the opening next.\n            $(Selector.MOVEABLE_SECTION).each(function (index, sec) {\n                sec = $(sec);\n                if (sec.is(\":visible\")) {\n                    stopVideoPlaying(sec.attr(\"data-section\"));\n                    sec.slideUp(200).removeClass(ClassNames.STATE_VISIBLE); // Excludes section 0.\n                }\n            });\n            // Log the fact we viewed the section.\n            ajax.call([{\n                methodname: \"format_tiles_log_tile_click\", args: {\n                    courseid: courseId,\n                    sectionid: dataSection\n                }\n            }])[0].fail(Notification.exception);\n            // Get the content - use locally stored content first if available.\n            var relatedContentArea = $(Selector.SECTION_ID + dataSection);\n            if (relatedContentArea.find(Selector.ACTIVITY).length > 0) {\n                // There is already some content on the screen so display immediately.\n                expandSection(relatedContentArea, dataSection, scroll);\n                // Then refresh the content in storage only but do not change on screen.\n                if (browserStorage.getStoredContentAge(courseId, dataSection) > storedContentExpirySecs\n                    || !browserStorage.getStoredContentAge(courseId, dataSection)) {\n                    // If stored content is old, replace it.\n                    getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                        if (browserStorage.storageEnabledSession()) {\n                            browserStorage.storeCourseContent(courseId, dataSection, $(response.html).html());\n                        }\n                    });\n                }\n            } else {\n                relatedContentArea.html(loadingIconHtml);\n                if (browserStorage.storageEnabledLocal()) {\n                    var contentAge = browserStorage.getStoredContentAge(courseId, dataSection);\n                    if (contentAge) {\n                        // We have some stored content so display it even if it's expired.\n                        setCourseContentHTML(\n                            relatedContentArea,\n                            browserStorage.getCourseContent(courseId, dataSection)\n                        );\n                        expandSection(relatedContentArea, dataSection, scroll);\n                    }\n                    if (!contentAge || contentAge > storedContentExpirySecs) {\n                        // Content in local storage may not exist or have expired.\n                        // If so, get it again from server and display new content on receipt.\n                        var loadingIcon = $(Selector.TILE_LOADING_ICON_ID + dataSection);\n                        if (loadingIcon !== undefined) {\n                            loadingIcon.html(loadingIconHtml).fadeIn(200);\n                        } else {\n                            loadingIcon = $(\"<div>\").html(loadingIconHtml);\n                            relatedContentArea.html(loadingIcon);\n                        }\n                        getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                            var contentToDisplay = $(response.html).html();\n                            setCourseContentHTML(relatedContentArea, contentToDisplay);\n                            expandSection(relatedContentArea, dataSection, scroll);\n                            if (browserStorage.storageEnabledSession()) {\n                                browserStorage.storeCourseContent(courseId, dataSection, contentToDisplay);\n                            }\n                        }).fail(function (failResult) {\n                            failedLoadSectionNotify(dataSection, failResult, relatedContentArea);\n                            cancelTileSelections(dataSection);\n                        });\n                    }\n                } else {\n                    // Not using storage so get from server.\n                    getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                        setCourseContentHTML(relatedContentArea, $(response.html).html());\n                        expandSection(relatedContentArea, dataSection, scroll);\n                    }).fail(function (failResult) {\n                        failedLoadSectionNotify(dataSection, failResult, relatedContentArea);\n                        cancelTileSelections(dataSection);\n                    });\n                }\n            }\n            browserStorage.setLastVisitedSection(dataSection);\n            fitActionMenusForSection(dataSection);\n        };\n\n        return {\n            init: function (\n                courseIdInit,\n                useJavascriptNav, // Set by site admin see settings.php.\n                maxContentSectionsToStore, // Set by site admin see settings.php.\n                isMobile,\n                sectionNum,\n                storedContentExpirySecs, // Set by site admin see settings.php.\n                storedContentDeleteMins, // Set by site admin see settings.php.\n                useFilterButtons,\n                assumeDataStoreConsent, // Set by site admin see settings.php.\n                reopenLastSection, // Set by site admin see settings.php.\n                userId,\n                fitTilesToWidth,\n                usingH5pFilter,\n                enableCompletionInit,\n            ) {\n                courseId = courseIdInit;\n                // Some args are strings or ints but we prefer bool.  Change to bool now as they are passed on elsewhere.\n                reopenLastVisitedSection = reopenLastSection === \"1\";\n                useFilterButtons = useFilterButtons === 1;\n                assumeDataStoreConsent = assumeDataStoreConsent === \"1\";\n                enableCompletion = enableCompletionInit === \"1\";\n                // We want to initialise the browser storage JS module for storing user settings.\n                // And (depending on maxContentSectionsToStore) possibly also content in browser.\n                browserStorage.init(\n                    courseId,\n                    maxContentSectionsToStore,\n                    false,\n                    sectionNum,\n                    storedContentDeleteMins,\n                    assumeDataStoreConsent,\n                    userId\n                );\n                browserStorage.cleanUpStorage();\n                $(document).ready(function () {\n                    var pageContent = $(\"#page-content\");\n                    if (pageContent.length === 0) {\n                        // Some themes e.g. RemUI do not have a #page-content div, so use #region-main.\n                        pageContent = $(\"#region-main\");\n                    }\n                    fitActionMenusForSection(0);\n\n                    // If we are being told to launch a section number from the URL, use that.\n                    if (sectionNum !== 0) {\n                        openTile = sectionNum;\n                    } else {\n                        // Don't use the URL param - check local storage instead.\n                        if (reopenLastVisitedSection && browserStorage.storageEnabledLocal) {\n                            openTile = browserStorage.getLastVisitedSection();\n                            // If user is not on mobile, retrieve last visited section id from browser storage (if present).\n                            // And click it.\n                        }\n                    }\n                    if (openTile !== 0) {\n                        tileFitter.init(courseId, openTile, fitTilesToWidth, false);\n                    } else {\n                        // Set focus to the first tile (not section zero).\n                        $(Selector.TILEID + \"1\").focus();\n                        tileFitter.init(courseId, null, fitTilesToWidth, false);\n                    }\n                    var windowWidth = $(window).outerWidth();\n\n                    if (useJavascriptNav) {\n\n                        // When a tile is clicked we add an overlay to grey out the rest of the tiles on the page, so prepare it.\n                        windowOverlay = $(\"<div></div>\").addClass(\"modal-backdrop fade in\").hide()\n                            .attr(\"id\", \"window-overlay\").appendTo(body);\n\n                        // If user clicks the window overlay behind the visible tile content, deselect tile.\n                        // (They want to remove the overlay).\n                        windowOverlay.click(function (e) {\n                            cancelTileSelections(0);\n                            clickItemBehind(e);\n                        });\n\n                        // On a click on the edit menu stop the tile from expanding.\n                        pageContent.on(Event.CLICK, Selector.MENU_BAR, function (e) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            var targetelement = e.target;\n                            var expanded = targetelement.getAttribute(\"aria-expanded\") === \"true\";\n                            var menuselector = targetelement.getAttribute(\"aria-controls\");\n                            var menuelement = $('#' + menuselector);\n                            if (expanded) {\n                                // Is expanded, collapse.\n                                targetelement.setAttribute(\"aria-expanded\", \"false\");\n                                menuelement.hide();\n                            } else {\n                                // Else expand.\n                                targetelement.setAttribute(\"aria-expanded\", \"true\");\n                                menuelement.show();\n                            }\n                        });\n\n                        pageContent.on(Event.CLICK, Selector.HIDDEN_TOGGLE, function (e) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            var xhttp = new XMLHttpRequest();\n                            var target = e.target;\n                            if (target.tagName !== \"DIV\") {\n                                target = target.closest(\".hiddentoggle\");\n                            }\n                            if (target.classList.contains(\"hidden\")) {\n                                return;\n                            }\n                            xhttp.onreadystatechange = function () {\n                                if (this.readyState == 4 && this.status == 200) {\n                                    target.classList.add(\"hidden\");\n                                    var parent = target.closest(\".tile-hidden\");\n                                    parent.classList.remove(\"tile-hidden\");\n                                    parent.querySelector(\".availabilityinfo\").classList.add(\"hidden\");\n                                }\n                            };\n                            xhttp.open(\"GET\", target.getAttribute(\"href\"));\n                            xhttp.send();\n                        });\n\n                        pageContent.on(Event.CLICK, Selector.DROPDOWN_MENU, function (e) {\n                            e.stopPropagation();\n                        });\n\n                        pageContent.on(Event.CLICK, Selector.DRAGDROP, function (e) {\n                            e.stopPropagation();\n                        });\n\n                        $('html').on(Event.TOUCHMOVE, Selector.MULTI_SECTION_TILE_AREA, touchoverdetector);\n\n                        pageContent.on(Event.MOUSEDOWN + \" \" + Event.TOUCHDOWN, Selector.DRAGDROP, function (e) {\n                            if (e.button && e.type !== Event.TOUCHDOWN) {\n                                return;\n                            }\n                            var dragdrop = e.target;\n                            if (dragdrop.tagName !== \"DIV\") {\n                                // Click is on image.\n                                dragdrop = e.target.closest(Selector.DRAGDROP);\n                            }\n                            dragdrop.setAttribute(\"aria-grabbed\", \"true\");\n\n                            var tile = $(\"#\" + dragdrop.getAttribute(\"aria-controls\"));\n\n                            tile.addClass(\"tile-moving\");\n                            tile.css('pointer-events', 'none');\n                            tile.css('transition', 'none');\n                            var pos = getCoordinatesFromEvent(e);\n                            var originalX = pos.x;\n                            var originalY = pos.y;\n                            var X = 0;\n                            var Y = 0;\n                            var moving = true;\n                            var positionUpdate = function () {\n                                if (moving) {\n                                    tile.css('transform', `translate(${X}px, ${Y}px)`);\n                                    window.requestAnimationFrame(positionUpdate);\n                                }\n                            };\n                            var holocallback = function (e) {\n                                var pos = getCoordinatesFromEvent(e);\n                                X = pos.x - originalX;\n                                Y = pos.y - originalY;\n                            };\n                            window.requestAnimationFrame(positionUpdate);\n                            $(\"html\").on(Event.MOUSEMOVE + \" \" + Event.TOUCHMOVE, holocallback);\n                            $(\"html\").on(Event.MOUSEUP + \" \" + Event.TOUCHUP, function (e) {\n                                moving = false;\n                                if (e.button && !e.type === Event.TOUCHUP) {\n                                    // It's not the primary button being clicked.\n                                    return;\n                                }\n                                $(\"html\").off(Event.MOUSEMOVE + \" \" + Event.TOUCHMOVE, holocallback);\n                                tile.css('pointer-events', '');\n                                tile.css('transform', '');\n                                tile.css('transition', '');\n                                dragdrop.setAttribute(\"aria-grabbed\", \"false\");\n\n                                $(\"html\").off(Event.MOUSEUP + \" \" + Event.TOUCHUP, this);\n                                pageContent.off(Event.MOUSEOVER + \" \" + Event.TOUCHOVER, Selector.MULTI_SECTION_TILE_AREA);\n\n                                var tilesecpos = $(Selector.MULTI_SECTION_TILE_AREA)\n                                    .children()\n                                    .filter(\".tile.tile-clickable\")\n                                    .index(tile) + 1;\n                                var oldpos = tile.attr(\"data-section\");\n\n                                if (parseInt(oldpos) === tilesecpos) {\n                                    return; // Nothing to do.\n                                }\n\n                                var xhttp = new XMLHttpRequest();\n                                windowOverlay.fadeIn();\n                                xhttp.onreadystatechange = function () {\n                                    if (this.readyState == 4 && this.status == 200) {\n                                        window.location.reload(false);\n                                    } else if (this.readyState == 4) {\n                                        windowOverlay.fadeOut();\n                                        str.get_strings({key: 'tilemovefailed', component: 'theme_wwu2019'},\n                                            {key: 'tilemovefailedtitle', component: 'theme_wwu2019'},\n                                            {key: 'Ok'})\n                                            .done(function(results) {\n                                                Notification.alert(\n                                                results[0],\n                                                results[1],\n                                                results[2]\n                                                );\n                                            });\n                                    }\n                                };\n                                var url = M.cfg.wwwroot + \"/course/rest.php\";\n                                var data = \"?sesskey=\" + M.cfg.sesskey + \"&courseId=\" + courseId\n                                    + \"&class=section&field=move&id=\" + tile.attr(\"data-section\")\n                                    + \"&value=\" + tilesecpos;\n                                xhttp.open(\"GET\", url + data);\n                                xhttp.send();\n\n                                var tilelist = $(Selector.MULTI_SECTION_TILE_AREA)\n                                    .children()\n                                    .filter(\".tile.tile-clickable\");\n                                var lineindexes = [];\n                                var last = -1;\n                                var lastelement = null;\n                                for (let i = 0; i < tilelist.length; i++) {\n                                    var element = tilelist[i];\n                                    var secindex = element.getAttribute(\"data-section\");\n                                    if ($(element).position().top > last) {\n                                        last = $(element).position().top;\n                                        if (lastelement !== null) {\n                                            for (var j = 0; j < lineindexes.length; j++) {\n                                                var index = lineindexes[j];\n                                                $(lastelement).after($(\"#section-\" + index));\n                                            }\n                                        }\n                                        lineindexes = [];\n                                    }\n                                    lastelement = element;\n                                    lineindexes.push(secindex);\n                                    element.setAttribute(\"data-section\", i + 1);\n                                    element.setAttribute(\"id\", \"tile-\" + (i + 1));\n\n                                }\n                                var sectionlist = $(Selector.MULTI_SECTION_TILE_AREA)\n                                    .children()\n                                    .filter(\".section\");\n\n                                for (let i = 1; i < tilelist.length; i++) {\n                                    sectionlist[i].setAttribute(\"id\", \"section-\" + i);\n                                    sectionlist[i].setAttribute(\"data-section\", i);\n                                }\n                                e.preventDefault();\n                                e.stopPropagation();\n                            });\n\n                            pageContent.on(Event.MOUSEOVER + \" \" + Event.TOUCHOVER, Selector.MULTI_SECTION_TILE_AREA, function (e) {\n                                var targettile = e.target;\n                                if (!targettile.classList.contains(\"tile-clickable\")) {\n                                    targettile = $(e.target).closest(\".tile.tile-clickable\");\n                                }\n                                if (targettile !== null && targettile.length) {\n                                    if ($(targettile).index() === tile.index()) {\n                                        return;\n                                    } else {\n                                        var targetdragdrop = targettile.find(Selector.DRAGDROP);\n                                        var offset = targetdragdrop[0].getBoundingClientRect();\n                                        originalX = offset.left + 8;\n                                        originalY = offset.top + 4;\n                                        if ($(targettile).index() > tile.index()) {\n                                            targettile.after(tile);\n                                        } else {\n                                            targettile.before(tile);\n                                        }\n                                    }\n                                }\n                            });\n\n                            e.preventDefault();\n                            e.stopPropagation();\n                        });\n\n                        // On a tile click, decide what to do an do it.\n                        // (Collapse if already expanded, or expand it and fill with content).\n                        pageContent.on(Event.CLICK, Selector.TILE_CLICKABLE, function (e) {\n                            // Prevent the link being followed to reload the PHP page as we are using JS instead.\n                            if (!useJavascriptNav) {\n                                return;\n                            }\n                            e.preventDefault();\n                            $(window).off(Event.SCROLL); // Stop listening for scroll events on ay previously opened tiles.\n                            // if other tiles have loading icons, fade them out (on the tile not the content sec).\n                            $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                                $(Selector.TILE_LOADING_ICON).html();\n                            });\n                            var thisTile = $(e.currentTarget).closest(Selector.TILE);\n                            var dataSection = parseInt(thisTile.attr(\"data-section\"));\n                            if (thisTile.hasClass(ClassNames.SELECTED)) {\n                                // This tile is already expanded so collapse it.\n                                cancelTileSelections(dataSection);\n                                browserStorage.setLastVisitedSection(0);\n                            } else {\n                                populateAndExpandSection(\n                                    courseId, thisTile, dataSection, storedContentExpirySecs\n                                );\n                            }\n                            // Silently set the *next* section's content to if it exists and if user is not on mobile.\n                            // short delay as more important to get current section content first (above).\n                            var nextSecIfExists = $(Selector.SECTION_ID + (dataSection + 1));\n                            if (!isMobile && !usingH5pFilter && nextSecIfExists.length && dataSection > 0) {\n                                setTimeout(function () {\n                                    var storedContentAge = browserStorage.getStoredContentAge(courseId, dataSection + 1);\n                                    if (storedContentAge) {\n                                        // We have some stored content so set this to screen (even if expired).\n                                        setCourseContentHTML(\n                                            nextSecIfExists,\n                                            browserStorage.getCourseContent(courseId, dataSection + 1)\n                                        );\n                                    }\n                                    if (!storedContentAge || storedContentAge > storedContentExpirySecs) {\n                                        // Stored content is too old or does not exist so get from server.\n                                        getSectionContentFromServer(courseId, dataSection + 1).done(function(response) {\n                                            setCourseContentHTML(\n                                                nextSecIfExists,\n                                                $(response.html).html()\n                                            );\n                                            if (browserStorage.storageEnabledSession()) {\n                                                browserStorage.storeCourseContent(\n                                                    courseId, dataSection + 1, $(response.html).html()\n                                                );\n                                            }\n                                        });\n                                    }\n                                }, 2000);\n                            }\n                        });\n\n                        // When window is re-sized, content sections under the tiles may be in wrong place.\n                        // So remove them and re-initialise them.\n                        // Collapse the selected section before doing this.\n                        // Otherwise the re-organisation won't work as the tiles' flow will be out when they are analysed.\n                        $(window).on(\"resize\", function () {\n                            // On iOS resize events are triggered often on scroll because the address bar hides itself.\n                            // Avoid this using windowWidth here.\n                            if (resizeLocked || windowWidth === $(window).outerWidth()) {\n                                return;\n                            }\n                            resizeLocked = true;\n\n                            // We wait for a short time before doing anything, as user may still be dragging window size change.\n                            // We don't want to react to say 20 resize events happening over a single drag.\n                            setTimeout(function() {\n                                // First assume that we are going to resize, but we have checks to make below.\n                                var resizeRequired = true;\n\n                                // If we have a Moodle media player div in the section in fullscreen, ignore this resize event.\n                                // It was probably caused when user pressed the full screen button.\n                                var openContentSection = $(\".moveablesection:visible\");\n                                if (openContentSection.length !== 0) {\n                                    var mediaPlayers = openContentSection.find(\".mediaplugin iframe\");\n                                    if (mediaPlayers.length !== 0) {\n                                        mediaPlayers.each(function (index, player) {\n                                            player = $(player);\n                                            if (player.outerWidth() > openContentSection.outerWidth()) {\n                                                // Video is present and playing full screen so don't react to resize event.\n                                                resizeRequired = false;\n                                            }\n                                        });\n                                    }\n                                }\n                                if (resizeRequired) {\n                                    // Set global for comparison next time.\n                                    windowWidth = $(window).outerWidth();\n                                    reOrgSections(true, fitTilesToWidth);\n                                }\n                                resizeLocked = false;\n                            }, 600);\n                        });\n\n                        initializeDragdropSubtiles();\n\n                        // We want the main menu at the top to be on top of the tiles.\n                        // Even the ones which we have brought to the front on top of the window overlay.\n                        // But we also want it to still be greyed out.  So add an opaque overlay.\n                        // We can show this when the main overlay is active.\n                        // When a user clicks this overlay, they want to close the overlay and click menu item behind.\n                        // So provide for that here.\n                        // Z-INDICES: Active tile content will be at overlayZindex + 1.\n                        // Active tile will be at overlayZindex + 2.\n                        // Header bar will be at overlayZindex + 3 so that it is higher than tiles.\n                        // Header bar overlay will be at overlayZindex + 4 so that it is highest of all.\n\n                        var overlayZindex = parseInt(windowOverlay.css(CSS.Z_INDEX));\n                        var headerBar = $(Selector.HEADER_BAR.find(function(selector) {\n                            return $(selector).length > 0;\n                        }));\n                        if (headerBar !== undefined && headerBar.length !== 0) {\n                            headerBar.css(CSS.Z_INDEX, overlayZindex + 3);\n                            if (headerBar.attr(\"id\") !== \"navwrap\") {\n                                // ID navwrap suggests theme is Adaptable based. We don't bother with header overlay if so.\n                                // Otherise the header bar has a separate mini overlay of its own - find and hide this.\n                                // If it is clicked, cancel tile selections and click the item behind where clicked.\n                                // Do not include for Moodle 3.5 or higher as not needed.\n                                if (headerBar.outerHeight() !== undefined) {\n                                    HEADER_BAR_HEIGHT = headerBar.outerHeight();\n                                    var logorect = document.getElementById(\"logo-header\").getBoundingClientRect();\n                                    var logoheight = logorect.y + logorect.height;\n                                    var logoy = Math.max(0, logoheight - window.scrollY);\n                                    headerOverlay = $(\"<div></div>\")\n                                        .addClass(ClassNames.HEADER_OVERLAY).attr(\"id\", ClassNames.HEADER_OVERLAY)\n                                        .css(CSS.DISPLAY, \"none\");\n                                    headerOverlay.insertAfter(Selector.HEADER_BAR)\n                                        .css(CSS.Z_INDEX, (overlayZindex) + 4).css(CSS.HEIGHT, HEADER_BAR_HEIGHT + logoy)\n                                        .click(function (e) {\n                                            cancelTileSelections(0);\n                                            clickItemBehind(e);\n                                        });\n                                    window.addEventListener(Event.SCROLL, function () {\n                                        logoy = Math.max(0, logoheight - window.scrollY);\n                                        headerOverlay.css(CSS.HEIGHT, HEADER_BAR_HEIGHT + logoy);\n                                    }, true);\n                                } else {\n                                    require([\"core/log\"], function(log) {\n                                        log.debug(\n                                            \"Failed to get navbar.  Ensure theme's navbar selector is included in global HEADER_BAR\"\n                                        );\n                                    });\n                                }\n                            }\n                        }\n\n                        // When user clicks to close a section using cross at top right in section.\n                        pageContent.on(Event.CLICK, Selector.CLOSE_SEC_BTN, function (e) {\n                            cancelTileSelections($(e.currentTarget).attr(\"data-section\"));\n                        });\n\n                        // If user clicks a sub tile body below the link, treat it as a click on the link itself.\n                        pageContent.on(Event.CLICK, Selector.LAUNCH_STANDARD, function(e) {\n                            var clickedLk = $(e.currentTarget);\n                            if (clickedLk.attr(\"href\") !== undefined) {\n                                window.location = clickedLk.attr(\"href\");\n                            } else if (clickedLk.find('a').attr(\"href\") !== undefined) {\n                                window.location = clickedLk.find('a').attr(\"href\");\n                            }\n                        });\n\n                        setSectionZeroFromUserPref();\n                        // Most filter button related JS is in filter_buttons.js module which is required below.\n\n                    }\n\n                    // When the user presses the button to collapse or expand Section zero (section at the top of the course).\n                    pageContent.on(Event.CLICK, Selector.HIDE_SEC0_BTN, function (e) {\n                        var sectionZero = $(Selector.SECTION_ZERO);\n                        if (sectionZero.css(CSS.DISPLAY) === \"none\") {\n                            // Sec zero is collapsed so expand it on user click.\n                            sectionZero.slideDown(250);\n                            $(e.currentTarget).addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED);\n                            browserStorage.setSecZeroCollapseStatus(\"collapsed\");\n                        } else {\n                            // Sec zero is expanded so collapse it on user click.\n                            sectionZero.slideUp(250);\n                            $(e.currentTarget).addClass(ClassNames.CLOSED).removeClass(ClassNames.OPEN);\n                            browserStorage.setSecZeroCollapseStatus(\"expanded\");\n                        }\n                    });\n\n                    if (useFilterButtons) {\n                        require([\"format_tiles/filter_buttons\"], function (filterButtons) {\n                            filterButtons.init(courseId, browserStorage.storageEnabledLocal);\n                        });\n                        if (useJavascriptNav) {\n                            pageContent.on(Event.CLICK, Selector.FILTER_BUTTON, function () {\n                                cancelTileSelections(0);\n                                reOrgSections(true, false);\n                            });\n                        }\n\n                    }\n                    // If theme is displaying the .tiles_coursenav class items, show items with this class.\n                    // They will be hidden otherwise.\n                    // They are hidden when initially rendered from PHP as we only want them shown if browser supports JS.\n                    // See lib.php extend_course_navigation.\n                    $(\".tiles_coursenav\").removeClass(\"hidden\");\n\n                    // Render the loading icon and store its HTML globally so that we can use it where needed later.\n                    Templates.render(\"format_tiles/loading\", {}).done(function (html) {\n                        loadingIconHtml = html;\n                    });\n\n                    // Get these strings now, in case we need them.\n                    // E.g. after we lose connection and cannot display content on a user tile click.\n                    var stringKeys = [\n                        {key: \"sectionerrortitle\", component: \"format_tiles\"},\n                        {key: \"sectionerrorstring\", component: \"format_tiles\"},\n                        {key: \"refresh\"},\n                        {key: \"cancel\"},\n                        {key: \"noconnectionerror\", component: \"format_tiles\"},\n                        {key: \"show\"},\n                        {key: \"hide\"},\n                        {key: \"other\", component: \"format_tiles\"},\n                        {key: \"blockedpopuptitle\", component: \"format_tiles\"}\n                    ];\n                    str.get_strings(stringKeys).done(function (s) {\n                        s.forEach(function(str, index) {\n                            stringStore[stringKeys[index].key] = str;\n                        });\n                    });\n\n                    // If a mobile user clicks an embedded video activity, we don't show them a modal.\n                    // It won't work well. Instead we direct them to the original site e.g. YouTube.\n                    if (isMobile) {\n                        pageContent.on(Event.CLICK, Selector.ACTIVITY + \".video a\", function(e) {\n                            var target = $(e.currentTarget);\n                            var url = target.closest(Selector.ACTIVITY).attr(\"data-url-secondary\");\n                            if (url !== undefined) {\n                                e.preventDefault();\n                                e.stopPropagation();\n                                var cm = target.closest(Selector.ACTIVITY);\n                                ajax.call([{\n                                    methodname: \"format_tiles_log_mod_view\", args: {\n                                        courseid: courseId,\n                                        cmid: cm.attr(\"data-cmid\")\n                                    }\n                                }])[0].done(function () {\n                                    // Because we intercepted the normal event for the click, process auto completion.\n                                    require([\"format_tiles/completion\"], function (completion) {\n                                        completion.markAsAutoCompleteInUI(courseId, cm);\n                                    });\n                                });\n                                window.location = url;\n                            }\n                        });\n                    } else {\n                        // If user is NOT on mobile device.\n\n                        // If return is pressed while an item is in focus, click the item.\n                        // This is to make the tiles keyboard navigable for users using screen readers.\n                        // User tabbing between tiles is handled by tabindex in the HTML.\n                        // Once the tile is clicked, the expand tile function will move focus to the first content item.\n                        // On escape key, we clear all selections and collapse tiles (handled above not here).\n                        $(Selector.TILE).on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.RETURN) { // Return key pressed.\n                                $(e.currentTarget).click();\n                            }\n                        });\n\n                        // Move focus to the first tile in the course (not sec zero contents if present).\n                        $(\"ul.tiles .tile\").first().focus();\n                    }\n\n                    // If Adaptable theme is being used, and Glossary auto link filter is on, we need this.\n                    // Otherwise when the auto link is clicked, the resulting dialogue is under the main overlay.\n                    // Don't need this when Boost or Clean themes are used as they handle it themselves.\n                    $(document).on(\"filter-content-updated\", function (event, msg) {\n                        if (msg.length > 0) {\n                            var elem = $(msg[0]);\n                            if (elem.hasClass(\"moodle-dialogue\") && elem.css(\"z-index\") < backDropZIndex) {\n                                elem.css(\"z-index\", backDropZIndex + 1);\n                            }\n                        }\n                    });\n                });\n            }\n        };\n    }\n);"],"file":"edit_course.min.js"}