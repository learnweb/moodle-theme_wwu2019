{"version":3,"sources":["../../src/format_tiles/edit_course.js"],"names":["define","$","Templates","ajax","browserStorage","Notification","str","tileFitter","body","bodyHtml","isMobile","loadingIconHtml","stringStore","windowOverlay","headerOverlay","scrollFuncLock","sectionIsOpen","HEADER_BAR_HEIGHT","reopenLastVisitedSection","backDropZIndex","courseId","resizeLocked","enableCompletion","openTile","Selector","PAGE","TILE","TILEID","MOVEABLE_SECTION","FILTER_BUTTON","TILE_LOADING_ICON","TILE_LOADING_ICON_ID","TILE_COLLAPSED","TILE_CLICKABLE","TILE_SELECTED","TILE_NONSELECTED","TILES","ACTIVITY","SPACER","SECTION_MOVEABLE","SECTION_ID","SECTION_TITLE","SECTION_MAIN","SECTION_BUTTONS","CLOSE_SEC_BTN","HIDE_SEC0_BTN","SECTION_ZERO","MOODLE_VIDEO","LAUNCH_STANDARD","TOOLTIP","HEADER_BAR","MENU_BAR","DROPDOWN_MENU","HIDDEN_TOGGLE","DRAGDROP","MULTI_SECTION_TILE_AREA","SUBTILEDRAGDROP","ClassNames","SELECTED","HEADER_OVERLAY","OPEN","CLOSED","LAUNCH_CM_MODAL","STATE_VISIBLE","Event","CLICK","KEYDOWN","SCROLL","MOUSEDOWN","MOUSEUP","MOUSEMOVE","MOUSEOVER","CSS","DISPLAY","Z_INDEX","HEIGHT","BG_COLOUR","Keyboard","ESCAPE","TAB","RETURN","headerOverlayFadeInOut","fadeIn","headerBar","find","selector","length","duration","step","css","parseFloat","complete","fadeOut","stopVideoPlaying","section","contentSection","each","index","iframe","attr","mediaPlayers","html","cancelTileSelections","sectionToFocus","sec","is","slideUp","removeClass","focus","setCourseContentHTML","contentArea","content","activities","not","on","e","keyCode","setLastVisitedSection","toClick","currentTarget","hasClass","click","window","location","last","shiftKey","relatedTarget","closest","setTimeout","animate","scrollTop","offset","top","tooltipItems","tooltip","err","require","log","debug","videoJS","setUp","initializeDragdropSubtiles","page","preventDefault","stopPropagation","draggingdrag","dragsubtile","rect","parent","getBoundingClientRect","dragholo","clone","clientX","left","clientY","append","holocallback","subtilehovercallback","targetsubtile","targetindex","dragindex","before","after","mouseupcallback","off","remove","overlay","hide","dragtarget","document","elementFromPoint","show","query","tilelist","cmid","xhttp","XMLHttpRequest","url","M","cfg","wwwroot","data","sesskey","secid","targettile","children","console","activitylist","onreadystatechange","readyState","status","reload","sectionbody","beforeid","nexttile","next","open","send","expandSection","tileId","scroll","expandAndScroll","scrollTo","stop","first","iframes","completion","updateTileInformation","holdSectionButtonPosition","buttons","windowTop","desiredNewPositionInSection","outerHeight","addClass","slideDown","reOrgSections","delayBefore","fitTilesToScreenWidth","dfd","Deferred","openedSection","openedSectionNum","reOrgFunc","runReOrg","done","result","resolve","fail","reject","resizeTilesDivWidth","promise","failedLoadSectionNotify","sectionNum","failResult","confirm","sectionerrortitle","sectionerrorstring","refresh","cancel","noconnectionerror","Error","getSectionContentFromServer","call","methodname","args","courseid","sectionid","setjsusedsession","shadeRGBColor","R","G","B","percent","t","p","r","Math","round","g","b","setOverlay","secNumOnTop","parseInt","tile","substr","existingColour","replace","split","clickItemBehind","clickedItem","BottomElement","clickedTile","setSectionZeroFromUserPref","buttonHideSecZero","sectionZero","storageEnabledLocal","getSecZeroCollapseStatus","populateAndExpandSection","thisTile","dataSection","storedContentExpirySecs","exception","relatedContentArea","getStoredContentAge","response","storageEnabledSession","storeCourseContent","contentAge","getCourseContent","loadingIcon","contentToDisplay","init","courseIdInit","useJavascriptNav","maxContentSectionsToStore","storedContentDeleteMins","useFilterButtons","assumeDataStoreConsent","reopenLastSection","userId","fitTilesToWidth","usingH5pFilter","enableCompletionInit","cleanUpStorage","ready","pageContent","getLastVisitedSection","windowWidth","outerWidth","appendTo","targetelement","target","expanded","getAttribute","menuselector","menuelement","setAttribute","tagName","classList","contains","add","querySelector","button","dragdrop","tilesecpos","filter","oldpos","lineindexes","lastelement","i","element","secindex","position","j","push","sectionlist","nextSecIfExists","storedContentAge","resizeRequired","openContentSection","player","overlayZindex","insertAfter","clickedLk","setSecZeroCollapseStatus","filterButtons","render","stringKeys","key","component","get_strings","s","forEach","cm","markAsAutoCompleteInUI","event","msg","elem"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Main Javascript module for format_tiles for when user is *NOT* editing.\n * See course_edit for if they are editing.\n * Handles the UI changes when tiles are selected and anything else not\n * covered by the specific modules\n *\n * @module      format_tiles/course\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// require.undef(\"format_tiles/edit_course\");\ndefine('format_tiles/edit_course', [\"jquery\", \"core/templates\", \"core/ajax\", \"format_tiles/browser_storage\",\n        \"core/notification\", \"core/str\", \"format_tiles/tile_fitter\"],\n    function ($, Templates, ajax, browserStorage, Notification, str, tileFitter) {\n        \"use strict\";\n\n        var body = $(\"body\");\n        var bodyHtml = $(\"body, html\");\n        var isMobile;\n        var loadingIconHtml;\n        var stringStore = [];\n        var windowOverlay;\n        var headerOverlay;\n        var scrollFuncLock = false;\n        var sectionIsOpen = false;\n        var HEADER_BAR_HEIGHT = 60; // This varies by theme and version so will be reset once pages loads below.\n        var reopenLastVisitedSection = false;\n        var backDropZIndex = 0;\n        var courseId;\n        var resizeLocked = false;\n        var enableCompletion;\n\n        // Keep a record of which tile is currently open.\n        var openTile = 0;\n\n        var Selector = {\n            PAGE: \"#page\",\n            TILE: \".tile\",\n            TILEID: \"#tile-\",\n            MOVEABLE_SECTION: \".moveablesection\",\n            FILTER_BUTTON: \".filterbutton\",\n            TILE_LOADING_ICON: \".tile-loading-icon\",\n            TILE_LOADING_ICON_ID: \"#loading-icon-\",\n            TILE_COLLAPSED: \".tile-collapsed\",\n            TILE_CLICKABLE: \".tile-clickable\",\n            TILE_SELECTED: \".tile-clickable.selected\",\n            TILE_NONSELECTED: \"tile-clickable:not(.selected)\",\n            TILES: \"ul.tiles\",\n            ACTIVITY: \".activity\",\n            SPACER: \".spacer\",\n            SECTION_MOVEABLE: \".moveablesection\",\n            SECTION_ID: \"#section-\",\n            SECTION_TITLE: \".sectiontitle\",\n            SECTION_MAIN: \".section.main\",\n            SECTION_BUTTONS: \"#sectionbuttons\",\n            CLOSE_SEC_BTN: \".closesectionbtn\",\n            HIDE_SEC0_BTN: \"#buttonhidesec0\",\n            SECTION_ZERO: \"#section-0\",\n            MOODLE_VIDEO: \".mediaplugin.mediaplugin_videojs\",\n            LAUNCH_STANDARD: '[data-action=\"launch-tiles-standard\"]',\n            TOOLTIP: \"[data-toggle=tooltip]\",\n            HEADER_BAR: [\"#main-menu\"],\n            MENU_BAR: \".menubar\",\n            DROPDOWN_MENU: \".dropdown-menu\",\n            HIDDEN_TOGGLE: \"div.hiddentoggle\",\n            DRAGDROP: \".dragdropwrap\",\n            MULTI_SECTION_TILE_AREA: \"#multi_section_tiles\",\n            SUBTILEDRAGDROP: \".subtilecontrols > .editing_move\",\n        };\n        var ClassNames = {\n            SELECTED: \"selected\",\n            HEADER_OVERLAY: \"header-overlay\",\n            OPEN: \"open\",\n            CLOSED: \"closed\",\n            LAUNCH_CM_MODAL: \"launch-tiles-cm-modal\",\n            STATE_VISIBLE: 'state-visible' // This is a Snap theme class and was added to make this format cooperate better with it.\n        };\n\n        var Event = {\n            CLICK: \"click\",\n            KEYDOWN: \"keydown\",\n            SCROLL: \"scroll\",\n            MOUSEDOWN: \"mousedown\",\n            MOUSEUP: \"mouseup\",\n            MOUSEMOVE: \"mousemove\",\n            MOUSEOVER: \"mouseover\"\n        };\n\n        var CSS = {\n            DISPLAY: \"display\",\n            Z_INDEX: \"z-index\",\n            HEIGHT: \"height\",\n            BG_COLOUR: \"background-color\"\n        };\n        var Keyboard = {\n            ESCAPE: 27,\n            TAB: 9,\n            RETURN: 13\n        };\n\n        /**\n         * Because headeroverlay may not exist, we want to avoid trying to fade if not there.\n         * @param {boolean} fadeIn whether to fade in (fade out otherwise).\n         * @returns {boolean}\n         */\n        var headerOverlayFadeInOut = function(fadeIn) {\n            if (headerOverlay === undefined) {\n                return false;\n            } else {\n                var headerBar = $(Selector.HEADER_BAR.find(function(selector) {\n                    return $(selector).length > 0;\n                }));\n                if (fadeIn === true) {\n                    headerOverlay.fadeIn({\n                        duration: 300,\n                        step: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                        },\n                        complete: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170, 0.6)`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170, 0.6)`);\n                        }\n                    });\n                } else {\n                    headerOverlay.fadeOut({\n                        duration: 300,\n                        step: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                        },\n                        complete: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170, 0)`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170, 0)`);\n                        }\n                    });\n                }\n                return true;\n            }\n        };\n\n        /**\n         * If we have embedded video in section, stop it.\n         * Runs when section is closed.\n         * @param {number} section where the video is.\n         */\n        var stopVideoPlaying = function(section) {\n            var contentSection = $(Selector.SECTION_ID + section);\n\n            // First iframes (e.g. embedded YouTube).\n            contentSection.find(\"iframe\").each(function (index, iframe) {\n                iframe = $(iframe);\n                // Remove the src from the iframe but keep it in case the section is re-opened.\n                if (iframe.attr('src')) {\n                    iframe.attr('data-src', iframe.attr(\"src\"));\n                    iframe.attr('src', \"\");\n                }\n            });\n\n            // Then Moodle media player.\n            var mediaPlayers = contentSection.find(Selector.MOODLE_VIDEO);\n            if (mediaPlayers.length > 0) {\n                contentSection.html(\"\");\n            }\n        };\n\n        /**\n         * When JS navigation is being used, when a user un-selects a tile, we have to move the tile's z-index back so that it is\n         * no longer on top of the overlay, as well as removing its \"selected\" class, and hiding the overlay\n         * @param {number} sectionToFocus if we want to focus a tile after closing, which one\n         */\n        var cancelTileSelections = function (sectionToFocus) {\n            $(Selector.MOVEABLE_SECTION).each(function (index, sec) {\n                sec = $(sec);\n                if (sec.is(\":visible\")) {\n                    stopVideoPlaying(sec.attr(\"data-section\"));\n                    sec.slideUp().removeClass(ClassNames.STATE_VISIBLE); // Excludes section 0.\n                }\n            });\n            $(Selector.TILE).removeClass(ClassNames.SELECTED).css(CSS.Z_INDEX, \"\").css(CSS.BG_COLOUR, \"\");\n            $(\".section \" + ClassNames.SELECTED).removeClass(ClassNames.SELECTED).css(CSS.Z_INDEX, \"\");\n            windowOverlay.fadeOut(300);\n            headerOverlayFadeInOut(false);\n            if (sectionToFocus !== undefined && sectionToFocus !== 0) {\n                $(Selector.TILEID + sectionToFocus).focus();\n            }\n            $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                $(Selector.TILE_LOADING_ICON).html(\"\");\n            });\n            sectionIsOpen = false;\n            openTile = 0;\n        };\n\n        /**\n         * Set the HTML for a course section to the correct div in the page\n         * @param {Object} contentArea the jquery object for the content area\n         * @param {String} content the HTML\n         * @returns {boolean} success\n         */\n        var setCourseContentHTML = function (contentArea, content) {\n            if (content) {\n                contentArea.html(content);\n                $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                    $(Selector.TILE_LOADING_ICON).html(\"\");\n                });\n\n                if (contentArea.attr(\"id\") !== Selector.SECTION_ZERO) {\n                    // Trap the tab key navigation in the content bearing section.\n                    // Until the user clicks the close button.\n                    // When user reaches last item, send them back to first.\n                    // And vice versa if going backwards.\n\n                    var activities = contentArea.find(Selector.ACTIVITY).not(Selector.SPACER);\n                    contentArea.on(Event.KEYDOWN, function (e) {\n                        if (e.keyCode === Keyboard.ESCAPE) {\n                            // Close open tile, and return focus to closed tile, for screen reader user.\n                            browserStorage.setLastVisitedSection(0);\n                            cancelTileSelections(0);\n                            $(Selector.TILEID + contentArea.attr('data-section')).focus();\n                        }\n                    });\n                    activities.on(Event.KEYDOWN, function (e) {\n                        if (e.keyCode === Keyboard.RETURN) {\n                            var toClick = $(e.currentTarget).find(\"a\");\n                            if (toClick.hasClass(ClassNames.LAUNCH_CM_MODAL)) {\n                                toClick.click();\n                            } else if (toClick.attr(\"href\") !== undefined) {\n                                window.location = toClick.attr(\"href\");\n                            }\n                        }\n                    });\n                    if (!isMobile) {\n                        activities.last().on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.TAB && !e.shiftKey\n                                && $(e.relatedTarget).closest(Selector.SECTION_MAIN).attr(\"id\") !== contentArea.attr(\"id\")) {\n                                // RelatedTarget is the item we tabbed to.\n                                // If we reached here, the item we are on is not a member of the section we were in.\n                                // (I.e. we are trying to tab out of the bottom of section) so move tab back to first item instead.\n                                setTimeout(function () {\n                                    // Allow very short delay so we dont skip forward on the basis of our last key press.\n                                    contentArea.find(Selector.SECTION_TITLE).focus();\n                                    bodyHtml.animate({scrollTop: contentArea.offset().top - HEADER_BAR_HEIGHT}, \"slow\");\n                                    contentArea.find('#sectionbuttons').css(\"top\", \"\");\n                                }, 200);\n                            }\n                        });\n                        contentArea.find(Selector.SECTION_TITLE).on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.TAB && e.shiftKey\n                                && $(e.relatedTarget).closest(Selector.SECTION_MAIN).attr(\"id\") !== contentArea.attr(\"id\")) {\n                                // See explanation previous block.\n                                // Here we are trying to tab backwards out of the top of our section.\n                                // So take us to last item instead.\n                                setTimeout(function () {\n                                    activities.last().focus();\n                                }, 200);\n                            }\n                        });\n                    }\n                }\n\n                if (!isMobile) {\n                    // Activate tooltips for completion toggle and any \"restricted\" items in this content.\n                    setTimeout(function () {\n                        // Manual forms, auto icons and \"Restricted until ...\" etc.\n                        try {\n                            const tooltipItems = contentArea.find(\".togglecompletion, .completioncheckbox, .tag-info\");\n                            if (tooltipItems.length > 0) {\n                                tooltipItems.tooltip();\n                            }\n                        } catch (err) {\n                            require([\"core/log\"], function(log) {\n                                log.debug(err);\n                            });\n                        }\n                    }, 500);\n                }\n                // As we have just loaded new content, ensure that we initialise videoJS media player if required.\n                if (contentArea.find(Selector.MOODLE_VIDEO).length !== 0) {\n                    require([\"media_videojs/loader\"], function(videoJS) {\n                        videoJS.setUp();\n                    });\n                }\n\n                return true;\n            }\n            return false;\n        };\n\n        /**\n         * Initialize a sectiontilesdragdrop features\n         */\n        var initializeDragdropSubtiles = function() {\n            var page = $(\"#page-content\");\n            page.on(Event.MOUSEDOWN, Selector.SUBTILEDRAGDROP, function (e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var draggingdrag = e.currentTarget;\n                var dragsubtile = $(draggingdrag).closest(Selector.ACTIVITY);\n                var rect = dragsubtile.parent()[0].getBoundingClientRect();\n                var dragholo = dragsubtile.clone(true).css('opacity', '0.5')\n                    .css('position', 'absolute')\n                    .css('left', e.clientX - rect.left - 8 + \"px\")\n                    .css('top', e.clientY - rect.top - 8 + \"px\")\n                    .css('pointer-events', 'none')\n                    .attr('id', 'dragholo');\n                $(Selector.MULTI_SECTION_TILE_AREA).append(dragholo);\n                var holocallback = function (e) {\n                    var rect = dragholo.parent()[0].getBoundingClientRect();\n                    dragholo.css('left', e.clientX - rect.left - 8 + \"px\")\n                        .css('top', e.clientY - rect.top - 8 + \"px\");\n                };\n                var subtilehovercallback = function (e) {\n                    var targetsubtile = $(e.currentTarget);\n                    var targetindex = targetsubtile.index();\n                    var dragindex = dragsubtile.index();\n                    if (targetindex === dragindex) {\n                        return;\n                    } else if (targetindex < dragindex) {\n                        targetsubtile.before(dragsubtile);\n                    } else {\n                        targetsubtile.after(dragsubtile);\n                    }\n                };\n                var mouseupcallback = function (e) {\n                    $('html').off(Event.MOUSEUP, mouseupcallback);\n                    $('html').off(Event.MOUSEMOVE, holocallback);\n                    $('#dragholo').remove();\n                    page.off(Event.MOUSEOVER, Selector.ACTIVITY, subtilehovercallback);\n                    // Are we above another subtile?\n                    var overlay = windowOverlay.is(\":visible\");\n                    if (overlay) {\n                        windowOverlay.hide();\n                    }\n                    var dragtarget = $(document.elementFromPoint(e.clientX, e.clientY));\n                    if (overlay) {\n                        windowOverlay.show();\n                    }\n                    var query = '.tile.tile-clickable';\n                    if (overlay) {\n                        query += ', #section-0';\n                    }\n                    var tilelist = dragtarget.closest(query);\n                    var cmid = dragsubtile.attr('data-cmid');\n                    var xhttp = new XMLHttpRequest();\n                    var url = M.cfg.wwwroot + \"/course/rest.php\";\n                    var data = \"?sesskey=\" + M.cfg.sesskey + \"&courseId=\" + courseId\n                        + \"&class=resource&field=move&id=\" + cmid;\n                    var secid;\n                    if (tilelist.length > 0) { // We dropped to another tile.\n                        var targettile = $(tilelist[0]);\n                        secid = $(Selector.MULTI_SECTION_TILE_AREA).children('.tile').index(targettile) + 1;\n                        data += \"&sectionId=\" + secid;\n                        data += \"&beforeId=0\";\n                        window.console.log($('#section-' + secid));\n                        var activitylist = $('#section-' + secid).find('ul.section');\n                        window.console.log(activitylist);\n                        activitylist.append(dragsubtile);\n                        xhttp.onreadystatechange = function () {\n                            if (this.readyState == 4 && this.status == 200) {\n                                window.location.reload(false);\n                            }\n                        };\n                    } else {\n                        var sectionbody = dragsubtile.closest('.section.main');\n                        if (!sectionbody.length > 0) {\n                            return;\n                        }\n                        secid = sectionbody.attr(\"data-section\");\n                        var beforeid = 0;\n                        var nexttile = dragsubtile.next();\n                        if (nexttile.length > 0) {\n                            beforeid = nexttile.attr('data-cmid');\n                        }\n                        data += \"&sectionId=\" + secid;\n                        data += \"&beforeId=\" + beforeid;\n                    }\n                    xhttp.open(\"GET\", url + data);\n                    xhttp.send();\n                };\n                page.on(Event.MOUSEOVER, Selector.ACTIVITY, subtilehovercallback);\n                $('html').on(Event.MOUSEUP, mouseupcallback);\n                $('html').on(Event.MOUSEMOVE, holocallback);\n            });\n        };\n\n        /**\n         * Expand a content containing section (e.g. on tile click)\n         * @param {object} contentArea\n         * @param {number} tileId to expand\n         * @param {boolean} whether to scroll to the tile\n         */\n        var expandSection = function (contentArea, tileId, scroll) {\n            var expandAndScroll = function () {\n                // Scroll to the top of content bearing section\n                // we have to wait until possible reOrg and slide down totally before calling this, else co-ords are wrong.\n                var scrollTo = $(\"#tile-\" + tileId).offset().top - HEADER_BAR_HEIGHT;\n                if (scrollTo === $(window).scrollTop) {\n                    // Scroll by at least one pixel otherwise z-index on selected tile is not changed.\n                    // Until mouse moves.\n                    scrollTo += 1;\n                }\n                contentArea.find(Selector.SECTION_TITLE).focus();\n                // If user tries to scroll during animation, stop animation.\n                var events = \"scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove\";\n                body.on(events, function () {\n                    body.stop();\n                });\n                if (scroll) {\n                    bodyHtml.animate({scrollTop: scrollTo}, \"slow\", function () {\n                        // Animation complete, remove stop handler.\n                        bodyHtml.off(events, function () {\n                            bodyHtml.stop();\n                        });\n                    });\n                }\n                sectionIsOpen = true;\n                openTile = tileId;\n\n                // For users with screen readers, move focus to the first item within the tile.\n                contentArea.find(Selector.ACTIVITY).first().focus();\n\n                // If we have any iframes in the section which were previous emptied out, re-populate.\n                // This will happen if we have previously closed a section with videos in, and they were muted.\n                const iframes = contentArea.find(\"iframe\");\n                if (iframes.length > 0) {\n                    iframes.each(function (index, iframe) {\n                        iframe = $(iframe);\n                        // If iframe has no src, add it from data-src.\n                        if (iframe.attr('src') === '' && iframe.attr('data-src') !== undefined) {\n                            iframe.attr('src', iframe.attr(\"data-src\"));\n                        }\n                    });\n\n                    if (enableCompletion) {\n                        // Some iframes may load content set to mark as complete on view.\n                        // So maybe need to update tile completion info. E.g. applies with H5P filter.\n                        require([\"format_tiles/completion\"], function (completion) {\n                            setTimeout(() => {\n                                completion.updateTileInformation();\n                            }, 1000);\n                        });\n                    }\n                }\n            };\n\n            /**\n             * Make sure that the section close and edit buttons always appear at the top of the section on scroll\n             */\n            var holdSectionButtonPosition = function () {\n                var buttons = contentArea.find(Selector.SECTION_BUTTONS);\n                $(window).on(Event.SCROLL, function () {\n                    if (!scrollFuncLock && sectionIsOpen) {\n                        scrollFuncLock = true;\n                        buttons.fadeOut(300);\n                        setTimeout(function () {\n                            var windowTop = $(window).scrollTop();\n                            var desiredNewPositionInSection = (windowTop - contentArea.offset().top + 50);\n                            if (desiredNewPositionInSection > 0\n                                && desiredNewPositionInSection < contentArea.outerHeight() - 100) {\n                                desiredNewPositionInSection = (windowTop - contentArea.offset().top + 50);\n                                buttons.css(\"top\", desiredNewPositionInSection);\n                                if (windowOverlay.css(CSS.DISPLAY) === \"none\") {\n                                    windowOverlay.fadeIn(300);\n                                }\n                            } else if (desiredNewPositionInSection < 0) {\n                                buttons.css(\"top\", 0);\n                            }\n                            if (windowTop > contentArea.offset().top + contentArea.outerHeight() - 50) {\n                                // We have scrolled down and content bottom has gone out of the top of window.\n                                if (windowOverlay.css(CSS.DISPLAY) === \"block\") {\n                                    windowOverlay.fadeOut(300);\n                                    headerOverlayFadeInOut(false);\n                                }\n                                buttons.css(\"top\", 0);\n                            } else if (contentArea.offset().top > windowTop + $(window).outerHeight()) {\n                                // We have scrolled up and  content bottom has gone out of the bottom of window.\n                                if (windowOverlay.css(CSS.DISPLAY) === \"block\") {\n                                    windowOverlay.fadeOut(300);\n                                    headerOverlayFadeInOut(false);\n                                }\n                                buttons.css(\"top\", 0);\n                            } else if (windowOverlay.css(CSS.DISPLAY) === \"none\") {\n                                windowOverlay.fadeIn(300);\n                            }\n                            buttons.fadeIn(300, function () {\n                                // Release lock on this function.\n                                scrollFuncLock = false;\n                            });\n                        }, 500);\n                    }\n                });\n                if (!scrollFuncLock && !sectionIsOpen && windowOverlay.is(\":visible\")) {\n                    windowOverlay.fadeOut(300);\n                }\n            };\n            contentArea.addClass(ClassNames.STATE_VISIBLE);\n            contentArea.slideDown(350, \"linear\", function () {\n                // Wait until we have finished sliding down before we work out where the top is for scroll.\n                expandAndScroll();\n                holdSectionButtonPosition();\n            });\n            openTile = tileId;\n        };\n\n        /**\n         * We find out what section is open, collapse them all, then run the re-org.\n         * Finally we re-open the section.\n         * This is to ensure that the content bearing section is on the row under the tile clicked.\n         * It is run at page load and again if window is re-sized etc.\n         * @param {boolean} delayBefore do we want a delay before we re-org.  This allows e.g. browser resizing to complete.\n         * @param {boolean} fitTilesToScreenWidth whether we need to resize the tiles window while tiles are closed.\n         * @returns {Promise}\n         */\n        var reOrgSections = function (delayBefore, fitTilesToScreenWidth) {\n            var dfd = new $.Deferred();\n            var openedSection = $(\".moveablesection:visible\");\n            var openedSectionNum = 0;\n            if (openedSection.length > 0) {\n                openedSectionNum = openedSection.attr(\"data-section\");\n                cancelTileSelections();\n            }\n            var reOrgFunc = function(delayBefore) {\n                tileFitter.runReOrg(delayBefore)\n                    .done(function(result) {\n                        if (openedSectionNum !== 0) {\n                            expandSection(openedSection, openedSectionNum);\n                        }\n                        dfd.resolve(result);\n                    })\n                    .fail(function(result) {\n                        if (openedSectionNum !== 0) {\n                            expandSection(openedSection, openedSectionNum);\n                        }\n                        dfd.reject(result);\n                    });\n            };\n\n            if (fitTilesToScreenWidth) {\n                setTimeout(function() {\n                    tileFitter.resizeTilesDivWidth(courseId).done(function() {\n                        reOrgFunc(false);\n                    }, delayBefore);\n                });\n\n            } else {\n                reOrgFunc(delayBefore);\n            }\n            return dfd.promise();\n        };\n\n        var failedLoadSectionNotify = function(sectionNum, failResult, contentArea) {\n            if (failResult) {\n                // Notify the user and invite them to refresh.  We did get a \"failResult\" from server,\n                // So it looks like we do have a connection and can launch this.\n                Notification.confirm(\n                    stringStore.sectionerrortitle,\n                    stringStore.sectionerrorstring,\n                    stringStore.refresh,\n                    stringStore.cancel,\n                    function () {\n                        window.location.reload();\n                    },\n                    null\n                );\n                contentArea.html(\"\"); // Clear loading icon.\n            } else {\n                // It looks like we may not have a connection so we can't launch notifications.\n                // We can warn the user like this instead.\n                setCourseContentHTML(contentArea, \"<p>\" + stringStore.noconnectionerror + \"</p>\");\n                setTimeout(function () {\n                    expandSection(contentArea, sectionNum);\n                }, 500);\n            }\n            require([\"core/log\"], function(log) {\n                log.debug(failResult);\n            });\n            throw new Error(\"Not successful retrieving tile content by AJAX for section \" + sectionNum);\n        };\n\n        /**\n         * For a given section, get the content from the server, add it to the store and maybe UI and maybe show it\n         * @param {number} courseId the id for the affected course\n         * @param {number} sectionNum the section number we are wanting to populate\n         * @return {Promise} promise to resolve when the ajax call returns.\n         */\n        var getSectionContentFromServer = function (courseId, sectionNum) {\n            return ajax.call([{\n                methodname: \"format_tiles_get_single_section_page_html\",\n                args: {\n                    courseid: courseId,\n                    sectionid: sectionNum,\n                    setjsusedsession: true\n                }\n            }])[0];\n        };\n\n        /**\n         * Temporary function to adjust shade of RGB colour\n         * (used for shading tiles to get around transparent background on overlay issue)\n         * @param {number} R\n         * @param {number} G\n         * @param {number} B\n         * @param {number} percent\n         * @returns {string}\n         */\n        var shadeRGBColor = function (R, G, B, percent) {\n            var t = percent < 0 ? 0 : 255;\n            var p = percent < 0 ? percent * -1 : percent;\n            var r = Math.round((t - R) * p) + R;\n            var g = Math.round((t - G) * p) + G;\n            var b = Math.round((t - B) * p) + B;\n            return \"rgb(\" + r + \",\" + g + \",\" + b + \")\";\n        };\n\n        /**\n         * Add an opaque modal backdrop like div to obscure all other tiles and bring specified tile and content to front\n         * @param {number} secNumOnTop the section number which should be displayed on top of the overlay\n         */\n        var setOverlay = function (secNumOnTop) {\n            windowOverlay.fadeIn(300);\n            backDropZIndex = parseInt(windowOverlay.css(CSS.Z_INDEX));\n            var tile = $(Selector.TILEID + secNumOnTop);\n            tile.css(CSS.Z_INDEX, (backDropZIndex + 2));\n            headerOverlayFadeInOut(true);\n            $(Selector.SECTION_ID + secNumOnTop).css(CSS.Z_INDEX, (backDropZIndex + 1));\n            if (tile.css(CSS.BG_COLOUR) && tile.css(CSS.BG_COLOUR).substr(0, 4) === \"rgba\") {\n                // Tile may have transparent background from theme - needs to be solid otherwise modal shows through.\n                var existingColour = tile.css(CSS.BG_COLOUR).replace(\"rgba(\", \"\").replace(\")\", \"\").replace(\" \", \"\").split(\",\");\n                tile.css(CSS.BG_COLOUR, shadeRGBColor(\n                    parseInt(existingColour[0]),\n                    parseInt(existingColour[1]),\n                    parseInt(existingColour[2]),\n                    0.95\n                ));\n            }\n        };\n\n        /**\n         * Used where the user clicks the window overlay but we want the active click to be behind the\n         * overlay e.g. the tile or custom menu item behind it.  So we get the co-ordinates of the click\n         * on the overlay and then repeat the click at that spot ignoring the overlay\n         * @param {object} e the click event object\n         */\n        var clickItemBehind = function (e) {\n            var clickedItem = $(e.currentTarget);\n            if (clickedItem.attr(\"id\") === \"window-overlay\" || clickedItem.attr(\"id\") === ClassNames.HEADER_OVERLAY) {\n                // We need to know what is behind the modal, so hide it for an instant to find out.\n                clickedItem.hide();\n                var BottomElement = $(document.elementFromPoint(e.clientX, e.clientY));\n                clickedItem.show();\n                if (clickedItem.attr(\"id\") === \"window-overlay\") {\n                    if (BottomElement.hasClass(\"filterbutton\") || BottomElement.hasClass(\"list-group-item\")) {\n                        // Must ba a filter button clicked or a nav drawer item.\n                        BottomElement.click();\n                    } else {\n                        // Must be a tile clicked.\n                        var clickedTile = BottomElement.closest(Selector.TILE);\n                        if (clickedTile) {\n                            clickedTile.click();\n                        }\n                    }\n                } else {\n                    // Must be a click on the header bar.\n                    cancelTileSelections(0);\n                    BottomElement.click();\n                }\n            }\n        };\n\n        /**\n         * If the user had section zero collapsed in this course previously, collapse it now\n         */\n        var setSectionZeroFromUserPref = function () {\n            var buttonHideSecZero = $(Selector.HIDE_SEC0_BTN);\n            var sectionZero = $(Selector.SECTION_ZERO);\n            if (browserStorage.storageEnabledLocal()) {\n                // Collapse section zero if user had it collapsed before - relies on local storage so only if enabled.\n                if (browserStorage.getSecZeroCollapseStatus() === true) {\n                    sectionZero.slideUp(0);\n                    buttonHideSecZero.addClass(ClassNames.CLOSED).removeClass(ClassNames.OPEN); // Button image.\n                } else {\n                    sectionZero.slideDown(300);\n                    buttonHideSecZero.addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED); // Button image.\n                }\n            } else {\n                // Storage not available so we dont know if sec zero was previously collapsed - expand it.\n                buttonHideSecZero.addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED);\n                sectionZero.slideDown(300);\n            }\n        };\n\n        /**\n         * To be called when a tile is clicked. Get content from server or storage and display or store it.\n         * @param {number} courseId courseId the id of this course.\n         * @param {object} thisTile jquery the tile object clicked.\n         * @param {number} dataSection the id number of the tile.\n         * @param {number} storedContentExpirySecs\n         * @param {boolean} scroll whether to scroll to tile\n         */\n        var populateAndExpandSection = function(courseId, thisTile, dataSection, storedContentExpirySecs, scroll = true) {\n            setOverlay(dataSection);\n            $(Selector.TILE).removeClass(ClassNames.SELECTED);\n            thisTile.addClass(ClassNames.SELECTED);\n            openTile = dataSection;\n            // Then close all open secs.\n            // Timed to finish in 200 so that it completes well before the opening next.\n            $(Selector.MOVEABLE_SECTION).each(function (index, sec) {\n                sec = $(sec);\n                if (sec.is(\":visible\")) {\n                    stopVideoPlaying(sec.attr(\"data-section\"));\n                    sec.slideUp(200).removeClass(ClassNames.STATE_VISIBLE); // Excludes section 0.\n                }\n            });\n            // Log the fact we viewed the section.\n            ajax.call([{\n                methodname: \"format_tiles_log_tile_click\", args: {\n                    courseid: courseId,\n                    sectionid: dataSection\n                }\n            }])[0].fail(Notification.exception);\n            // Get the content - use locally stored content first if available.\n            var relatedContentArea = $(Selector.SECTION_ID + dataSection);\n            if (relatedContentArea.find(Selector.ACTIVITY).length > 0) {\n                // There is already some content on the screen so display immediately.\n                expandSection(relatedContentArea, dataSection, scroll);\n                // Then refresh the content in storage only but do not change on screen.\n                if (browserStorage.getStoredContentAge(courseId, dataSection) > storedContentExpirySecs\n                    || !browserStorage.getStoredContentAge(courseId, dataSection)) {\n                    // If stored content is old, replace it.\n                    getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                        if (browserStorage.storageEnabledSession()) {\n                            browserStorage.storeCourseContent(courseId, dataSection, $(response.html).html());\n                        }\n                    });\n                }\n            } else {\n                relatedContentArea.html(loadingIconHtml);\n                if (browserStorage.storageEnabledLocal()) {\n                    var contentAge = browserStorage.getStoredContentAge(courseId, dataSection);\n                    if (contentAge) {\n                        // We have some stored content so display it even if it's expired.\n                        setCourseContentHTML(\n                            relatedContentArea,\n                            browserStorage.getCourseContent(courseId, dataSection)\n                        );\n                        expandSection(relatedContentArea, dataSection, scroll);\n                    }\n                    if (!contentAge || contentAge > storedContentExpirySecs) {\n                        // Content in local storage may not exist or have expired.\n                        // If so, get it again from server and display new content on receipt.\n                        var loadingIcon = $(Selector.TILE_LOADING_ICON_ID + dataSection);\n                        if (loadingIcon !== undefined) {\n                            loadingIcon.html(loadingIconHtml).fadeIn(200);\n                        } else {\n                            loadingIcon = $(\"<div>\").html(loadingIconHtml);\n                            relatedContentArea.html(loadingIcon);\n                        }\n                        getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                            var contentToDisplay = $(response.html).html();\n                            setCourseContentHTML(relatedContentArea, contentToDisplay);\n                            expandSection(relatedContentArea, dataSection, scroll);\n                            if (browserStorage.storageEnabledSession()) {\n                                browserStorage.storeCourseContent(courseId, dataSection, contentToDisplay);\n                            }\n                        }).fail(function (failResult) {\n                            failedLoadSectionNotify(dataSection, failResult, relatedContentArea);\n                            cancelTileSelections(dataSection);\n                        });\n                    }\n                } else {\n                    // Not using storage so get from server.\n                    getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                        setCourseContentHTML(relatedContentArea, $(response.html).html());\n                        expandSection(relatedContentArea, dataSection, scroll);\n                    }).fail(function (failResult) {\n                        failedLoadSectionNotify(dataSection, failResult, relatedContentArea);\n                        cancelTileSelections(dataSection);\n                    });\n                }\n            }\n            browserStorage.setLastVisitedSection(dataSection);\n        };\n\n        return {\n            init: function (\n                courseIdInit,\n                useJavascriptNav, // Set by site admin see settings.php.\n                maxContentSectionsToStore, // Set by site admin see settings.php.\n                isMobile,\n                sectionNum,\n                storedContentExpirySecs, // Set by site admin see settings.php.\n                storedContentDeleteMins, // Set by site admin see settings.php.\n                useFilterButtons,\n                assumeDataStoreConsent, // Set by site admin see settings.php.\n                reopenLastSection, // Set by site admin see settings.php.\n                userId,\n                fitTilesToWidth,\n                usingH5pFilter,\n                enableCompletionInit,\n            ) {\n                courseId = courseIdInit;\n                // Some args are strings or ints but we prefer bool.  Change to bool now as they are passed on elsewhere.\n                reopenLastVisitedSection = reopenLastSection === \"1\";\n                useFilterButtons = useFilterButtons === 1;\n                assumeDataStoreConsent = assumeDataStoreConsent === \"1\";\n                enableCompletion = enableCompletionInit === \"1\";\n                // We want to initialise the browser storage JS module for storing user settings.\n                // And (depending on maxContentSectionsToStore) possibly also content in browser.\n                browserStorage.init(\n                    courseId,\n                    maxContentSectionsToStore,\n                    false,\n                    sectionNum,\n                    storedContentDeleteMins,\n                    assumeDataStoreConsent,\n                    userId\n                );\n                browserStorage.cleanUpStorage();\n                $(document).ready(function () {\n                    var pageContent = $(\"#page-content\");\n                    if (pageContent.length === 0) {\n                        // Some themes e.g. RemUI do not have a #page-content div, so use #region-main.\n                        pageContent = $(\"#region-main\");\n                    }\n\n                    // If we are being told to launch a section number from the URL, use that.\n                    if (sectionNum !== 0) {\n                        openTile = sectionNum;\n                    } else {\n                        // Don't use the URL param - check local storage instead.\n                        if (reopenLastVisitedSection && browserStorage.storageEnabledLocal) {\n                            openTile = browserStorage.getLastVisitedSection();\n                            // If user is not on mobile, retrieve last visited section id from browser storage (if present).\n                            // And click it.\n                        }\n                    }\n                    if (openTile !== 0) {\n                        tileFitter.init(courseId, openTile, fitTilesToWidth, false);\n                    } else {\n                        // Set focus to the first tile (not section zero).\n                        $(Selector.TILEID + \"1\").focus();\n                        tileFitter.init(courseId, null, fitTilesToWidth, false);\n                    }\n                    var windowWidth = $(window).outerWidth();\n\n                    if (useJavascriptNav) {\n                        // User is not editing but is usingJS nav to view.\n\n                        // When a tile is clicked we add an overlay to grey out the rest of the tiles on the page, so prepare it.\n                        windowOverlay = $(\"<div></div>\").addClass(\"modal-backdrop fade in\").hide()\n                            .attr(\"id\", \"window-overlay\").appendTo(body);\n\n                        // If user clicks the window overlay behind the visible tile content, deselect tile.\n                        // (They want to remove the overlay).\n                        windowOverlay.click(function (e) {\n                            cancelTileSelections(0);\n                            clickItemBehind(e);\n                        });\n\n                        // On a click on the edit menu stop the tile from expanding.\n                        pageContent.on(Event.CLICK, Selector.MENU_BAR, function (e) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            var targetelement = e.target;\n                            var expanded = targetelement.getAttribute(\"aria-expanded\") === \"true\";\n                            var menuselector = targetelement.getAttribute(\"aria-controls\");\n                            var menuelement = $('#' + menuselector);\n                            if (expanded) {\n                                // Is expanded, collapse.\n                                targetelement.setAttribute(\"aria-expanded\", \"false\");\n                                menuelement.hide();\n                            } else {\n                                // Else expand.\n                                targetelement.setAttribute(\"aria-expanded\", \"true\");\n                                menuelement.show();\n                            }\n                        });\n\n                        pageContent.on(Event.CLICK, Selector.HIDDEN_TOGGLE, function (e) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            var xhttp = new XMLHttpRequest();\n                            var target = e.target;\n                            if (target.tagName !== \"DIV\") {\n                                target = target.closest(\".hiddentoggle\");\n                            }\n                            if (target.classList.contains(\"hidden\")) {\n                                return;\n                            }\n                            xhttp.onreadystatechange = function () {\n                                if (this.readyState == 4 && this.status == 200) {\n                                    target.classList.add(\"hidden\");\n                                    var parent = target.closest(\".tile-hidden\");\n                                    parent.classList.remove(\"tile-hidden\");\n                                    parent.querySelector(\".availabilityinfo\").classList.add(\"hidden\");\n                                }\n                            };\n                            xhttp.open(\"GET\", target.getAttribute(\"href\"));\n                            xhttp.send();\n                        });\n\n                        pageContent.on(Event.CLICK, Selector.DROPDOWN_MENU, function (e) {\n                            e.stopPropagation();\n                        });\n\n                        pageContent.on(Event.CLICK, Selector.DRAGDROP, function (e) {\n                            e.stopPropagation();\n                        });\n\n                        pageContent.on(Event.MOUSEDOWN, Selector.DRAGDROP, function (e) {\n                            if (e.button) {\n                                return;\n                            }\n                            var dragdrop = e.target;\n                            if (dragdrop.tagName !== \"DIV\") {\n                                // Click is on image.\n                                dragdrop = e.target.closest(Selector.DRAGDROP);\n                            }\n                            dragdrop.setAttribute(\"aria-grabbed\", \"true\");\n\n                            var tile = $(\"#\" + dragdrop.getAttribute(\"aria-controls\"));\n\n                            tile.addClass(\"tile-moving\");\n                            var rect = tile.parent()[0].getBoundingClientRect();\n                            var dragholo = tile.clone(true).css('opacity', '0.5')\n                                .css('position', 'absolute')\n                                .css('left', e.clientX - rect.left - 8 + \"px\")\n                                .css('top', e.clientY - rect.top - 8 + \"px\")\n                                .css('pointer-events', 'none')\n                                .attr('id', 'dragholo');\n                            tile.after(dragholo);\n                            rect = dragholo.parent()[0].getBoundingClientRect();\n                            var holocallback = function (e) {\n                                dragholo.css('left', e.clientX - rect.left - 8 + \"px\")\n                                    .css('top', e.clientY - rect.top - 8 + \"px\");\n                            };\n                            $(\"html\").on(Event.MOUSEMOVE, holocallback);\n                            $(\"html\").on(Event.MOUSEUP, function (e) {\n                                if (e.button) {\n                                    // It's not the primary button being clicked.\n                                    return;\n                                }\n                                $(\"html\").off(Event.MOUSEMOVE, holocallback);\n                                dragholo.remove();\n                                dragdrop.setAttribute(\"aria-grabbed\", \"false\");\n\n                                $(\"html\").off(Event.MOUSEUP, this);\n                                pageContent.off(Event.MOUSEOVER, Selector.MULTI_SECTION_TILE_AREA);\n\n                                var tilesecpos = $(Selector.MULTI_SECTION_TILE_AREA)\n                                    .children()\n                                    .filter(\".tile.tile-clickable\")\n                                    .index(tile) + 1;\n                                var oldpos = tile.attr(\"data-section\");\n\n                                if (parseInt(oldpos) === tilesecpos) {\n                                    return; // Nothing to do.\n                                }\n\n                                var xhttp = new XMLHttpRequest();\n                                xhttp.onreadystatechange = function () {\n                                    if (this.readyState == 4 && this.status == 200) {\n                                        window.location.reload(false);\n                                    }\n                                };\n                                var url = M.cfg.wwwroot + \"/course/rest.php\";\n                                var data = \"?sesskey=\" + M.cfg.sesskey + \"&courseId=\" + courseId\n                                    + \"&class=section&field=move&id=\" + tile.attr(\"data-section\")\n                                    + \"&value=\" + tilesecpos;\n                                xhttp.open(\"GET\", url + data);\n                                xhttp.send();\n\n                                var tilelist = $(Selector.MULTI_SECTION_TILE_AREA)\n                                    .children()\n                                    .filter(\".tile.tile-clickable\");\n                                var lineindexes = [];\n                                var last = -1;\n                                var lastelement = null;\n                                for (let i = 0; i < tilelist.length; i++) {\n                                    var element = tilelist[i];\n                                    var secindex = element.getAttribute(\"data-section\");\n                                    if ($(element).position().top > last) {\n                                        last = $(element).position().top;\n                                        if (lastelement !== null) {\n                                            for (var j = 0; j < lineindexes.length; j++) {\n                                                var index = lineindexes[j];\n                                                $(lastelement).after($(\"#section-\" + index));\n                                            }\n                                        }\n                                        lineindexes = [];\n                                    }\n                                    lastelement = element;\n                                    lineindexes.push(secindex);\n                                    element.setAttribute(\"data-section\", i + 1);\n                                    element.setAttribute(\"id\", \"tile-\" + (i + 1));\n\n                                }\n                                var sectionlist = $(Selector.MULTI_SECTION_TILE_AREA)\n                                    .children()\n                                    .filter(\".section\");\n\n                                for (let i = 1; i < tilelist.length; i++) {\n                                    sectionlist[i].setAttribute(\"id\", \"section-\" + i);\n                                    sectionlist[i].setAttribute(\"data-section\", i);\n                                }\n                                e.preventDefault();\n                                e.stopPropagation();\n                            });\n\n                            pageContent.on(Event.MOUSEOVER, Selector.MULTI_SECTION_TILE_AREA, function (e) {\n                                var targettile = e.target;\n                                if (!targettile.classList.contains(\"tile-clickable\")) {\n                                    targettile = $(e.target).closest(\".tile.tile-clickable\");\n                                }\n                                if (targettile !== null && targettile.length) {\n                                    if ($(targettile).index() === tile.index()) {\n                                        return;\n                                    } else if ($(targettile).index() > tile.index()) {\n                                        targettile.after(tile);\n                                    } else {\n                                        targettile.before(tile);\n                                    }\n                                }\n                            });\n\n                            e.preventDefault();\n                            e.stopPropagation();\n                        });\n\n                        // On a tile click, decide what to do an do it.\n                        // (Collapse if already expanded, or expand it and fill with content).\n                        pageContent.on(Event.CLICK, Selector.TILE_CLICKABLE, function (e) {\n                            // Prevent the link being followed to reload the PHP page as we are using JS instead.\n                            if (!useJavascriptNav) {\n                                return;\n                            }\n                            e.preventDefault();\n                            $(window).off(Event.SCROLL); // Stop listening for scroll events on ay previously opened tiles.\n                            // if other tiles have loading icons, fade them out (on the tile not the content sec).\n                            $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                                $(Selector.TILE_LOADING_ICON).html();\n                            });\n                            var thisTile = $(e.currentTarget).closest(Selector.TILE);\n                            var dataSection = parseInt(thisTile.attr(\"data-section\"));\n                            if (thisTile.hasClass(ClassNames.SELECTED)) {\n                                // This tile is already expanded so collapse it.\n                                cancelTileSelections(dataSection);\n                                browserStorage.setLastVisitedSection(0);\n                            } else {\n                                populateAndExpandSection(\n                                    courseId, thisTile, dataSection, storedContentExpirySecs\n                                );\n                            }\n                            // Silently set the *next* section's content to if it exists and if user is not on mobile.\n                            // short delay as more important to get current section content first (above).\n                            var nextSecIfExists = $(Selector.SECTION_ID + (dataSection + 1));\n                            if (!isMobile && !usingH5pFilter && nextSecIfExists.length && dataSection > 0) {\n                                setTimeout(function () {\n                                    var storedContentAge = browserStorage.getStoredContentAge(courseId, dataSection + 1);\n                                    if (storedContentAge) {\n                                        // We have some stored content so set this to screen (even if expired).\n                                        setCourseContentHTML(\n                                            nextSecIfExists,\n                                            browserStorage.getCourseContent(courseId, dataSection + 1)\n                                        );\n                                    }\n                                    if (!storedContentAge || storedContentAge > storedContentExpirySecs) {\n                                        // Stored content is too old or does not exist so get from server.\n                                        getSectionContentFromServer(courseId, dataSection + 1).done(function(response) {\n                                            setCourseContentHTML(\n                                                nextSecIfExists,\n                                                $(response.html).html()\n                                            );\n                                            if (browserStorage.storageEnabledSession()) {\n                                                browserStorage.storeCourseContent(\n                                                    courseId, dataSection + 1, $(response.html).html()\n                                                );\n                                            }\n                                        });\n                                    }\n                                }, 2000);\n                            }\n                        });\n\n                        // When window is re-sized, content sections under the tiles may be in wrong place.\n                        // So remove them and re-initialise them.\n                        // Collapse the selected section before doing this.\n                        // Otherwise the re-organisation won't work as the tiles' flow will be out when they are analysed.\n                        $(window).on(\"resize\", function () {\n                            // On iOS resize events are triggered often on scroll because the address bar hides itself.\n                            // Avoid this using windowWidth here.\n                            if (resizeLocked || windowWidth === $(window).outerWidth()) {\n                                return;\n                            }\n                            resizeLocked = true;\n\n                            // We wait for a short time before doing anything, as user may still be dragging window size change.\n                            // We don't want to react to say 20 resize events happening over a single drag.\n                            setTimeout(function() {\n                                // First assume that we are going to resize, but we have checks to make below.\n                                var resizeRequired = true;\n\n                                // If we have a Moodle media player div in the section in fullscreen, ignore this resize event.\n                                // It was probably caused when user pressed the full screen button.\n                                var openContentSection = $(\".moveablesection:visible\");\n                                if (openContentSection.length !== 0) {\n                                    var mediaPlayers = openContentSection.find(\".mediaplugin iframe\");\n                                    if (mediaPlayers.length !== 0) {\n                                        mediaPlayers.each(function (index, player) {\n                                            player = $(player);\n                                            if (player.outerWidth() > openContentSection.outerWidth()) {\n                                                // Video is present and playing full screen so don't react to resize event.\n                                                resizeRequired = false;\n                                            }\n                                        });\n                                    }\n                                }\n                                if (resizeRequired) {\n                                    // Set global for comparison next time.\n                                    windowWidth = $(window).outerWidth();\n                                    reOrgSections(true, fitTilesToWidth);\n                                }\n                                resizeLocked = false;\n                            }, 600);\n                        });\n\n                        initializeDragdropSubtiles();\n\n                        // We want the main menu at the top to be on top of the tiles.\n                        // Even the ones which we have brought to the front on top of the window overlay.\n                        // But we also want it to still be greyed out.  So add an opaque overlay.\n                        // We can show this when the main overlay is active.\n                        // When a user clicks this overlay, they want to close the overlay and click menu item behind.\n                        // So provide for that here.\n                        // Z-INDICES: Active tile content will be at overlayZindex + 1.\n                        // Active tile will be at overlayZindex + 2.\n                        // Header bar will be at overlayZindex + 3 so that it is higher than tiles.\n                        // Header bar overlay will be at overlayZindex + 4 so that it is highest of all.\n\n                        var overlayZindex = parseInt(windowOverlay.css(CSS.Z_INDEX));\n                        var headerBar = $(Selector.HEADER_BAR.find(function(selector) {\n                            return $(selector).length > 0;\n                        }));\n                        if (headerBar !== undefined && headerBar.length !== 0) {\n                            headerBar.css(CSS.Z_INDEX, overlayZindex + 3);\n                            if (headerBar.attr(\"id\") !== \"navwrap\") {\n                                // ID navwrap suggests theme is Adaptable based. We don't bother with header overlay if so.\n                                // Otherise the header bar has a separate mini overlay of its own - find and hide this.\n                                // If it is clicked, cancel tile selections and click the item behind where clicked.\n                                // Do not include for Moodle 3.5 or higher as not needed.\n                                if (headerBar.outerHeight() !== undefined) {\n                                    HEADER_BAR_HEIGHT = headerBar.outerHeight();\n                                    headerOverlay = $(\"<div></div>\")\n                                        .addClass(ClassNames.HEADER_OVERLAY).attr(\"id\", ClassNames.HEADER_OVERLAY)\n                                        .css(CSS.DISPLAY, \"none\");\n                                    headerOverlay.insertAfter(Selector.PAGE)\n                                        .css(CSS.Z_INDEX, (overlayZindex) + 4).css(CSS.HEIGHT, HEADER_BAR_HEIGHT)\n                                        .click(function (e) {\n                                            cancelTileSelections(0);\n                                            clickItemBehind(e);\n                                        });\n                                } else {\n                                    require([\"core/log\"], function(log) {\n                                        log.debug(\n                                            \"Failed to get navbar.  Ensure theme's navbar selector is included in global HEADER_BAR\"\n                                        );\n                                    });\n                                }\n                            }\n                        }\n\n                        // When user clicks to close a section using cross at top right in section.\n                        pageContent.on(Event.CLICK, Selector.CLOSE_SEC_BTN, function (e) {\n                            cancelTileSelections($(e.currentTarget).attr(\"data-section\"));\n                        });\n\n                        // If user clicks a sub tile body below the link, treat it as a click on the link itself.\n                        pageContent.on(Event.CLICK, Selector.LAUNCH_STANDARD, function(e) {\n                            var clickedLk = $(e.currentTarget);\n                            if (clickedLk.attr(\"href\") !== undefined) {\n                                window.location = clickedLk.attr(\"href\");\n                            } else if (clickedLk.find('a').attr(\"href\") !== undefined) {\n                                window.location = clickedLk.find('a').attr(\"href\");\n                            }\n                        });\n\n                        setSectionZeroFromUserPref();\n                        // Most filter button related JS is in filter_buttons.js module which is required below.\n\n                    }\n\n                    // When the user presses the button to collapse or expand Section zero (section at the top of the course).\n                    pageContent.on(Event.CLICK, Selector.HIDE_SEC0_BTN, function (e) {\n                        var sectionZero = $(Selector.SECTION_ZERO);\n                        if (sectionZero.css(CSS.DISPLAY) === \"none\") {\n                            // Sec zero is collapsed so expand it on user click.\n                            sectionZero.slideDown(250);\n                            $(e.currentTarget).addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED);\n                            browserStorage.setSecZeroCollapseStatus(\"collapsed\");\n                        } else {\n                            // Sec zero is expanded so collapse it on user click.\n                            sectionZero.slideUp(250);\n                            $(e.currentTarget).addClass(ClassNames.CLOSED).removeClass(ClassNames.OPEN);\n                            browserStorage.setSecZeroCollapseStatus(\"expanded\");\n                        }\n                    });\n\n                    if (useFilterButtons) {\n                        require([\"format_tiles/filter_buttons\"], function (filterButtons) {\n                            filterButtons.init(courseId, browserStorage.storageEnabledLocal);\n                        });\n                        if (useJavascriptNav) {\n                            pageContent.on(Event.CLICK, Selector.FILTER_BUTTON, function () {\n                                cancelTileSelections(0);\n                                reOrgSections(true, false);\n                            });\n                        }\n\n                    }\n                    // If theme is displaying the .tiles_coursenav class items, show items with this class.\n                    // They will be hidden otherwise.\n                    // They are hidden when initially rendered from PHP as we only want them shown if browser supports JS.\n                    // See lib.php extend_course_navigation.\n                    $(\".tiles_coursenav\").removeClass(\"hidden\");\n\n                    // Render the loading icon and store its HTML globally so that we can use it where needed later.\n                    Templates.render(\"format_tiles/loading\", {}).done(function (html) {\n                        loadingIconHtml = html;\n                    });\n\n                    // Get these strings now, in case we need them.\n                    // E.g. after we lose connection and cannot display content on a user tile click.\n                    var stringKeys = [\n                        {key: \"sectionerrortitle\", component: \"format_tiles\"},\n                        {key: \"sectionerrorstring\", component: \"format_tiles\"},\n                        {key: \"refresh\"},\n                        {key: \"cancel\"},\n                        {key: \"noconnectionerror\", component: \"format_tiles\"},\n                        {key: \"show\"},\n                        {key: \"hide\"},\n                        {key: \"other\", component: \"format_tiles\"},\n                        {key: \"blockedpopuptitle\", component: \"format_tiles\"}\n                    ];\n                    str.get_strings(stringKeys).done(function (s) {\n                        s.forEach(function(str, index) {\n                            stringStore[stringKeys[index].key] = str;\n                        });\n                    });\n\n                    // If a mobile user clicks an embedded video activity, we don't show them a modal.\n                    // It won't work well. Instead we direct them to the original site e.g. YouTube.\n                    if (isMobile) {\n                        pageContent.on(Event.CLICK, Selector.ACTIVITY + \".video a\", function(e) {\n                            var target = $(e.currentTarget);\n                            var url = target.closest(Selector.ACTIVITY).attr(\"data-url-secondary\");\n                            if (url !== undefined) {\n                                e.preventDefault();\n                                e.stopPropagation();\n                                var cm = target.closest(Selector.ACTIVITY);\n                                ajax.call([{\n                                    methodname: \"format_tiles_log_mod_view\", args: {\n                                        courseid: courseId,\n                                        cmid: cm.attr(\"data-cmid\")\n                                    }\n                                }])[0].done(function () {\n                                    // Because we intercepted the normal event for the click, process auto completion.\n                                    require([\"format_tiles/completion\"], function (completion) {\n                                        completion.markAsAutoCompleteInUI(courseId, cm);\n                                    });\n                                });\n                                window.location = url;\n                            }\n                        });\n                    } else {\n                        // If user is NOT on mobile device.\n\n                        // If return is pressed while an item is in focus, click the item.\n                        // This is to make the tiles keyboard navigable for users using screen readers.\n                        // User tabbing between tiles is handled by tabindex in the HTML.\n                        // Once the tile is clicked, the expand tile function will move focus to the first content item.\n                        // On escape key, we clear all selections and collapse tiles (handled above not here).\n                        $(Selector.TILE).on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.RETURN) { // Return key pressed.\n                                $(e.currentTarget).click();\n                            }\n                        });\n\n                        // Move focus to the first tile in the course (not sec zero contents if present).\n                        $(\"ul.tiles .tile\").first().focus();\n                    }\n\n                    // If Adaptable theme is being used, and Glossary auto link filter is on, we need this.\n                    // Otherwise when the auto link is clicked, the resulting dialogue is under the main overlay.\n                    // Don't need this when Boost or Clean themes are used as they handle it themselves.\n                    $(document).on(\"filter-content-updated\", function (event, msg) {\n                        if (msg.length > 0) {\n                            var elem = $(msg[0]);\n                            if (elem.hasClass(\"moodle-dialogue\") && elem.css(\"z-index\") < backDropZIndex) {\n                                elem.css(\"z-index\", backDropZIndex + 1);\n                            }\n                        }\n                    });\n                });\n            }\n        };\n    }\n);"],"file":"edit_course.min.js"}