{"version":3,"sources":["../../src/format_tiles/course.js"],"names":["scriptname","document","currentScript","getAttribute","require","undef","define","$","Templates","ajax","browserStorage","Notification","str","tileFitter","body","bodyHtml","isMobile","loadingIconHtml","stringStore","windowOverlay","headerOverlay","scrollFuncLock","sectionIsOpen","HEADER_BAR_HEIGHT","reopenLastVisitedSection","backDropZIndex","courseId","resizeLocked","enableCompletion","openTile","Selector","PAGE","TILE","TILEID","MOVEABLE_SECTION","FILTER_BUTTON","TILE_LOADING_ICON","TILE_LOADING_ICON_ID","TILE_COLLAPSED","TILE_CLICKABLE","TILES","ACTIVITY","SPACER","SECTION_MOVEABLE","SECTION_ID","SECTION_TITLE","SECTION_MAIN","SECTION_BUTTONS","CLOSE_SEC_BTN","HIDE_SEC0_BTN","SECTION_ZERO","MOODLE_VIDEO","LAUNCH_STANDARD","TOOLTIP","HEADER_BAR","ClassNames","SELECTED","HEADER_OVERLAY","OPEN","CLOSED","LAUNCH_CM_MODAL","STATE_VISIBLE","Event","CLICK","KEYDOWN","SCROLL","CSS","DISPLAY","Z_INDEX","HEIGHT","BG_COLOUR","Keyboard","ESCAPE","TAB","RETURN","headerOverlayFadeInOut","fadeIn","headerBar","find","selector","length","duration","step","css","parseFloat","complete","fadeOut","stopVideoPlaying","section","contentSection","each","index","iframe","attr","mediaPlayers","html","cancelTileSelections","sectionToFocus","sec","is","slideUp","removeClass","focus","setCourseContentHTML","contentArea","content","activities","not","on","e","keyCode","setLastVisitedSection","toClick","currentTarget","hasClass","click","window","location","last","shiftKey","relatedTarget","closest","setTimeout","animate","scrollTop","offset","top","tooltipItems","tooltip","err","log","debug","videoJS","setUp","expandSection","tileId","expandAndScroll","scrollTo","stop","off","first","iframes","completion","updateTileInformation","holdSectionButtonPosition","buttons","windowTop","desiredNewPositionInSection","outerHeight","addClass","slideDown","reOrgSections","delayBefore","fitTilesToScreenWidth","dfd","Deferred","openedSection","openedSectionNum","reOrgFunc","runReOrg","done","result","resolve","fail","reject","resizeTilesDivWidth","promise","failedLoadSectionNotify","sectionNum","failResult","confirm","sectionerrortitle","sectionerrorstring","refresh","cancel","reload","noconnectionerror","Error","getSectionContentFromServer","call","methodname","args","courseid","sectionid","setjsusedsession","shadeRGBColor","R","G","B","percent","t","p","r","Math","round","g","b","setOverlay","secNumOnTop","parseInt","tile","substr","existingColour","replace","split","clickItemBehind","clickedItem","hide","BottomElement","elementFromPoint","clientX","clientY","show","clickedTile","setSectionZeroFromUserPref","buttonHideSecZero","sectionZero","storageEnabledLocal","getSecZeroCollapseStatus","populateAndExpandSection","thisTile","dataSection","storedContentExpirySecs","exception","relatedContentArea","getStoredContentAge","response","storageEnabledSession","storeCourseContent","contentAge","getCourseContent","loadingIcon","contentToDisplay","init","courseIdInit","useJavascriptNav","maxContentSectionsToStore","isMobileInit","storedContentDeleteMins","useFilterButtons","assumeDataStoreConsent","reopenLastSectionInit","userId","fitTilesToWidth","usingH5pFilter","enableCompletionInit","cleanUpStorage","ready","pageContent","getLastVisitedSection","windowWidth","outerWidth","appendTo","preventDefault","nextSecIfExists","storedContentAge","resizeRequired","openContentSection","player","overlayZindex","insertAfter","clickedLk","setSecZeroCollapseStatus","filterButtons","render","stringKeys","key","component","get_strings","s","forEach","target","url","stopPropagation","cm","cmid","markAsAutoCompleteInUI","event","msg","elem"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Main Javascript module for format_tiles for when user is *NOT* editing.\n * See course_edit for if they are editing.\n * Handles the UI changes when tiles are selected and anything else not\n * covered by the specific modules\n *\n * @module      format_tiles/course\n * @package     course/format\n * @subpackage  tiles\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nvar scriptname = document.currentScript.getAttribute(\"data-requiremodule\");\nif (scriptname === \"core/first\") {\n    require.undef(\"format_tiles/edit_course\");\n}\ndefine('format_tiles/course', [\"jquery\", \"core/templates\", \"core/ajax\", \"format_tiles/browser_storage\",\n        \"core/notification\", \"core/str\", \"format_tiles/tile_fitter\"],\n    function ($, Templates, ajax, browserStorage, Notification, str, tileFitter) {\n        \"use strict\";\n\n        var body = $(\"body\");\n        var bodyHtml = $(\"body, html\");\n        var isMobile;\n        var loadingIconHtml;\n        var stringStore = [];\n        var windowOverlay;\n        var headerOverlay;\n        var scrollFuncLock = false;\n        var sectionIsOpen = false;\n        var HEADER_BAR_HEIGHT = 60; // This varies by theme and version so will be reset once pages loads below.\n        var reopenLastVisitedSection = false;\n        var backDropZIndex = 0;\n        var courseId;\n        var resizeLocked = false;\n        var enableCompletion;\n\n        // Keep a record of which tile is currently open.\n        var openTile = 0;\n\n        var Selector = {\n            PAGE: \"#page\",\n            TILE: \".tile\",\n            TILEID: \"#tile-\",\n            MOVEABLE_SECTION: \".moveablesection\",\n            FILTER_BUTTON: \".filterbutton\",\n            TILE_LOADING_ICON: \".tile-loading-icon\",\n            TILE_LOADING_ICON_ID: \"#loading-icon-\",\n            TILE_COLLAPSED: \".tile-collapsed\",\n            TILE_CLICKABLE: \".tile-clickable\",\n            TILES: \"ul.tiles\",\n            ACTIVITY: \".activity\",\n            SPACER: \".spacer\",\n            SECTION_MOVEABLE: \".moveablesection\",\n            SECTION_ID: \"#section-\",\n            SECTION_TITLE: \".sectiontitle\",\n            SECTION_MAIN: \".section.main\",\n            SECTION_BUTTONS: \"#sectionbuttons\",\n            CLOSE_SEC_BTN: \".closesectionbtn\",\n            HIDE_SEC0_BTN: \"#buttonhidesec0\",\n            SECTION_ZERO: \"#section-0\",\n            MOODLE_VIDEO: \".mediaplugin.mediaplugin_videojs\",\n            LAUNCH_STANDARD: '[data-action=\"launch-tiles-standard\"]',\n            TOOLTIP: \"[data-toggle=tooltip]\",\n            HEADER_BAR: [\"#main-menu\"]\n            // We try several different selectors for header bar as it varies between theme.\n            // (Boost based, clean based, essential etc).\n        };\n        var ClassNames = {\n            SELECTED: \"selected\",\n            HEADER_OVERLAY: \"header-overlay\",\n            OPEN: \"open\",\n            CLOSED: \"closed\",\n            LAUNCH_CM_MODAL: \"launch-tiles-cm-modal\",\n            STATE_VISIBLE: 'state-visible' // This is a Snap theme class and was added to make this format cooperate better with it.\n        };\n\n        var Event = {\n            CLICK: \"click\",\n            KEYDOWN: \"keydown\",\n            SCROLL: \"scroll\"\n        };\n\n        var CSS = {\n            DISPLAY: \"display\",\n            Z_INDEX: \"z-index\",\n            HEIGHT: \"height\",\n            BG_COLOUR: \"background-color\"\n        };\n        var Keyboard = {\n            ESCAPE: 27,\n            TAB: 9,\n            RETURN: 13\n        };\n\n        /**\n         * Because headeroverlay may not exist, we want to avoid trying to fade if not there.\n         * @param {boolean} fadeIn whether to fade in (fade out otherwise).\n         * @returns {boolean}\n         */\n        var headerOverlayFadeInOut = function(fadeIn) {\n            if (headerOverlay === undefined) {\n                return false;\n            } else {\n                var headerBar = $(Selector.HEADER_BAR.find(function(selector) {\n                    return $(selector).length > 0;\n                }));\n                if (fadeIn === true) {\n                    headerOverlay.fadeIn({\n                        duration: 300,\n                        step: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                        },\n                        complete: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170, 0.6)`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170, 0.6)`);\n                        }\n                    });\n                } else {\n                    headerOverlay.fadeOut({\n                        duration: 300,\n                        step: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170,\n                            ${parseFloat(windowOverlay.css('opacity') * 3)})`);\n                        },\n                        complete: function () {\n                            headerBar.css('border-left', `1rem solid rgba(170, 170, 170, 0)`);\n                            headerBar.css('border-right', `1rem solid rgba(170, 170, 170, 0)`);\n                        }\n                    });\n                }\n                return true;\n            }\n        };\n\n        /**\n         * If we have embedded video in section, stop it.\n         * Runs when section is closed.\n         * @param {number} section where the video is.\n         */\n        var stopVideoPlaying = function(section) {\n            var contentSection = $(Selector.SECTION_ID + section);\n\n            // First iframes (e.g. embedded YouTube).\n            contentSection.find(\"iframe\").each(function (index, iframe) {\n                iframe = $(iframe);\n                // Remove the src from the iframe but keep it in case the section is re-opened.\n                if (iframe.attr('src')) {\n                    iframe.attr('data-src', iframe.attr(\"src\"));\n                    iframe.attr('src', \"\");\n                }\n            });\n\n            // Then Moodle media player.\n            var mediaPlayers = contentSection.find(Selector.MOODLE_VIDEO);\n            if (mediaPlayers.length > 0) {\n                contentSection.html(\"\");\n            }\n        };\n\n        /**\n         * When JS navigation is being used, when a user un-selects a tile, we have to move the tile's z-index back so that it is\n         * no longer on top of the overlay, as well as removing its \"selected\" class, and hiding the overlay\n         * @param {number} sectionToFocus if we want to focus a tile after closing, which one\n         */\n        var cancelTileSelections = function (sectionToFocus) {\n            $(Selector.MOVEABLE_SECTION).each(function (index, sec) {\n                sec = $(sec);\n                if (sec.is(\":visible\")) {\n                    stopVideoPlaying(sec.attr(\"data-section\"));\n                    sec.slideUp().removeClass(ClassNames.STATE_VISIBLE); // Excludes section 0.\n                }\n            });\n            $(Selector.TILE).removeClass(ClassNames.SELECTED).css(CSS.Z_INDEX, \"\").css(CSS.BG_COLOUR, \"\");\n            $(\".section \" + ClassNames.SELECTED).removeClass(ClassNames.SELECTED).css(CSS.Z_INDEX, \"\");\n            windowOverlay.fadeOut(300);\n            headerOverlayFadeInOut(false);\n            if (sectionToFocus !== undefined && sectionToFocus !== 0) {\n                $(Selector.TILEID + sectionToFocus).focus();\n            }\n            $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                $(Selector.TILE_LOADING_ICON).html(\"\");\n            });\n            sectionIsOpen = false;\n            openTile = 0;\n        };\n\n        /**\n         * Set the HTML for a course section to the correct div in the page\n         * @param {Object} contentArea the jquery object for the content area\n         * @param {String} content the HTML\n         * @returns {boolean} success\n         */\n        var setCourseContentHTML = function (contentArea, content) {\n            if (content) {\n                contentArea.html(content);\n                $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                    $(Selector.TILE_LOADING_ICON).html(\"\");\n                });\n\n                if (contentArea.attr(\"id\") !== Selector.SECTION_ZERO) {\n                    // Trap the tab key navigation in the content bearing section.\n                    // Until the user clicks the close button.\n                    // When user reaches last item, send them back to first.\n                    // And vice versa if going backwards.\n\n                    var activities = contentArea.find(Selector.ACTIVITY).not(Selector.SPACER);\n                    contentArea.on(Event.KEYDOWN, function (e) {\n                        if (e.keyCode === Keyboard.ESCAPE) {\n                            // Close open tile, and return focus to closed tile, for screen reader user.\n                            browserStorage.setLastVisitedSection(0);\n                            cancelTileSelections(0);\n                            $(Selector.TILEID + contentArea.attr('data-section')).focus();\n                        }\n                    });\n                    activities.on(Event.KEYDOWN, function (e) {\n                        if (e.keyCode === Keyboard.RETURN) {\n                            var toClick = $(e.currentTarget).find(\"a\");\n                            if (toClick.hasClass(ClassNames.LAUNCH_CM_MODAL)) {\n                                toClick.click();\n                            } else if (toClick.attr(\"href\") !== undefined) {\n                                window.location = toClick.attr(\"href\");\n                            }\n                        }\n                    });\n                    if (!isMobile) {\n                        activities.last().on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.TAB && !e.shiftKey\n                                && $(e.relatedTarget).closest(Selector.SECTION_MAIN).attr(\"id\") !== contentArea.attr(\"id\")) {\n                                // RelatedTarget is the item we tabbed to.\n                                // If we reached here, the item we are on is not a member of the section we were in.\n                                // (I.e. we are trying to tab out of the bottom of section) so move tab back to first item instead.\n                                setTimeout(function () {\n                                    // Allow very short delay so we dont skip forward on the basis of our last key press.\n                                    contentArea.find(Selector.SECTION_TITLE).focus();\n                                    bodyHtml.animate({scrollTop: contentArea.offset().top - HEADER_BAR_HEIGHT}, \"slow\");\n                                    contentArea.find('#sectionbuttons').css(\"top\", \"\");\n                                }, 200);\n                            }\n                        });\n                        contentArea.find(Selector.SECTION_TITLE).on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.TAB && e.shiftKey\n                                && $(e.relatedTarget).closest(Selector.SECTION_MAIN).attr(\"id\") !== contentArea.attr(\"id\")) {\n                                // See explanation previous block.\n                                // Here we are trying to tab backwards out of the top of our section.\n                                // So take us to last item instead.\n                                setTimeout(function () {\n                                    activities.last().focus();\n                                }, 200);\n                            }\n                        });\n                    }\n                }\n\n                if (!isMobile) {\n                    // Activate tooltips for completion toggle and any \"restricted\" items in this content.\n                    setTimeout(function () {\n                        // Manual forms, auto icons and \"Restricted until ...\" etc.\n                        try {\n                            const tooltipItems = contentArea.find(\".togglecompletion, .completioncheckbox, .tag-info\");\n                            if (tooltipItems.length > 0) {\n                                tooltipItems.tooltip();\n                            }\n                        } catch (err) {\n                            require([\"core/log\"], function(log) {\n                                log.debug(err);\n                            });\n                        }\n                    }, 500);\n                }\n                // As we have just loaded new content, ensure that we initialise videoJS media player if required.\n                if (contentArea.find(Selector.MOODLE_VIDEO).length !== 0) {\n                    require([\"media_videojs/loader\"], function(videoJS) {\n                        videoJS.setUp();\n                    });\n                }\n\n                return true;\n            }\n            return false;\n        };\n\n        /**\n         * Expand a content containing section (e.g. on tile click)\n         * @param {object} contentArea\n         * @param {number} tileId to expand\n         */\n        var expandSection = function (contentArea, tileId) {\n            var expandAndScroll = function () {\n                // Scroll to the top of content bearing section\n                // we have to wait until possible reOrg and slide down totally before calling this, else co-ords are wrong.\n                var scrollTo = $(\"#tile-\" + tileId).offset().top - HEADER_BAR_HEIGHT;\n                if (scrollTo === $(window).scrollTop) {\n                    // Scroll by at least one pixel otherwise z-index on selected tile is not changed.\n                    // Until mouse moves.\n                    scrollTo += 1;\n                }\n                contentArea.find(Selector.SECTION_TITLE).focus();\n                // If user tries to scroll during animation, stop animation.\n                var events = \"scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove\";\n                body.on(events, function () {\n                    body.stop();\n                });\n\n                bodyHtml.animate({scrollTop: scrollTo}, \"slow\", function () {\n                    // Animation complete, remove stop handler.\n                    bodyHtml.off(events, function () {\n                        bodyHtml.stop();\n                    });\n                });\n                sectionIsOpen = true;\n                openTile = tileId;\n\n                // For users with screen readers, move focus to the first item within the tile.\n                contentArea.find(Selector.ACTIVITY).first().focus();\n\n                // If we have any iframes in the section which were previous emptied out, re-populate.\n                // This will happen if we have previously closed a section with videos in, and they were muted.\n                const iframes = contentArea.find(\"iframe\");\n                if (iframes.length > 0) {\n                    iframes.each(function (index, iframe) {\n                        iframe = $(iframe);\n                        // If iframe has no src, add it from data-src.\n                        if (iframe.attr('src') === '' && iframe.attr('data-src') !== undefined) {\n                            iframe.attr('src', iframe.attr(\"data-src\"));\n                        }\n                    });\n\n                    if (enableCompletion) {\n                        // Some iframes may load content set to mark as complete on view.\n                        // So maybe need to update tile completion info. E.g. applies with H5P filter.\n                        require([\"format_tiles/completion\"], function (completion) {\n                            setTimeout(() => {\n                                completion.updateTileInformation();\n                            }, 1000);\n                        });\n                    }\n                }\n            };\n\n            /**\n             * Make sure that the section close and edit buttons always appear at the top of the section on scroll\n             */\n            var holdSectionButtonPosition = function () {\n                var buttons = contentArea.find(Selector.SECTION_BUTTONS);\n                $(window).on(Event.SCROLL, function () {\n                    if (!scrollFuncLock && sectionIsOpen) {\n                        scrollFuncLock = true;\n                        buttons.fadeOut(300);\n                        setTimeout(function () {\n                            var windowTop = $(window).scrollTop();\n                            var desiredNewPositionInSection = (windowTop - contentArea.offset().top + 50);\n                            if (desiredNewPositionInSection > 0\n                                && desiredNewPositionInSection < contentArea.outerHeight() - 100) {\n                                desiredNewPositionInSection = (windowTop - contentArea.offset().top + 50);\n                                buttons.css(\"top\", desiredNewPositionInSection);\n                                if (windowOverlay.css(CSS.DISPLAY) === \"none\") {\n                                    windowOverlay.fadeIn(300);\n                                }\n                            } else if (desiredNewPositionInSection < 0) {\n                                buttons.css(\"top\", 0);\n                            }\n                            if (windowTop > contentArea.offset().top + contentArea.outerHeight() - 50) {\n                                // We have scrolled down and content bottom has gone out of the top of window.\n                                if (windowOverlay.css(CSS.DISPLAY) === \"block\") {\n                                    windowOverlay.fadeOut(300);\n                                    headerOverlayFadeInOut(false);\n                                }\n                                buttons.css(\"top\", 0);\n                            } else if (contentArea.offset().top > windowTop + $(window).outerHeight()) {\n                                // We have scrolled up and  content bottom has gone out of the bottom of window.\n                                if (windowOverlay.css(CSS.DISPLAY) === \"block\") {\n                                    windowOverlay.fadeOut(300);\n                                    headerOverlayFadeInOut(false);\n                                }\n                                buttons.css(\"top\", 0);\n                            } else if (windowOverlay.css(CSS.DISPLAY) === \"none\") {\n                                windowOverlay.fadeIn(300);\n                            }\n                            buttons.fadeIn(300, function () {\n                                // Release lock on this function.\n                                scrollFuncLock = false;\n                            });\n                        }, 500);\n                    }\n                });\n                if (!scrollFuncLock && !sectionIsOpen && windowOverlay.is(\":visible\")) {\n                    windowOverlay.fadeOut(300);\n                }\n            };\n\n            contentArea.addClass(ClassNames.STATE_VISIBLE);\n            contentArea.slideDown(350, function () {\n                // Wait until we have finished sliding down before we work out where the top is for scroll.\n                expandAndScroll();\n                holdSectionButtonPosition();\n            });\n            openTile = tileId;\n        };\n\n        /**\n         * We find out what section is open, collapse them all, then run the re-org.\n         * Finally we re-open the section.\n         * This is to ensure that the content bearing section is on the row under the tile clicked.\n         * It is run at page load and again if window is re-sized etc.\n         * @param {boolean} delayBefore do we want a delay before we re-org.  This allows e.g. browser resizing to complete.\n         * @param {boolean} fitTilesToScreenWidth whether we need to resize the tiles window while tiles are closed.\n         * @returns {Promise}\n         */\n        var reOrgSections = function (delayBefore, fitTilesToScreenWidth) {\n            var dfd = new $.Deferred();\n            var openedSection = $(\".moveablesection:visible\");\n            var openedSectionNum = 0;\n            if (openedSection.length > 0) {\n                openedSectionNum = openedSection.attr(\"data-section\");\n                cancelTileSelections();\n            }\n            var reOrgFunc = function(delayBefore) {\n                tileFitter.runReOrg(delayBefore)\n                    .done(function(result) {\n                        if (openedSectionNum !== 0) {\n                            expandSection(openedSection, openedSectionNum);\n                        }\n                        dfd.resolve(result);\n                    })\n                    .fail(function(result) {\n                        if (openedSectionNum !== 0) {\n                            expandSection(openedSection, openedSectionNum);\n                        }\n                        dfd.reject(result);\n                    });\n            };\n\n            if (fitTilesToScreenWidth) {\n                setTimeout(function() {\n                    tileFitter.resizeTilesDivWidth(courseId).done(function() {\n                        reOrgFunc(false);\n                    }, delayBefore);\n                });\n\n            } else {\n                reOrgFunc(delayBefore);\n            }\n            return dfd.promise();\n        };\n\n        var failedLoadSectionNotify = function(sectionNum, failResult, contentArea) {\n            if (failResult) {\n                // Notify the user and invite them to refresh.  We did get a \"failResult\" from server,\n                // So it looks like we do have a connection and can launch this.\n                Notification.confirm(\n                    stringStore.sectionerrortitle,\n                    stringStore.sectionerrorstring,\n                    stringStore.refresh,\n                    stringStore.cancel,\n                    function () {\n                        window.location.reload();\n                    },\n                    null\n                );\n                contentArea.html(\"\"); // Clear loading icon.\n            } else {\n                // It looks like we may not have a connection so we can't launch notifications.\n                // We can warn the user like this instead.\n                setCourseContentHTML(contentArea, \"<p>\" + stringStore.noconnectionerror + \"</p>\");\n                setTimeout(function () {\n                    expandSection(contentArea, sectionNum);\n                }, 500);\n            }\n            require([\"core/log\"], function(log) {\n                log.debug(failResult);\n            });\n            throw new Error(\"Not successful retrieving tile content by AJAX for section \" + sectionNum);\n        };\n\n        /**\n         * For a given section, get the content from the server, add it to the store and maybe UI and maybe show it\n         * @param {number} courseId the id for the affected course\n         * @param {number} sectionNum the section number we are wanting to populate\n         * @return {Promise} promise to resolve when the ajax call returns.\n         */\n        var getSectionContentFromServer = function (courseId, sectionNum) {\n            return ajax.call([{\n                methodname: \"format_tiles_get_single_section_page_html\",\n                args: {\n                    courseid: courseId,\n                    sectionid: sectionNum,\n                    setjsusedsession: true\n                }\n            }])[0];\n        };\n\n        /**\n         * Temporary function to adjust shade of RGB colour\n         * (used for shading tiles to get around transparent background on overlay issue)\n         * @param {number} R\n         * @param {number} G\n         * @param {number} B\n         * @param {number} percent\n         * @returns {string}\n         */\n        var shadeRGBColor = function (R, G, B, percent) {\n            var t = percent < 0 ? 0 : 255;\n            var p = percent < 0 ? percent * -1 : percent;\n            var r = Math.round((t - R) * p) + R;\n            var g = Math.round((t - G) * p) + G;\n            var b = Math.round((t - B) * p) + B;\n            return \"rgb(\" + r + \",\" + g + \",\" + b + \")\";\n        };\n\n        /**\n         * Add an opaque modal backdrop like div to obscure all other tiles and bring specified tile and content to front\n         * @param {number} secNumOnTop the section number which should be displayed on top of the overlay\n         */\n        var setOverlay = function (secNumOnTop) {\n            windowOverlay.fadeIn(300);\n            backDropZIndex = parseInt(windowOverlay.css(CSS.Z_INDEX));\n            var tile = $(Selector.TILEID + secNumOnTop);\n            tile.css(CSS.Z_INDEX, (backDropZIndex + 1));\n            headerOverlayFadeInOut(true);\n            $(Selector.SECTION_ID + secNumOnTop).css(CSS.Z_INDEX, (backDropZIndex + 1));\n            if (tile.css(CSS.BG_COLOUR) && tile.css(CSS.BG_COLOUR).substr(0, 4) === \"rgba\") {\n                // Tile may have transparent background from theme - needs to be solid otherwise modal shows through.\n                var existingColour = tile.css(CSS.BG_COLOUR).replace(\"rgba(\", \"\").replace(\")\", \"\").replace(\" \", \"\").split(\",\");\n                tile.css(CSS.BG_COLOUR, shadeRGBColor(\n                    parseInt(existingColour[0]),\n                    parseInt(existingColour[1]),\n                    parseInt(existingColour[2]),\n                    0.95\n                ));\n            }\n        };\n\n        /**\n         * Used where the user clicks the window overlay but we want the active click to be behind the\n         * overlay e.g. the tile or custom menu item behind it.  So we get the co-ordinates of the click\n         * on the overlay and then repeat the click at that spot ignoring the overlay\n         * @param {object} e the click event object\n         */\n        var clickItemBehind = function (e) {\n            var clickedItem = $(e.currentTarget);\n            if (clickedItem.attr(\"id\") === \"window-overlay\" || clickedItem.attr(\"id\") === ClassNames.HEADER_OVERLAY) {\n                // We need to know what is behind the modal, so hide it for an instant to find out.\n                clickedItem.hide();\n                var BottomElement = $(document.elementFromPoint(e.clientX, e.clientY));\n                clickedItem.show();\n                if (clickedItem.attr(\"id\") === \"window-overlay\") {\n                    if (BottomElement.hasClass(\"filterbutton\") || BottomElement.hasClass(\"list-group-item\")) {\n                        // Must ba a filter button clicked or a nav drawer item.\n                        BottomElement.click();\n                    } else {\n                        // Must be a tile clicked.\n                        var clickedTile = BottomElement.closest(Selector.TILE);\n                        if (clickedTile) {\n                            clickedTile.click();\n                        }\n                    }\n                } else {\n                    // Must be a click on the header bar.\n                    cancelTileSelections(0);\n                    BottomElement.click();\n                }\n            }\n        };\n\n        /**\n         * If the user had section zero collapsed in this course previously, collapse it now\n         */\n        var setSectionZeroFromUserPref = function () {\n            var buttonHideSecZero = $(Selector.HIDE_SEC0_BTN);\n            var sectionZero = $(Selector.SECTION_ZERO);\n            if (browserStorage.storageEnabledLocal()) {\n                // Collapse section zero if user had it collapsed before - relies on local storage so only if enabled.\n                if (browserStorage.getSecZeroCollapseStatus() === true) {\n                    sectionZero.slideUp(0);\n                    buttonHideSecZero.addClass(ClassNames.CLOSED).removeClass(ClassNames.OPEN); // Button image.\n                } else {\n                    sectionZero.slideDown(300);\n                    buttonHideSecZero.addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED); // Button image.\n                }\n            } else {\n                // Storage not available so we dont know if sec zero was previously collapsed - expand it.\n                buttonHideSecZero.addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED);\n                sectionZero.slideDown(300);\n            }\n        };\n\n        /**\n         * To be called when a tile is clicked. Get content from server or storage and display or store it.\n         * @param {number} courseId courseId the id of this course.\n         * @param {object} thisTile jquery the tile object clicked.\n         * @param {number} dataSection the id number of the tile.\n         * @param {number} storedContentExpirySecs\n         */\n        var populateAndExpandSection = function(courseId, thisTile, dataSection, storedContentExpirySecs) {\n            setOverlay(dataSection);\n            $(Selector.TILE).removeClass(ClassNames.SELECTED);\n            thisTile.addClass(ClassNames.SELECTED);\n            openTile = dataSection;\n            // Then close all open secs.\n            // Timed to finish in 200 so that it completes well before the opening next.\n            $(Selector.MOVEABLE_SECTION).each(function (index, sec) {\n                sec = $(sec);\n                if (sec.is(\":visible\")) {\n                    stopVideoPlaying(sec.attr(\"data-section\"));\n                    sec.slideUp(200).removeClass(ClassNames.STATE_VISIBLE); // Excludes section 0.\n                }\n            });\n            // Log the fact we viewed the section.\n            ajax.call([{\n                methodname: \"format_tiles_log_tile_click\", args: {\n                    courseid: courseId,\n                    sectionid: dataSection\n                }\n            }])[0].fail(Notification.exception);\n            // Get the content - use locally stored content first if available.\n            var relatedContentArea = $(Selector.SECTION_ID + dataSection);\n            if (relatedContentArea.find(Selector.ACTIVITY).length > 0) {\n                // There is already some content on the screen so display immediately.\n                expandSection(relatedContentArea, dataSection);\n                // Then refresh the content in storage only but do not change on screen.\n                if (browserStorage.getStoredContentAge(courseId, dataSection) > storedContentExpirySecs\n                    || !browserStorage.getStoredContentAge(courseId, dataSection)) {\n                    // If stored content is old, replace it.\n                    getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                        if (browserStorage.storageEnabledSession()) {\n                            browserStorage.storeCourseContent(courseId, dataSection, $(response.html).html());\n                        }\n                    });\n                }\n            } else {\n                relatedContentArea.html(loadingIconHtml);\n                if (browserStorage.storageEnabledLocal()) {\n                    var contentAge = browserStorage.getStoredContentAge(courseId, dataSection);\n                    if (contentAge) {\n                        // We have some stored content so display it even if it's expired.\n                        setCourseContentHTML(\n                            relatedContentArea,\n                            browserStorage.getCourseContent(courseId, dataSection)\n                        );\n                        expandSection(relatedContentArea, dataSection);\n                    }\n                    if (!contentAge || contentAge > storedContentExpirySecs) {\n                        // Content in local storage may not exist or have expired.\n                        // If so, get it again from server and display new content on receipt.\n                        var loadingIcon = $(Selector.TILE_LOADING_ICON_ID + dataSection);\n                        if (loadingIcon !== undefined) {\n                            loadingIcon.html(loadingIconHtml).fadeIn(200);\n                        } else {\n                            loadingIcon = $(\"<div>\").html(loadingIconHtml);\n                            relatedContentArea.html(loadingIcon);\n                        }\n                        getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                            var contentToDisplay = $(response.html).html();\n                            setCourseContentHTML(relatedContentArea, contentToDisplay);\n                            expandSection(relatedContentArea, dataSection);\n                            if (browserStorage.storageEnabledSession()) {\n                                browserStorage.storeCourseContent(courseId, dataSection, contentToDisplay);\n                            }\n                        }).fail(function (failResult) {\n                            failedLoadSectionNotify(dataSection, failResult, relatedContentArea);\n                            cancelTileSelections(dataSection);\n                        });\n                    }\n                } else {\n                    // Not using storage so get from server.\n                    getSectionContentFromServer(courseId, dataSection).done(function (response) {\n                        setCourseContentHTML(relatedContentArea, $(response.html).html());\n                        expandSection(relatedContentArea, dataSection);\n                    }).fail(function (failResult) {\n                        failedLoadSectionNotify(dataSection, failResult, relatedContentArea);\n                        cancelTileSelections(dataSection);\n                    });\n                }\n            }\n            browserStorage.setLastVisitedSection(dataSection);\n        };\n\n        return {\n            init: function (\n                courseIdInit,\n                useJavascriptNav, // Set by site admin see settings.php.\n                maxContentSectionsToStore, // Set by site admin see settings.php.\n                isMobileInit,\n                sectionNum,\n                storedContentExpirySecs, // Set by site admin see settings.php.\n                storedContentDeleteMins, // Set by site admin see settings.php.\n                useFilterButtons,\n                assumeDataStoreConsent, // Set by site admin see settings.php.\n                reopenLastSectionInit, // Set by site admin see settings.php.\n                userId,\n                fitTilesToWidth,\n                usingH5pFilter,\n                enableCompletionInit\n            ) {\n                courseId = courseIdInit;\n                isMobile = isMobileInit;\n                // Some args are strings or ints but we prefer bool.  Change to bool now as they are passed on elsewhere.\n                reopenLastVisitedSection = reopenLastSectionInit === \"1\";\n                useFilterButtons = useFilterButtons === 1;\n                assumeDataStoreConsent = assumeDataStoreConsent === \"1\";\n                enableCompletion = enableCompletionInit === \"1\";\n                // We want to initialise the browser storage JS module for storing user settings.\n                // And (depending on maxContentSectionsToStore) possibly also content in browser.\n                browserStorage.init(\n                    courseId,\n                    maxContentSectionsToStore,\n                    false,\n                    sectionNum,\n                    storedContentDeleteMins,\n                    assumeDataStoreConsent,\n                    userId\n                );\n                browserStorage.cleanUpStorage();\n                $(document).ready(function () {\n                    var pageContent = $(\"#page-content\");\n                    if (pageContent.length === 0) {\n                        // Some themes e.g. RemUI do not have a #page-content div, so use #region-main.\n                        pageContent = $(\"#region-main\");\n                    }\n\n                    // If we are being told to launch a section number from the URL, use that.\n                    if (sectionNum !== 0) {\n                        openTile = sectionNum;\n                    } else {\n                        // Don't use the URL param - check local storage instead.\n                        if (reopenLastVisitedSection && browserStorage.storageEnabledLocal) {\n                            openTile = browserStorage.getLastVisitedSection();\n                            // If user is not on mobile, retrieve last visited section id from browser storage (if present).\n                            // And click it.\n                        }\n                    }\n                    if (openTile !== 0) {\n                        tileFitter.init(courseId, openTile, fitTilesToWidth, false);\n                    } else {\n                        // Set focus to the first tile (not section zero).\n                        $(Selector.TILEID + \"1\").focus();\n                        tileFitter.init(courseId, null, fitTilesToWidth, false);\n                    }\n                    var windowWidth = $(window).outerWidth();\n\n                    if (useJavascriptNav) {\n                        // User is not editing but is usingJS nav to view.\n\n                        // When a tile is clicked we add an overlay to grey out the rest of the tiles on the page, so prepare it.\n                        windowOverlay = $(\"<div></div>\").addClass(\"modal-backdrop fade in\").hide()\n                            .attr(\"id\", \"window-overlay\").appendTo(body);\n\n                        // If user clicks the window overlay behind the visible tile content, deselect tile.\n                        // (They want to remove the overlay).\n                        windowOverlay.click(function (e) {\n                            cancelTileSelections(0);\n                            clickItemBehind(e);\n                        });\n\n                        // On a tile click, decide what to do an do it.\n                        // (Collapse if already expanded, or expand it and fill with content).\n                        pageContent.on(Event.CLICK, Selector.TILE_CLICKABLE, function (e) {\n                            // Prevent the link being followed to reload the PHP page as we are using JS instead.\n                            if (!useJavascriptNav) {\n                                return;\n                            }\n                            e.preventDefault();\n                            $(window).off(Event.SCROLL); // Stop listening for scroll events on ay previously opened tiles.\n                            // if other tiles have loading icons, fade them out (on the tile not the content sec).\n                            $(Selector.TILE_LOADING_ICON).fadeOut(300, function () {\n                                $(Selector.TILE_LOADING_ICON).html();\n                            });\n                            var thisTile = $(e.currentTarget).closest(Selector.TILE);\n                            var dataSection = parseInt(thisTile.attr(\"data-section\"));\n                            if (thisTile.hasClass(ClassNames.SELECTED)) {\n                                // This tile is already expanded so collapse it.\n                                cancelTileSelections(dataSection);\n                                browserStorage.setLastVisitedSection(0);\n                            } else {\n                                populateAndExpandSection(\n                                    courseId, thisTile, dataSection, storedContentExpirySecs\n                                );\n                            }\n                            // Silently set the *next* section's content to if it exists and if user is not on mobile.\n                            // short delay as more important to get current section content first (above).\n                            var nextSecIfExists = $(Selector.SECTION_ID + (dataSection + 1));\n                            if (!isMobile && !usingH5pFilter && nextSecIfExists.length && dataSection > 0) {\n                                setTimeout(function () {\n                                    var storedContentAge = browserStorage.getStoredContentAge(courseId, dataSection + 1);\n                                    if (storedContentAge) {\n                                        // We have some stored content so set this to screen (even if expired).\n                                        setCourseContentHTML(\n                                            nextSecIfExists,\n                                            browserStorage.getCourseContent(courseId, dataSection + 1)\n                                        );\n                                    }\n                                    if (!storedContentAge || storedContentAge > storedContentExpirySecs) {\n                                        // Stored content is too old or does not exist so get from server.\n                                        getSectionContentFromServer(courseId, dataSection + 1).done(function(response) {\n                                            setCourseContentHTML(\n                                                nextSecIfExists,\n                                                $(response.html).html()\n                                            );\n                                            if (browserStorage.storageEnabledSession()) {\n                                                browserStorage.storeCourseContent(\n                                                    courseId, dataSection + 1, $(response.html).html()\n                                                );\n                                            }\n                                        });\n                                    }\n                                }, 2000);\n                            }\n                        });\n\n                        // When window is re-sized, content sections under the tiles may be in wrong place.\n                        // So remove them and re-initialise them.\n                        // Collapse the selected section before doing this.\n                        // Otherwise the re-organisation won't work as the tiles' flow will be out when they are analysed.\n                        $(window).on(\"resize\", function () {\n                            // On iOS resize events are triggered often on scroll because the address bar hides itself.\n                            // Avoid this using windowWidth here.\n                            if (resizeLocked || windowWidth === $(window).outerWidth()) {\n                                return;\n                            }\n                            resizeLocked = true;\n\n                            // We wait for a short time before doing anything, as user may still be dragging window size change.\n                            // We don't want to react to say 20 resize events happening over a single drag.\n                            setTimeout(function() {\n                                // First assume that we are going to resize, but we have checks to make below.\n                                var resizeRequired = true;\n\n                                // If we have a Moodle media player div in the section in fullscreen, ignore this resize event.\n                                // It was probably caused when user pressed the full screen button.\n                                var openContentSection = $(\".moveablesection:visible\");\n                                if (openContentSection.length !== 0) {\n                                    var mediaPlayers = openContentSection.find(\".mediaplugin iframe\");\n                                    if (mediaPlayers.length !== 0) {\n                                        mediaPlayers.each(function (index, player) {\n                                            player = $(player);\n                                            if (player.outerWidth() > openContentSection.outerWidth()) {\n                                                // Video is present and playing full screen so don't react to resize event.\n                                                resizeRequired = false;\n                                            }\n                                        });\n                                    }\n                                }\n                                if (resizeRequired) {\n                                    // Set global for comparison next time.\n                                    windowWidth = $(window).outerWidth();\n                                    reOrgSections(true, fitTilesToWidth);\n                                }\n                                resizeLocked = false;\n                            }, 600);\n                        });\n\n                        // We want the main menu at the top to be on top of the tiles.\n                        // Even the ones which we have brought to the front on top of the window overlay.\n                        // But we also want it to still be greyed out.  So add an opaque overlay.\n                        // We can show this when the main overlay is active.\n                        // When a user clicks this overlay, they want to close the overlay and click menu item behind.\n                        // So provide for that here.\n                        // Z-INDICES: active tile will be at overlayZindex + 1.\n                        // Header bar will be at overlayZindex + 2 so that it is higher than tiles.\n                        // Header bar overlay will be at overlayZindex + 3 so that it is highest of all.\n\n                        var overlayZindex = parseInt(windowOverlay.css(CSS.Z_INDEX));\n                        var headerBar = $(Selector.HEADER_BAR.find(function(selector) {\n                            return $(selector).length > 0;\n                        }));\n                        if (headerBar !== undefined && headerBar.length !== 0) {\n                            headerBar.css(CSS.Z_INDEX, overlayZindex + 2);\n                            if (headerBar.attr(\"id\") !== \"navwrap\") {\n                                // ID navwrap suggests theme is Adaptable based. We don't bother with header overlay if so.\n                                // Otherise the header bar has a separate mini overlay of its own - find and hide this.\n                                // If it is clicked, cancel tile selections and click the item behind where clicked.\n                                // Do not include for Moodle 3.5 or higher as not needed.\n                                if (headerBar.outerHeight() !== undefined) {\n                                    HEADER_BAR_HEIGHT = headerBar.outerHeight();\n                                    headerOverlay = $(\"<div></div>\")\n                                        .addClass(ClassNames.HEADER_OVERLAY).attr(\"id\", ClassNames.HEADER_OVERLAY)\n                                        .css(CSS.DISPLAY, \"none\");\n                                    headerOverlay.insertAfter(Selector.PAGE)\n                                        .css(CSS.Z_INDEX, (overlayZindex) + 3).css(CSS.HEIGHT, HEADER_BAR_HEIGHT)\n                                        .click(function (e) {\n                                            cancelTileSelections(0);\n                                            clickItemBehind(e);\n                                        });\n                                } else {\n                                    require([\"core/log\"], function(log) {\n                                        log.debug(\n                                            \"Failed to get navbar.  Ensure theme's navbar selector is included in global HEADER_BAR\"\n                                        );\n                                    });\n                                }\n                            }\n                        }\n\n                        // When user clicks to close a section using cross at top right in section.\n                        pageContent.on(Event.CLICK, Selector.CLOSE_SEC_BTN, function (e) {\n                            cancelTileSelections($(e.currentTarget).attr(\"data-section\"));\n                        });\n\n                        // If user clicks a sub tile body below the link, treat it as a click on the link itself.\n                        pageContent.on(Event.CLICK, Selector.LAUNCH_STANDARD, function(e) {\n                            var clickedLk = $(e.currentTarget);\n                            if (clickedLk.attr(\"href\") !== undefined) {\n                                window.location = clickedLk.attr(\"href\");\n                            } else if (clickedLk.find('a').attr(\"href\") !== undefined) {\n                                window.location = clickedLk.find('a').attr(\"href\");\n                            }\n                        });\n\n                        setSectionZeroFromUserPref();\n                        // Most filter button related JS is in filter_buttons.js module which is required below.\n\n                    }\n\n                    // When the user presses the button to collapse or expand Section zero (section at the top of the course).\n                    pageContent.on(Event.CLICK, Selector.HIDE_SEC0_BTN, function (e) {\n                        var sectionZero = $(Selector.SECTION_ZERO);\n                        if (sectionZero.css(CSS.DISPLAY) === \"none\") {\n                            // Sec zero is collapsed so expand it on user click.\n                            sectionZero.slideDown(250);\n                            $(e.currentTarget).addClass(ClassNames.OPEN).removeClass(ClassNames.CLOSED);\n                            browserStorage.setSecZeroCollapseStatus(\"collapsed\");\n                        } else {\n                            // Sec zero is expanded so collapse it on user click.\n                            sectionZero.slideUp(250);\n                            $(e.currentTarget).addClass(ClassNames.CLOSED).removeClass(ClassNames.OPEN);\n                            browserStorage.setSecZeroCollapseStatus(\"expanded\");\n                        }\n                    });\n\n                    if (useFilterButtons) {\n                        require([\"format_tiles/filter_buttons\"], function (filterButtons) {\n                            filterButtons.init(courseId, browserStorage.storageEnabledLocal);\n                        });\n                        if (useJavascriptNav) {\n                            pageContent.on(Event.CLICK, Selector.FILTER_BUTTON, function () {\n                                cancelTileSelections(0);\n                                reOrgSections(true, false);\n                            });\n                        }\n\n                    }\n                    // If theme is displaying the .tiles_coursenav class items, show items with this class.\n                    // They will be hidden otherwise.\n                    // They are hidden when initially rendered from PHP as we only want them shown if browser supports JS.\n                    // See lib.php extend_course_navigation.\n                    $(\".tiles_coursenav\").removeClass(\"hidden\");\n\n                    // Render the loading icon and store its HTML globally so that we can use it where needed later.\n                    Templates.render(\"format_tiles/loading\", {}).done(function (html) {\n                        loadingIconHtml = html;\n                    });\n\n                    // Get these strings now, in case we need them.\n                    // E.g. after we lose connection and cannot display content on a user tile click.\n                    var stringKeys = [\n                        {key: \"sectionerrortitle\", component: \"format_tiles\"},\n                        {key: \"sectionerrorstring\", component: \"format_tiles\"},\n                        {key: \"refresh\"},\n                        {key: \"cancel\"},\n                        {key: \"noconnectionerror\", component: \"format_tiles\"},\n                        {key: \"show\"},\n                        {key: \"hide\"},\n                        {key: \"other\", component: \"format_tiles\"},\n                        {key: \"blockedpopuptitle\", component: \"format_tiles\"}\n                    ];\n                    str.get_strings(stringKeys).done(function (s) {\n                        s.forEach(function(str, index) {\n                            stringStore[stringKeys[index].key] = str;\n                        });\n                    });\n\n                    // If a mobile user clicks an embedded video activity, we don't show them a modal.\n                    // It won't work well. Instead we direct them to the original site e.g. YouTube.\n                    if (isMobile) {\n                        pageContent.on(Event.CLICK, Selector.ACTIVITY + \".video a\", function(e) {\n                            var target = $(e.currentTarget);\n                            var url = target.closest(Selector.ACTIVITY).attr(\"data-url-secondary\");\n                            if (url !== undefined) {\n                                e.preventDefault();\n                                e.stopPropagation();\n                                var cm = target.closest(Selector.ACTIVITY);\n                                ajax.call([{\n                                    methodname: \"format_tiles_log_mod_view\", args: {\n                                        courseid: courseId,\n                                        cmid: cm.attr(\"data-cmid\")\n                                    }\n                                }])[0].done(function () {\n                                    // Because we intercepted the normal event for the click, process auto completion.\n                                    require([\"format_tiles/completion\"], function (completion) {\n                                        completion.markAsAutoCompleteInUI(courseId, cm);\n                                    });\n                                });\n                                window.location = url;\n                            }\n                        });\n                    } else {\n                        // If user is NOT on mobile device.\n\n                        // If return is pressed while an item is in focus, click the item.\n                        // This is to make the tiles keyboard navigable for users using screen readers.\n                        // User tabbing between tiles is handled by tabindex in the HTML.\n                        // Once the tile is clicked, the expand tile function will move focus to the first content item.\n                        // On escape key, we clear all selections and collapse tiles (handled above not here).\n                        $(Selector.TILE).on(Event.KEYDOWN, function (e) {\n                            if (e.keyCode === Keyboard.RETURN) { // Return key pressed.\n                                $(e.currentTarget).click();\n                            }\n                        });\n\n                        // Move focus to the first tile in the course (not sec zero contents if present).\n                        $(\"ul.tiles .tile\").first().focus();\n                    }\n\n                    // If Adaptable theme is being used, and Glossary auto link filter is on, we need this.\n                    // Otherwise when the auto link is clicked, the resulting dialogue is under the main overlay.\n                    // Don't need this when Boost or Clean themes are used as they handle it themselves.\n                    $(document).on(\"filter-content-updated\", function (event, msg) {\n                        if (msg.length > 0) {\n                            var elem = $(msg[0]);\n                            if (elem.hasClass(\"moodle-dialogue\") && elem.css(\"z-index\") < backDropZIndex) {\n                                elem.css(\"z-index\", backDropZIndex + 1);\n                            }\n                        }\n                    });\n                });\n            }\n        };\n    }\n);"],"file":"course.min.js"}